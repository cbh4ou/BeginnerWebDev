var paper=new function(undefined){var Base=new function(){var hidden=/^(statics|enumerable|beans|preserve)$/,forEach=[].forEach||function(iter,bind){for(var i=0,l=this.length;i<l;i++)iter.call(bind,this[i],i,this)},forIn=function(iter,bind){for(var i in this)this.hasOwnProperty(i)&&iter.call(bind,this[i],i,this)},create=Object.create||function(proto){return{__proto__:proto}},describe=Object.getOwnPropertyDescriptor||function(obj,name){var get=obj.__lookupGetter__&&obj.__lookupGetter__(name);return get?{get:get,set:obj.__lookupSetter__(name),enumerable:!0,configurable:!0}:obj.hasOwnProperty(name)?{value:obj[name],enumerable:!0,configurable:!0,writable:!0}:null},_define=Object.defineProperty||function(obj,name,desc){return(desc.get||desc.set)&&obj.__defineGetter__?(desc.get&&obj.__defineGetter__(name,desc.get),desc.set&&obj.__defineSetter__(name,desc.set)):obj[name]=desc.value,obj},define=function(obj,name,desc){return delete obj[name],_define(obj,name,desc)};function inject(dest,src,enumerable,beans,preserve){var beansNames={};function field(name,val){"string"==typeof(val=val||(val=describe(src,name))&&(val.get?val:val.value))&&"#"===val[0]&&(val=dest[val.substring(1)]||val);var isFunc="function"==typeof val,res=val,prev=preserve||isFunc&&!val.base?val&&val.get?name in dest:dest[name]:null,bean;preserve&&prev||(isFunc&&prev&&(val.base=prev),isFunc&&!1!==beans&&(bean=name.match(/^([gs]et|is)(([A-Z])(.*))$/))&&(beansNames[bean[3].toLowerCase()+bean[4]]=bean[2]),res&&!isFunc&&res.get&&"function"==typeof res.get&&Base.isPlainObject(res)||(res={value:res,writable:!0}),(describe(dest,name)||{configurable:!0}).configurable&&(res.configurable=!0,res.enumerable=enumerable),define(dest,name,res))}if(src){for(var name in src)src.hasOwnProperty(name)&&!hidden.test(name)&&field(name);for(var name in beansNames){var part=beansNames[name],set=dest["set"+part],get=dest["get"+part]||set&&dest["is"+part];!get||!0!==beans&&0!==get.length||field(name,{get:get,set:set})}}return dest}function each(obj,iter,bind){return obj&&("length"in obj&&!obj.getLength&&"number"==typeof obj.length?forEach:forIn).call(obj,iter,bind=bind||obj),bind}function set(obj,props,exclude){for(var key in props)!props.hasOwnProperty(key)||exclude&&exclude[key]||(obj[key]=props[key]);return obj}return inject(function Base(){for(var i=0,l=arguments.length;i<l;i++)set(this,arguments[i])},{inject:function(src){if(src){var statics=!0===src.statics?src:src.statics,beans=src.beans,preserve=src.preserve;statics!==src&&inject(this.prototype,src,src.enumerable,beans,preserve),inject(this,statics,!0,beans,preserve)}for(var i=1,l=arguments.length;i<l;i++)this.inject(arguments[i]);return this},extend:function(){for(var base=this,ctor,proto,i=0,l=arguments.length;i<l&&!(ctor=arguments[i].initialize);i++);return proto=(ctor=ctor||function(){base.apply(this,arguments)}).prototype=create(this.prototype),define(proto,"constructor",{value:ctor,writable:!0,configurable:!0}),inject(ctor,this,!0),arguments.length&&this.inject.apply(ctor,arguments),ctor.base=base,ctor}},!0).inject({inject:function(){for(var i=0,l=arguments.length;i<l;i++){var src=arguments[i];src&&inject(this,src,src.enumerable,src.beans,src.preserve)}return this},extend:function(){var res=create(this);return res.inject.apply(res,arguments)},each:function(iter,bind){return each(this,iter,bind)},set:function(props){return set(this,props)},clone:function(){return new this.constructor(this)},statics:{each:each,create:create,define:define,describe:describe,set:set,clone:function(obj){return set(new obj.constructor,obj)},isPlainObject:function(obj){var ctor=null!=obj&&obj.constructor;return ctor&&(ctor===Object||ctor===Base||"Object"===ctor.name)},pick:function(a,b){return a!==undefined?a:b}}})};"undefined"!=typeof module&&(module.exports=Base),Base.inject({toString:function(){return null!=this._id?(this._class||"Object")+(this._name?" '"+this._name+"'":" @"+this._id):"{ "+Base.each(this,function(value,key){if(!/^_/.test(key)){var type=typeof value;this.push(key+": "+("number"===type?Formatter.instance.number(value):"string"===type?"'"+value+"'":value))}},[]).join(", ")+" }"},getClassName:function(){return this._class||""},exportJSON:function(options){return Base.exportJSON(this,options)},toJSON:function(){return Base.serialize(this)},_set:function(props,exclude,dontCheck){if(props&&(dontCheck||Base.isPlainObject(props))){for(var keys=Object.keys(props._filtering||props),i=0,l=keys.length;i<l;i++){var key=keys[i];if(!exclude||!exclude[key]){var value=props[key];value!==undefined&&(this[key]=value)}}return!0}},statics:{exports:{enumerable:!0},extend:function extend(){var res=extend.base.apply(this,arguments),name=res.prototype._class;return name&&!Base.exports[name]&&(Base.exports[name]=res),res},equals:function(obj1,obj2){if(obj1===obj2)return!0;if(obj1&&obj1.equals)return obj1.equals(obj2);if(obj2&&obj2.equals)return obj2.equals(obj1);if(obj1&&obj2&&"object"==typeof obj1&&"object"==typeof obj2){if(Array.isArray(obj1)&&Array.isArray(obj2)){var length;if((length=obj1.length)!==obj2.length)return!1;for(;length--;)if(!Base.equals(obj1[length],obj2[length]))return!1}else{var keys=Object.keys(obj1),length;if((length=keys.length)!==Object.keys(obj2).length)return!1;for(;length--;){var key=keys[length];if(!obj2.hasOwnProperty(key)||!Base.equals(obj1[key],obj2[key]))return!1}}return!0}return!1},read:function(list,start,options,length){if(this===Base){var value=this.peek(list,start);return list.__index++,value}var proto,readIndex=this.prototype._readIndex,index=start||readIndex&&list.__index||0;length||(length=list.length-index);var obj=list[index];return obj instanceof this||options&&options.readNull&&null==obj&&length<=1?(readIndex&&(list.__index=index+1),obj&&options&&options.clone?obj.clone():obj):(obj=Base.create(this.prototype),readIndex&&(obj.__read=!0),obj=obj.initialize.apply(obj,index>0||length<list.length?Array.prototype.slice.call(list,index,index+length):list)||obj,readIndex&&(list.__index=index+obj.__read,obj.__read=undefined),obj)},peek:function(list,start){return list[list.__index=start||list.__index||0]},remain:function(list){return list.length-(list.__index||0)},readAll:function(list,start,options){for(var res=[],entry,i=start||0,l=list.length;i<l;i++)res.push(Array.isArray(entry=list[i])?this.read(entry,0,options):this.read(list,i,options,1));return res},readNamed:function(list,name,start,options,length){var value=this.getNamed(list,name),hasObject=value!==undefined;if(hasObject){var filtered=list._filtered;filtered||((filtered=list._filtered=Base.create(list[0]))._filtering=list[0]),filtered[name]=undefined}return this.read(hasObject?[value]:list,start,options,length)},getNamed:function(list,name){var arg=list[0];if(list._hasObject===undefined&&(list._hasObject=1===list.length&&Base.isPlainObject(arg)),list._hasObject)return name?arg[name]:list._filtered||arg},hasNamed:function(list,name){return!!this.getNamed(list,name)},isPlainValue:function(obj,asString){return this.isPlainObject(obj)||Array.isArray(obj)||asString&&"string"==typeof obj},serialize:function(obj,options,compact,dictionary){options=options||{};var root=!dictionary,res;if(root&&(options.formatter=new Formatter(options.precision),dictionary={length:0,definitions:{},references:{},add:function(item,create){var id="#"+item._id,ref=this.references[id];if(!ref){this.length++;var res=create.call(item),name=item._class;name&&res[0]!==name&&res.unshift(name),this.definitions[id]=res,ref=this.references[id]=[id]}return ref}}),obj&&obj._serialize){res=obj._serialize(options,dictionary);var name=obj._class;!name||compact||res._compact||res[0]===name||res.unshift(name)}else if(Array.isArray(obj)){res=[];for(var i=0,l=obj.length;i<l;i++)res[i]=Base.serialize(obj[i],options,compact,dictionary);compact&&(res._compact=!0)}else if(Base.isPlainObject(obj)){res={};for(var keys=Object.keys(obj),i=0,l=keys.length;i<l;i++){var key=keys[i];res[key]=Base.serialize(obj[key],options,compact,dictionary)}}else res="number"==typeof obj?options.formatter.number(obj,options.precision):obj;return root&&dictionary.length>0?[["dictionary",dictionary.definitions],res]:res},deserialize:function(json,create,_data,_isDictionary){var res=json,isRoot=!_data;if(_data=_data||{},Array.isArray(json)){var type=json[0],isDictionary="dictionary"===type;if(1==json.length&&/^#/.test(type))return _data.dictionary[type];type=Base.exports[type],res=[],_isDictionary&&(_data.dictionary=res);for(var i=type?1:0,l=json.length;i<l;i++)res.push(Base.deserialize(json[i],create,_data,isDictionary));if(type){var args=res;create?res=create(type,args):(res=Base.create(type.prototype),type.apply(res,args))}}else if(Base.isPlainObject(json))for(var key in res={},_isDictionary&&(_data.dictionary=res),json)res[key]=Base.deserialize(json[key],create,_data);return isRoot&&json&&json.length&&"dictionary"===json[0][0]?res[1]:res},exportJSON:function(obj,options){var json=Base.serialize(obj,options);return options&&!1===options.asString?json:JSON.stringify(json)},importJSON:function(json,target){return Base.deserialize("string"==typeof json?JSON.parse(json):json,function(type,args){var obj=target&&target.constructor===type?target:Base.create(type.prototype),isTarget=obj===target;if(1===args.length&&obj instanceof Item&&(isTarget||!(obj instanceof Layer))){var arg=args[0];Base.isPlainObject(arg)&&(arg.insert=!1)}return type.apply(obj,args),isTarget&&(target=null),obj})},splice:function(list,items,index,remove){var amount=items&&items.length,append=index===undefined;(index=append?list.length:index)>list.length&&(index=list.length);for(var i=0;i<amount;i++)items[i]._index=index+i;if(append)return list.push.apply(list,items),[];var args=[index,remove];items&&args.push.apply(args,items);for(var removed=list.splice.apply(list,args),i=0,l=removed.length;i<l;i++)removed[i]._index=undefined;for(var i=index+amount,l=list.length;i<l;i++)list[i]._index=i;return removed},capitalize:function(str){return str.replace(/\b[a-z]/g,function(match){return match.toUpperCase()})},camelize:function(str){return str.replace(/-(.)/g,function(all,chr){return chr.toUpperCase()})},hyphenate:function(str){return str.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase()}}});var Emitter={on:function(type,func){if("string"!=typeof type)Base.each(type,function(value,key){this.on(key,value)},this);else{var types=this._eventTypes,entry=types&&types[type],handlers=this._callbacks=this._callbacks||{};-1===(handlers=handlers[type]=handlers[type]||[]).indexOf(func)&&(handlers.push(func),entry&&entry.install&&1===handlers.length&&entry.install.call(this,type))}return this},off:function(type,func){if("string"==typeof type){var types=this._eventTypes,entry=types&&types[type],handlers=this._callbacks&&this._callbacks[type],index;return handlers&&(!func||-1!==(index=handlers.indexOf(func))&&1===handlers.length?(entry&&entry.uninstall&&entry.uninstall.call(this,type),delete this._callbacks[type]):-1!==index&&handlers.splice(index,1)),this}Base.each(type,function(value,key){this.off(key,value)},this)},once:function(type,func){return this.on(type,function(){func.apply(this,arguments),this.off(type,func)})},emit:function(type,event){var handlers=this._callbacks&&this._callbacks[type];if(!handlers)return!1;for(var args=[].slice.call(arguments,1),i=0,l=(handlers=handlers.slice()).length;i<l;i++)if(!1===handlers[i].apply(this,args)){event&&event.stop&&event.stop();break}return!0},responds:function(type){return!(!this._callbacks||!this._callbacks[type])},attach:"#on",detach:"#off",fire:"#emit",_installEvents:function(install){var handlers=this._callbacks,key=install?"install":"uninstall";for(var type in handlers)if(handlers[type].length>0){var types=this._eventTypes,entry=types&&types[type],func=entry&&entry[key];func&&func.call(this,type)}},statics:{inject:function inject(src){var events=src._events;if(events){var types={};Base.each(events,function(entry,key){var isString="string"==typeof entry,name=isString?entry:key,part=Base.capitalize(name),type=name.substring(2).toLowerCase();types[type]=isString?{}:entry,name="_"+name,src["get"+part]=function(){return this[name]},src["set"+part]=function(func){var prev=this[name];prev&&this.off(type,prev),func&&this.on(type,func),this[name]=func}}),src._eventTypes=types}return inject.base.apply(this,arguments)}}},PaperScope=Base.extend({_class:"PaperScope",initialize:function PaperScope(){paper=this,this.settings=new Base({applyMatrix:!0,handleSize:4,hitTolerance:0}),this.project=null,this.projects=[],this.tools=[],this.palettes=[],this._id=PaperScope._id++,PaperScope._scopes[this._id]=this;var proto=PaperScope.prototype;if(!this.support){var ctx=CanvasProvider.getContext(1,1);proto.support={nativeDash:"setLineDash"in ctx||"mozDash"in ctx,nativeBlendModes:BlendMode.nativeModes},CanvasProvider.release(ctx)}if(!this.browser){var agent=navigator.userAgent.toLowerCase(),platform=(/(win)/.exec(agent)||/(mac)/.exec(agent)||/(linux)/.exec(agent)||[])[0],browser=proto.browser={platform:platform};platform&&(browser[platform]=!0),agent.replace(/(opera|chrome|safari|webkit|firefox|msie|trident|atom)\/?\s*([.\d]+)(?:.*version\/([.\d]+))?(?:.*rv\:([.\d]+))?/g,function(all,n,v1,v2,rv){if(!browser.chrome){var v="opera"===n?v2:v1;"trident"===n&&(v=rv,n="msie"),browser.version=v,browser.versionNumber=parseFloat(v),browser.name=n,browser[n]=!0}}),browser.chrome&&delete browser.webkit,browser.atom&&delete browser.chrome}},version:"0.9.25",getView:function(){return this.project&&this.project.getView()},getPaper:function(){return this},execute:function(code,url,options){paper.PaperScript.execute(code,this,url,options),View.updateFocus()},install:function(scope){var that=this;for(var key in Base.each(["project","view","tool"],function(key){Base.define(scope,key,{configurable:!0,get:function(){return that[key]}})}),this)!/^_/.test(key)&&this[key]&&(scope[key]=this[key])},setup:function(element){return paper=this,this.project=new Project(element),this},activate:function(){paper=this},clear:function(){for(var i=this.projects.length-1;i>=0;i--)this.projects[i].remove();for(var i=this.tools.length-1;i>=0;i--)this.tools[i].remove();for(var i=this.palettes.length-1;i>=0;i--)this.palettes[i].remove()},remove:function(){this.clear(),delete PaperScope._scopes[this._id]},statics:new function(){function handleAttribute(name){return name+="Attribute",function(el,attr){return el[name](attr)||el[name]("data-paper-"+attr)}}return{_scopes:{},_id:0,get:function(id){return this._scopes[id]||null},getAttribute:handleAttribute("get"),hasAttribute:handleAttribute("has")}}}),PaperScopeItem=Base.extend(Emitter,{initialize:function(activate){this._scope=paper,this._index=this._scope[this._list].push(this)-1,!activate&&this._scope[this._reference]||this.activate()},activate:function(){if(!this._scope)return!1;var prev=this._scope[this._reference];return prev&&prev!==this&&prev.emit("deactivate"),this._scope[this._reference]=this,this.emit("activate",prev),!0},isActive:function(){return this._scope[this._reference]===this},remove:function(){return null!=this._index&&(Base.splice(this._scope[this._list],null,this._index,1),this._scope[this._reference]==this&&(this._scope[this._reference]=null),this._scope=null,!0)}}),Formatter=Base.extend({initialize:function(precision){this.precision=precision||5,this.multiplier=Math.pow(10,this.precision)},number:function(val){return Math.round(val*this.multiplier)/this.multiplier},pair:function(val1,val2,separator){return this.number(val1)+(separator||",")+this.number(val2)},point:function(val,separator){return this.number(val.x)+(separator||",")+this.number(val.y)},size:function(val,separator){return this.number(val.width)+(separator||",")+this.number(val.height)},rectangle:function(val,separator){return this.point(val,separator)+(separator||",")+this.size(val,separator)}});Formatter.instance=new Formatter;var Numerical=new function(){var abscissas=[[.5773502691896257],[0,.7745966692414834],[.33998104358485626,.8611363115940526],[0,.5384693101056831,.906179845938664],[.2386191860831969,.6612093864662645,.932469514203152],[0,.4058451513773972,.7415311855993945,.9491079123427585],[.1834346424956498,.525532409916329,.7966664774136267,.9602898564975363],[0,.3242534234038089,.6133714327005904,.8360311073266358,.9681602395076261],[.14887433898163122,.4333953941292472,.6794095682990244,.8650633666889845,.9739065285171717],[0,.26954315595234496,.5190961292068118,.7301520055740494,.8870625997680953,.978228658146057],[.1252334085114689,.3678314989981802,.5873179542866175,.7699026741943047,.9041172563704749,.9815606342467192],[0,.2304583159551348,.44849275103644687,.6423493394403402,.8015780907333099,.9175983992229779,.9841830547185881],[.10805494870734367,.31911236892788974,.5152486363581541,.6872929048116855,.827201315069765,.9284348836635735,.9862838086968123],[0,.20119409399743451,.3941513470775634,.5709721726085388,.7244177313601701,.8482065834104272,.937273392400706,.9879925180204854],[.09501250983763744,.2816035507792589,.45801677765722737,.6178762444026438,.755404408355003,.8656312023878318,.9445750230732326,.9894009349916499]],weights=[[1],[.8888888888888888,.5555555555555556],[.6521451548625461,.34785484513745385],[.5688888888888889,.47862867049936647,.23692688505618908],[.46791393457269104,.3607615730481386,.17132449237917036],[.4179591836734694,.3818300505051189,.27970539148927664,.1294849661688697],[.362683783378362,.31370664587788727,.22238103445337448,.10122853629037626],[.3302393550012598,.31234707704000286,.26061069640293544,.1806481606948574,.08127438836157441],[.29552422471475287,.26926671930999635,.21908636251598204,.1494513491505806,.06667134430868814],[.2729250867779006,.26280454451024665,.23319376459199048,.18629021092773426,.1255803694649046,.05566856711617366],[.24914704581340277,.2334925365383548,.20316742672306592,.16007832854334622,.10693932599531843,.04717533638651183],[.2325515532308739,.22628318026289723,.2078160475368885,.17814598076194574,.13887351021978725,.09212149983772845,.04048400476531588],[.2152638534631578,.2051984637212956,.18553839747793782,.15720316715819355,.12151857068790319,.08015808715976021,.03511946033175186],[.2025782419255613,.19843148532711158,.1861610000155622,.16626920581699392,.13957067792615432,.10715922046717194,.07036604748810812,.03075324199611727],[.1894506104550685,.18260341504492358,.16915651939500254,.14959598881657674,.12462897125553388,.09515851168249279,.062253523938647894,.027152459411754096]],abs=Math.abs,sqrt=Math.sqrt,pow=Math.pow,EPSILON=1e-12,MACHINE_EPSILON=1.12e-16;function clip(value,min,max){return value<min?min:value>max?max:value}return{TOLERANCE:1e-6,EPSILON:1e-12,MACHINE_EPSILON:1.12e-16,CURVETIME_EPSILON:4e-7,GEOMETRIC_EPSILON:2e-7,WINDING_EPSILON:2e-7,TRIGONOMETRIC_EPSILON:1e-7,CLIPPING_EPSILON:1e-7,KAPPA:4*(sqrt(2)-1)/3,isZero:function(val){return val>=-1e-12&&val<=1e-12},integrate:function(f,a,b,n){for(var x=abscissas[n-2],w=weights[n-2],A=.5*(b-a),B=A+a,i=0,m=n+1>>1,sum=1&n?w[i++]*f(B):0;i<m;){var Ax=A*x[i];sum+=w[i++]*(f(B+Ax)+f(B-Ax))}return A*sum},findRoot:function(f,df,x,a,b,n,tolerance){for(var i=0;i<n;i++){var fx=f(x),dx=fx/df(x),nx=x-dx;if(abs(dx)<tolerance)return nx;fx>0?(b=x,x=nx<=a?.5*(a+b):nx):(a=x,x=nx>=b?.5*(a+b):nx)}return x},solveQuadratic:function(a,b,c,roots,min,max){var count=0,eMin=min-1e-12,eMax=max+1e-12,x1,x2=1/0,B=b,D;if(0!==(D=(b/=-2)*b-a*c)&&abs(D)<1.12e-16){var gmC=pow(abs(a*b*c),1/3);if(gmC<1e-8){var mult=pow(10,abs(Math.floor(Math.log(gmC)*Math.LOG10E)));isFinite(mult)||(mult=0),D=(b*=mult)*b-(a*=mult)*(c*=mult)}}if(abs(a)<1e-12){if(abs(B)<1e-12)return abs(c)<1e-12?-1:0;x1=-c/B}else if(D>=-1.12e-16){var Q=D<0?0:sqrt(D),R=b+(b<0?-Q:Q);0===R?x2=-(x1=c/a):(x1=R/a,x2=c/R)}return isFinite(x1)&&(null==min||x1>eMin&&x1<eMax)&&(roots[count++]=null==min?x1:clip(x1,min,max)),x2!==x1&&isFinite(x2)&&(null==min||x2>eMin&&x2<eMax)&&(roots[count++]=null==min?x2:clip(x2,min,max)),count},solveCubic:function(a,b,c,d,roots,min,max){var count=0,x,b1,c2;if(abs(a)<1e-12)a=b,b1=c,c2=d,x=1/0;else if(abs(d)<1e-12)b1=b,c2=c,x=0;else{var ec=1+1.12e-16,x0,q,qd,t,r,s,tmp;if(qd=((tmp=a*(x=-b/a/3))+(b1=tmp+b))*x+(c2=b1*x+c),r=pow(abs(t=(q=c2*x+d)/a),1/3),(x0=x-(s=t<0?-1:1)*(r=(t=-qd/a)>0?1.3247179572*Math.max(r,sqrt(t)):r))!==x){do{if(q=(c2=(b1=(tmp=a*(x=x0))+b)*x+c)*x+d,(x0=0===(qd=(tmp+b1)*x+c2)?x:x-q/qd/ec)===x){x=x0;break}}while(s*x0>s*x);abs(a)*x*x>abs(d/x)&&(b1=((c2=-d/x)-c)/x)}}var count=Numerical.solveQuadratic(a,b1,c2,roots,min,max);return isFinite(x)&&(0===count||x!==roots[count-1])&&(null==min||x>min-1e-12&&x<max+1e-12)&&(roots[count++]=null==min?x:clip(x,min,max)),count}}},UID={_id:1,_pools:{},get:function(ctor){if(ctor){var name=ctor._class,pool=this._pools[name];return pool||(pool=this._pools[name]={_id:1}),pool._id++}return this._id++}},Point=Base.extend({_class:"Point",_readIndex:!0,initialize:function Point(arg0,arg1){var type=typeof arg0;if("number"===type){var hasY="number"==typeof arg1;this.x=arg0,this.y=hasY?arg1:arg0,this.__read&&(this.__read=hasY?2:1)}else"undefined"===type||null===arg0?(this.x=this.y=0,this.__read&&(this.__read=null===arg0?1:0)):(Array.isArray(arg0)?(this.x=arg0[0],this.y=arg0.length>1?arg0[1]:arg0[0]):null!=arg0.x?(this.x=arg0.x,this.y=arg0.y):null!=arg0.width?(this.x=arg0.width,this.y=arg0.height):null!=arg0.angle?(this.x=arg0.length,this.y=0,this.setAngle(arg0.angle)):(this.x=this.y=0,this.__read&&(this.__read=0)),this.__read&&(this.__read=1))},set:function(x,y){return this.x=x,this.y=y,this},equals:function(point){return this===point||point&&(this.x===point.x&&this.y===point.y||Array.isArray(point)&&this.x===point[0]&&this.y===point[1])||!1},clone:function(){return new Point(this.x,this.y)},toString:function(){var f=Formatter.instance;return"{ x: "+f.number(this.x)+", y: "+f.number(this.y)+" }"},_serialize:function(options){var f=options.formatter;return[f.number(this.x),f.number(this.y)]},getLength:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},setLength:function(length){if(this.isZero()){var angle=this._angle||0;this.set(Math.cos(angle)*length,Math.sin(angle)*length)}else{var scale=length/this.getLength();Numerical.isZero(scale)&&this.getAngle(),this.set(this.x*scale,this.y*scale)}},getAngle:function(){return 180*this.getAngleInRadians.apply(this,arguments)/Math.PI},setAngle:function(angle){this.setAngleInRadians.call(this,angle*Math.PI/180)},getAngleInDegrees:"#getAngle",setAngleInDegrees:"#setAngle",getAngleInRadians:function(){if(arguments.length){var point=Point.read(arguments),div=this.getLength()*point.getLength();if(Numerical.isZero(div))return NaN;var a=this.dot(point)/div;return Math.acos(a<-1?-1:a>1?1:a)}return this.isZero()?this._angle||0:this._angle=Math.atan2(this.y,this.x)},setAngleInRadians:function(angle){if(this._angle=angle,!this.isZero()){var length=this.getLength();this.set(Math.cos(angle)*length,Math.sin(angle)*length)}},getQuadrant:function(){return this.x>=0?this.y>=0?1:4:this.y>=0?2:3}},{beans:!1,getDirectedAngle:function(){var point=Point.read(arguments);return 180*Math.atan2(this.cross(point),this.dot(point))/Math.PI},getDistance:function(){var point=Point.read(arguments),x=point.x-this.x,y=point.y-this.y,d=x*x+y*y,squared;return Base.read(arguments)?d:Math.sqrt(d)},normalize:function(length){length===undefined&&(length=1);var current=this.getLength(),scale=0!==current?length/current:0,point=new Point(this.x*scale,this.y*scale);return scale>=0&&(point._angle=this._angle),point},rotate:function(angle,center){if(0===angle)return this.clone();angle=angle*Math.PI/180;var point=center?this.subtract(center):this,sin=Math.sin(angle),cos=Math.cos(angle);return point=new Point(point.x*cos-point.y*sin,point.x*sin+point.y*cos),center?point.add(center):point},transform:function(matrix){return matrix?matrix._transformPoint(this):this},add:function(){var point=Point.read(arguments);return new Point(this.x+point.x,this.y+point.y)},subtract:function(){var point=Point.read(arguments);return new Point(this.x-point.x,this.y-point.y)},multiply:function(){var point=Point.read(arguments);return new Point(this.x*point.x,this.y*point.y)},divide:function(){var point=Point.read(arguments);return new Point(this.x/point.x,this.y/point.y)},modulo:function(){var point=Point.read(arguments);return new Point(this.x%point.x,this.y%point.y)},negate:function(){return new Point(-this.x,-this.y)},isInside:function(){return Rectangle.read(arguments).contains(this)},isClose:function(){var point=Point.read(arguments),tolerance=Base.read(arguments);return this.getDistance(point)<tolerance},isCollinear:function(){var point=Point.read(arguments);return Point.isCollinear(this.x,this.y,point.x,point.y)},isColinear:"#isCollinear",isOrthogonal:function(){var point=Point.read(arguments);return Point.isOrthogonal(this.x,this.y,point.x,point.y)},isZero:function(){return Numerical.isZero(this.x)&&Numerical.isZero(this.y)},isNaN:function(){return isNaN(this.x)||isNaN(this.y)},dot:function(){var point=Point.read(arguments);return this.x*point.x+this.y*point.y},cross:function(){var point=Point.read(arguments);return this.x*point.y-this.y*point.x},project:function(){var point=Point.read(arguments),scale=point.isZero()?0:this.dot(point)/point.dot(point);return new Point(point.x*scale,point.y*scale)},statics:{min:function(){var point1=Point.read(arguments),point2=Point.read(arguments);return new Point(Math.min(point1.x,point2.x),Math.min(point1.y,point2.y))},max:function(){var point1=Point.read(arguments),point2=Point.read(arguments);return new Point(Math.max(point1.x,point2.x),Math.max(point1.y,point2.y))},random:function(){return new Point(Math.random(),Math.random())},isCollinear:function(x1,y1,x2,y2){return Math.abs(x1*y2-y1*x2)<=1e-7*Math.sqrt((x1*x1+y1*y1)*(x2*x2+y2*y2))},isOrthogonal:function(x1,y1,x2,y2){return Math.abs(x1*x2+y1*y2)<=1e-7*Math.sqrt((x1*x1+y1*y1)*(x2*x2+y2*y2))}}},Base.each(["round","ceil","floor","abs"],function(name){var op=Math[name];this[name]=function(){return new Point(op(this.x),op(this.y))}},{})),LinkedPoint=Point.extend({initialize:function Point(x,y,owner,setter){this._x=x,this._y=y,this._owner=owner,this._setter=setter},set:function(x,y,_dontNotify){return this._x=x,this._y=y,_dontNotify||this._owner[this._setter](this),this},getX:function(){return this._x},setX:function(x){this._x=x,this._owner[this._setter](this)},getY:function(){return this._y},setY:function(y){this._y=y,this._owner[this._setter](this)}}),Size=Base.extend({_class:"Size",_readIndex:!0,initialize:function Size(arg0,arg1){var type=typeof arg0;if("number"===type){var hasHeight="number"==typeof arg1;this.width=arg0,this.height=hasHeight?arg1:arg0,this.__read&&(this.__read=hasHeight?2:1)}else"undefined"===type||null===arg0?(this.width=this.height=0,this.__read&&(this.__read=null===arg0?1:0)):(Array.isArray(arg0)?(this.width=arg0[0],this.height=arg0.length>1?arg0[1]:arg0[0]):null!=arg0.width?(this.width=arg0.width,this.height=arg0.height):null!=arg0.x?(this.width=arg0.x,this.height=arg0.y):(this.width=this.height=0,this.__read&&(this.__read=0)),this.__read&&(this.__read=1))},set:function(width,height){return this.width=width,this.height=height,this},equals:function(size){return size===this||size&&(this.width===size.width&&this.height===size.height||Array.isArray(size)&&this.width===size[0]&&this.height===size[1])||!1},clone:function(){return new Size(this.width,this.height)},toString:function(){var f=Formatter.instance;return"{ width: "+f.number(this.width)+", height: "+f.number(this.height)+" }"},_serialize:function(options){var f=options.formatter;return[f.number(this.width),f.number(this.height)]},add:function(){var size=Size.read(arguments);return new Size(this.width+size.width,this.height+size.height)},subtract:function(){var size=Size.read(arguments);return new Size(this.width-size.width,this.height-size.height)},multiply:function(){var size=Size.read(arguments);return new Size(this.width*size.width,this.height*size.height)},divide:function(){var size=Size.read(arguments);return new Size(this.width/size.width,this.height/size.height)},modulo:function(){var size=Size.read(arguments);return new Size(this.width%size.width,this.height%size.height)},negate:function(){return new Size(-this.width,-this.height)},isZero:function(){return Numerical.isZero(this.width)&&Numerical.isZero(this.height)},isNaN:function(){return isNaN(this.width)||isNaN(this.height)},statics:{min:function(size1,size2){return new Size(Math.min(size1.width,size2.width),Math.min(size1.height,size2.height))},max:function(size1,size2){return new Size(Math.max(size1.width,size2.width),Math.max(size1.height,size2.height))},random:function(){return new Size(Math.random(),Math.random())}}},Base.each(["round","ceil","floor","abs"],function(name){var op=Math[name];this[name]=function(){return new Size(op(this.width),op(this.height))}},{})),LinkedSize=Size.extend({initialize:function Size(width,height,owner,setter){this._width=width,this._height=height,this._owner=owner,this._setter=setter},set:function(width,height,_dontNotify){return this._width=width,this._height=height,_dontNotify||this._owner[this._setter](this),this},getWidth:function(){return this._width},setWidth:function(width){this._width=width,this._owner[this._setter](this)},getHeight:function(){return this._height},setHeight:function(height){this._height=height,this._owner[this._setter](this)}}),Rectangle=Base.extend({_class:"Rectangle",_readIndex:!0,beans:!0,initialize:function Rectangle(arg0,arg1,arg2,arg3){var type=typeof arg0,read=0;if("number"===type?(this.x=arg0,this.y=arg1,this.width=arg2,this.height=arg3,read=4):"undefined"===type||null===arg0?(this.x=this.y=this.width=this.height=0,read=null===arg0?1:0):1===arguments.length&&(Array.isArray(arg0)?(this.x=arg0[0],this.y=arg0[1],this.width=arg0[2],this.height=arg0[3],read=1):arg0.x!==undefined||arg0.width!==undefined?(this.x=arg0.x||0,this.y=arg0.y||0,this.width=arg0.width||0,this.height=arg0.height||0,read=1):arg0.from===undefined&&arg0.to===undefined&&(this.x=this.y=this.width=this.height=0,this._set(arg0),read=1)),!read){var point=Point.readNamed(arguments,"from"),next=Base.peek(arguments);if(this.x=point.x,this.y=point.y,next&&next.x!==undefined||Base.hasNamed(arguments,"to")){var to=Point.readNamed(arguments,"to");this.width=to.x-point.x,this.height=to.y-point.y,this.width<0&&(this.x=to.x,this.width=-this.width),this.height<0&&(this.y=to.y,this.height=-this.height)}else{var size=Size.read(arguments);this.width=size.width,this.height=size.height}read=arguments.__index}this.__read&&(this.__read=read)},set:function(x,y,width,height){return this.x=x,this.y=y,this.width=width,this.height=height,this},clone:function(){return new Rectangle(this.x,this.y,this.width,this.height)},equals:function(rect){var rt=Base.isPlainValue(rect)?Rectangle.read(arguments):rect;return rt===this||rt&&this.x===rt.x&&this.y===rt.y&&this.width===rt.width&&this.height===rt.height||!1},toString:function(){var f=Formatter.instance;return"{ x: "+f.number(this.x)+", y: "+f.number(this.y)+", width: "+f.number(this.width)+", height: "+f.number(this.height)+" }"},_serialize:function(options){var f=options.formatter;return[f.number(this.x),f.number(this.y),f.number(this.width),f.number(this.height)]},getPoint:function(_dontLink){var ctor;return new(_dontLink?Point:LinkedPoint)(this.x,this.y,this,"setPoint")},setPoint:function(){var point=Point.read(arguments);this.x=point.x,this.y=point.y},getSize:function(_dontLink){var ctor;return new(_dontLink?Size:LinkedSize)(this.width,this.height,this,"setSize")},setSize:function(){var size=Size.read(arguments);this._fixX&&(this.x+=(this.width-size.width)*this._fixX),this._fixY&&(this.y+=(this.height-size.height)*this._fixY),this.width=size.width,this.height=size.height,this._fixW=1,this._fixH=1},getLeft:function(){return this.x},setLeft:function(left){this._fixW||(this.width-=left-this.x),this.x=left,this._fixX=0},getTop:function(){return this.y},setTop:function(top){this._fixH||(this.height-=top-this.y),this.y=top,this._fixY=0},getRight:function(){return this.x+this.width},setRight:function(right){this._fixX!==undefined&&1!==this._fixX&&(this._fixW=0),this._fixW?this.x=right-this.width:this.width=right-this.x,this._fixX=1},getBottom:function(){return this.y+this.height},setBottom:function(bottom){this._fixY!==undefined&&1!==this._fixY&&(this._fixH=0),this._fixH?this.y=bottom-this.height:this.height=bottom-this.y,this._fixY=1},getCenterX:function(){return this.x+.5*this.width},setCenterX:function(x){this.x=x-.5*this.width,this._fixX=.5},getCenterY:function(){return this.y+.5*this.height},setCenterY:function(y){this.y=y-.5*this.height,this._fixY=.5},getCenter:function(_dontLink){var ctor;return new(_dontLink?Point:LinkedPoint)(this.getCenterX(),this.getCenterY(),this,"setCenter")},setCenter:function(){var point=Point.read(arguments);return this.setCenterX(point.x),this.setCenterY(point.y),this},getArea:function(){return this.width*this.height},isEmpty:function(){return 0===this.width||0===this.height},contains:function(arg){return arg&&arg.width!==undefined||4==(Array.isArray(arg)?arg:arguments).length?this._containsRectangle(Rectangle.read(arguments)):this._containsPoint(Point.read(arguments))},_containsPoint:function(point){var x=point.x,y=point.y;return x>=this.x&&y>=this.y&&x<=this.x+this.width&&y<=this.y+this.height},_containsRectangle:function(rect){var x=rect.x,y=rect.y;return x>=this.x&&y>=this.y&&x+rect.width<=this.x+this.width&&y+rect.height<=this.y+this.height},intersects:function(){var rect=Rectangle.read(arguments);return rect.x+rect.width>this.x&&rect.y+rect.height>this.y&&rect.x<this.x+this.width&&rect.y<this.y+this.height},touches:function(){var rect=Rectangle.read(arguments);return rect.x+rect.width>=this.x&&rect.y+rect.height>=this.y&&rect.x<=this.x+this.width&&rect.y<=this.y+this.height},intersect:function(){var rect=Rectangle.read(arguments),x1=Math.max(this.x,rect.x),y1=Math.max(this.y,rect.y),x2=Math.min(this.x+this.width,rect.x+rect.width),y2=Math.min(this.y+this.height,rect.y+rect.height);return new Rectangle(x1,y1,x2-x1,y2-y1)},unite:function(){var rect=Rectangle.read(arguments),x1=Math.min(this.x,rect.x),y1=Math.min(this.y,rect.y),x2=Math.max(this.x+this.width,rect.x+rect.width),y2=Math.max(this.y+this.height,rect.y+rect.height);return new Rectangle(x1,y1,x2-x1,y2-y1)},include:function(){var point=Point.read(arguments),x1=Math.min(this.x,point.x),y1=Math.min(this.y,point.y),x2=Math.max(this.x+this.width,point.x),y2=Math.max(this.y+this.height,point.y);return new Rectangle(x1,y1,x2-x1,y2-y1)},expand:function(){var amount=Size.read(arguments),hor=amount.width,ver=amount.height;return new Rectangle(this.x-hor/2,this.y-ver/2,this.width+hor,this.height+ver)},scale:function(hor,ver){return this.expand(this.width*hor-this.width,this.height*(ver===undefined?hor:ver)-this.height)}},Base.each([["Top","Left"],["Top","Right"],["Bottom","Left"],["Bottom","Right"],["Left","Center"],["Top","Center"],["Right","Center"],["Bottom","Center"]],function(parts,index){var part=parts.join(""),xFirst=/^[RL]/.test(part);index>=4&&(parts[1]+=xFirst?"Y":"X");var x=parts[xFirst?0:1],y=parts[xFirst?1:0],getX="get"+x,getY="get"+y,setX="set"+x,setY="set"+y,get,set="set"+part;this["get"+part]=function(_dontLink){var ctor;return new(_dontLink?Point:LinkedPoint)(this[getX](),this[getY](),this,set)},this[set]=function(){var point=Point.read(arguments);this[setX](point.x),this[setY](point.y)}},{beans:!0})),LinkedRectangle=Rectangle.extend({initialize:function Rectangle(x,y,width,height,owner,setter){this.set(x,y,width,height,!0),this._owner=owner,this._setter=setter},set:function(x,y,width,height,_dontNotify){return this._x=x,this._y=y,this._width=width,this._height=height,_dontNotify||this._owner[this._setter](this),this}},new function(){var proto=Rectangle.prototype;return Base.each(["x","y","width","height"],function(key){var part=Base.capitalize(key),internal="_"+key;this["get"+part]=function(){return this[internal]},this["set"+part]=function(value){this[internal]=value,this._dontNotify||this._owner[this._setter](this)}},Base.each(["Point","Size","Center","Left","Top","Right","Bottom","CenterX","CenterY","TopLeft","TopRight","BottomLeft","BottomRight","LeftCenter","TopCenter","RightCenter","BottomCenter"],function(key){var name="set"+key;this[name]=function(){this._dontNotify=!0,proto[name].apply(this,arguments),this._dontNotify=!1,this._owner[this._setter](this)}},{isSelected:function(){return this._owner._boundsSelected},setSelected:function(selected){var owner=this._owner;owner.setSelected&&(owner._boundsSelected=selected,owner.setSelected(selected||owner._selectedSegmentState>0))}}))}),Matrix=Base.extend({_class:"Matrix",initialize:function Matrix(arg){var count=arguments.length,ok=!0;if(6===count?this.set.apply(this,arguments):1===count?arg instanceof Matrix?this.set(arg._a,arg._c,arg._b,arg._d,arg._tx,arg._ty):Array.isArray(arg)?this.set.apply(this,arg):ok=!1:0===count?this.reset():ok=!1,!ok)throw new Error("Unsupported matrix parameters")},set:function(a,c,b,d,tx,ty,_dontNotify){return this._a=a,this._c=c,this._b=b,this._d=d,this._tx=tx,this._ty=ty,_dontNotify||this._changed(),this},_serialize:function(options){return Base.serialize(this.getValues(),options)},_changed:function(){var owner=this._owner;owner&&(owner._applyMatrix?owner.transform(null,!0):owner._changed(9))},clone:function(){return new Matrix(this._a,this._c,this._b,this._d,this._tx,this._ty)},equals:function(mx){return mx===this||mx&&this._a===mx._a&&this._b===mx._b&&this._c===mx._c&&this._d===mx._d&&this._tx===mx._tx&&this._ty===mx._ty||!1},toString:function(){var f=Formatter.instance;return"[["+[f.number(this._a),f.number(this._b),f.number(this._tx)].join(", ")+"], ["+[f.number(this._c),f.number(this._d),f.number(this._ty)].join(", ")+"]]"},reset:function(_dontNotify){return this._a=this._d=1,this._c=this._b=this._tx=this._ty=0,_dontNotify||this._changed(),this},apply:function(recursively,_setApplyMatrix){var owner=this._owner;return!!owner&&(owner.transform(null,!0,Base.pick(recursively,!0),_setApplyMatrix),this.isIdentity())},translate:function(){var point=Point.read(arguments),x=point.x,y=point.y;return this._tx+=x*this._a+y*this._b,this._ty+=x*this._c+y*this._d,this._changed(),this},scale:function(){var scale=Point.read(arguments),center=Point.read(arguments,0,{readNull:!0});return center&&this.translate(center),this._a*=scale.x,this._c*=scale.x,this._b*=scale.y,this._d*=scale.y,center&&this.translate(center.negate()),this._changed(),this},rotate:function(angle){angle*=Math.PI/180;var center=Point.read(arguments,1),x=center.x,y=center.y,cos=Math.cos(angle),sin=Math.sin(angle),tx=x-x*cos+y*sin,ty=y-x*sin-y*cos,a=this._a,b=this._b,c=this._c,d=this._d;return this._a=cos*a+sin*b,this._b=-sin*a+cos*b,this._c=cos*c+sin*d,this._d=-sin*c+cos*d,this._tx+=tx*a+ty*b,this._ty+=tx*c+ty*d,this._changed(),this},shear:function(){var shear=Point.read(arguments),center=Point.read(arguments,0,{readNull:!0});center&&this.translate(center);var a=this._a,c=this._c;return this._a+=shear.y*this._b,this._c+=shear.y*this._d,this._b+=shear.x*a,this._d+=shear.x*c,center&&this.translate(center.negate()),this._changed(),this},skew:function(){var skew=Point.read(arguments),center=Point.read(arguments,0,{readNull:!0}),toRadians=Math.PI/180,shear=new Point(Math.tan(skew.x*toRadians),Math.tan(skew.y*toRadians));return this.shear(shear,center)},concatenate:function(mx){var a1=this._a,b1=this._b,c1=this._c,d1=this._d,a2=mx._a,b2=mx._b,c2=mx._c,d2=mx._d,tx2=mx._tx,ty2=mx._ty;return this._a=a2*a1+c2*b1,this._b=b2*a1+d2*b1,this._c=a2*c1+c2*d1,this._d=b2*c1+d2*d1,this._tx+=tx2*a1+ty2*b1,this._ty+=tx2*c1+ty2*d1,this._changed(),this},preConcatenate:function(mx){var a1=this._a,b1=this._b,c1=this._c,d1=this._d,tx1=this._tx,ty1=this._ty,a2=mx._a,b2=mx._b,c2=mx._c,d2=mx._d,tx2=mx._tx,ty2=mx._ty;return this._a=a2*a1+b2*c1,this._b=a2*b1+b2*d1,this._c=c2*a1+d2*c1,this._d=c2*b1+d2*d1,this._tx=a2*tx1+b2*ty1+tx2,this._ty=c2*tx1+d2*ty1+ty2,this._changed(),this},chain:function(mx){var a1=this._a,b1=this._b,c1=this._c,d1=this._d,tx1=this._tx,ty1=this._ty,a2=mx._a,b2=mx._b,c2=mx._c,d2=mx._d,tx2=mx._tx,ty2=mx._ty;return new Matrix(a2*a1+c2*b1,a2*c1+c2*d1,b2*a1+d2*b1,b2*c1+d2*d1,tx1+tx2*a1+ty2*b1,ty1+tx2*c1+ty2*d1)},isIdentity:function(){return 1===this._a&&0===this._c&&0===this._b&&1===this._d&&0===this._tx&&0===this._ty},orNullIfIdentity:function(){return this.isIdentity()?null:this},isInvertible:function(){return!!this._getDeterminant()},isSingular:function(){return!this._getDeterminant()},transform:function(src,dst,count){return arguments.length<3?this._transformPoint(Point.read(arguments)):this._transformCoordinates(src,dst,count)},_transformPoint:function(point,dest,_dontNotify){var x=point.x,y=point.y;return dest||(dest=new Point),dest.set(x*this._a+y*this._b+this._tx,x*this._c+y*this._d+this._ty,_dontNotify)},_transformCoordinates:function(src,dst,count){for(var i=0,j=0,max=2*count;i<max;){var x=src[i++],y=src[i++];dst[j++]=x*this._a+y*this._b+this._tx,dst[j++]=x*this._c+y*this._d+this._ty}return dst},_transformCorners:function(rect){var x1=rect.x,y1=rect.y,x2=x1+rect.width,y2=y1+rect.height,coords=[x1,y1,x2,y1,x2,y2,x1,y2];return this._transformCoordinates(coords,coords,4)},_transformBounds:function(bounds,dest,_dontNotify){for(var coords=this._transformCorners(bounds),min=coords.slice(0,2),max=min.slice(),i=2;i<8;i++){var val=coords[i],j=1&i;val<min[j]?min[j]=val:val>max[j]&&(max[j]=val)}return dest||(dest=new Rectangle),dest.set(min[0],min[1],max[0]-min[0],max[1]-min[1],_dontNotify)},inverseTransform:function(){return this._inverseTransform(Point.read(arguments))},_getDeterminant:function(){var det=this._a*this._d-this._b*this._c;return isFinite(det)&&!Numerical.isZero(det)&&isFinite(this._tx)&&isFinite(this._ty)?det:null},_inverseTransform:function(point,dest,_dontNotify){var det=this._getDeterminant();if(!det)return null;var x=point.x-this._tx,y=point.y-this._ty;return dest||(dest=new Point),dest.set((x*this._d-y*this._b)/det,(y*this._a-x*this._c)/det,_dontNotify)},decompose:function(){var a=this._a,b=this._b,c=this._c,d=this._d;if(Numerical.isZero(a*d-b*c))return null;var scaleX=Math.sqrt(a*a+b*b),shear=(a/=scaleX)*c+(b/=scaleX)*d;c-=a*shear,d-=b*shear;var scaleY=Math.sqrt(c*c+d*d);return shear/=scaleY,a*(d/=scaleY)<b*(c/=scaleY)&&(a=-a,b=-b,shear=-shear,scaleX=-scaleX),{scaling:new Point(scaleX,scaleY),rotation:180*-Math.atan2(b,a)/Math.PI,shearing:shear}},getValues:function(){return[this._a,this._c,this._b,this._d,this._tx,this._ty]},getTranslation:function(){return new Point(this._tx,this._ty)},getScaling:function(){return(this.decompose()||{}).scaling},getRotation:function(){return(this.decompose()||{}).rotation},inverted:function(){var det=this._getDeterminant();return det&&new Matrix(this._d/det,-this._c/det,-this._b/det,this._a/det,(this._b*this._ty-this._d*this._tx)/det,(this._c*this._tx-this._a*this._ty)/det)},shiftless:function(){return new Matrix(this._a,this._c,this._b,this._d,0,0)},applyToContext:function(ctx){ctx.transform(this._a,this._c,this._b,this._d,this._tx,this._ty)}},Base.each(["a","c","b","d","tx","ty"],function(name){var part=Base.capitalize(name),prop="_"+name;this["get"+part]=function(){return this[prop]},this["set"+part]=function(value){this[prop]=value,this._changed()}},{})),Line=Base.extend({_class:"Line",initialize:function Line(arg0,arg1,arg2,arg3,arg4){var asVector=!1;arguments.length>=4?(this._px=arg0,this._py=arg1,this._vx=arg2,this._vy=arg3,asVector=arg4):(this._px=arg0.x,this._py=arg0.y,this._vx=arg1.x,this._vy=arg1.y,asVector=arg2),asVector||(this._vx-=this._px,this._vy-=this._py)},getPoint:function(){return new Point(this._px,this._py)},getVector:function(){return new Point(this._vx,this._vy)},getLength:function(){return this.getVector().getLength()},intersect:function(line,isInfinite){return Line.intersect(this._px,this._py,this._vx,this._vy,line._px,line._py,line._vx,line._vy,!0,isInfinite)},getSide:function(point,isInfinite){return Line.getSide(this._px,this._py,this._vx,this._vy,point.x,point.y,!0,isInfinite)},getDistance:function(point){return Math.abs(Line.getSignedDistance(this._px,this._py,this._vx,this._vy,point.x,point.y,!0))},isCollinear:function(line){return Point.isCollinear(this._vx,this._vy,line._vx,line._vy)},isOrthogonal:function(line){return Point.isOrthogonal(this._vx,this._vy,line._vx,line._vy)},statics:{intersect:function(p1x,p1y,v1x,v1y,p2x,p2y,v2x,v2y,asVector,isInfinite){asVector||(v1x-=p1x,v1y-=p1y,v2x-=p2x,v2y-=p2y);var cross=v1x*v2y-v1y*v2x;if(!Numerical.isZero(cross)){var dx=p1x-p2x,dy=p1y-p2y,u1=(v2x*dy-v2y*dx)/cross,u2=(v1x*dy-v1y*dx)/cross,epsilon=1e-12,uMin=-1e-12,uMax=1+1e-12;if(isInfinite||uMin<u1&&u1<uMax&&uMin<u2&&u2<uMax)return isInfinite||(u1=u1<=0?0:u1>=1?1:u1),new Point(p1x+u1*v1x,p1y+u1*v1y)}},getSide:function(px,py,vx,vy,x,y,asVector,isInfinite){asVector||(vx-=px,vy-=py);var v2x=x-px,v2y,ccw=v2x*vy-(y-py)*vx;return 0!==ccw||isInfinite||(ccw=(v2x*vx+v2x*vx)/(vx*vx+vy*vy))>=0&&ccw<=1&&(ccw=0),ccw<0?-1:ccw>0?1:0},getSignedDistance:function(px,py,vx,vy,x,y,asVector){return asVector||(vx-=px,vy-=py),0===vx?vy>0?x-px:px-x:0===vy?vx<0?y-py:py-y:((x-px)*vy-(y-py)*vx)/Math.sqrt(vx*vx+vy*vy)}}}),Project=PaperScopeItem.extend({_class:"Project",_list:"projects",_reference:"project",initialize:function Project(element){PaperScopeItem.call(this,!0),this.layers=[],this._activeLayer=null,this.symbols=[],this._currentStyle=new Style(null,null,this),this._view=View.create(this,element||CanvasProvider.getCanvas(1,1)),this._selectedItems={},this._selectedItemCount=0,this._updateVersion=0},_serialize:function(options,dictionary){return Base.serialize(this.layers,options,!0,dictionary)},clear:function(){for(var i=this.layers.length-1;i>=0;i--)this.layers[i].remove();this.symbols=[]},isEmpty:function(){return 0===this.layers.length},remove:function remove(){return!!remove.base.call(this)&&(this._view&&this._view.remove(),!0)},getView:function(){return this._view},getCurrentStyle:function(){return this._currentStyle},setCurrentStyle:function(style){this._currentStyle.initialize(style)},getIndex:function(){return this._index},getOptions:function(){return this._scope.settings},getActiveLayer:function(){return this._activeLayer||new Layer({project:this})},getSelectedItems:function(){var items=[];for(var id in this._selectedItems){var item=this._selectedItems[id];item.isInserted()&&items.push(item)}return items},insertChild:function(index,item,_preserve){return item instanceof Layer?(item._remove(!1,!0),Base.splice(this.layers,[item],index,0),item._setProject(this,!0),this._changes&&item._changed(5),this._activeLayer||(this._activeLayer=item)):item instanceof Item?(this._activeLayer||this.insertChild(index,new Layer(Item.NO_INSERT))).insertChild(index,item,_preserve):item=null,item},addChild:function(item,_preserve){return this.insertChild(undefined,item,_preserve)},_updateSelection:function(item){var id=item._id,selectedItems=this._selectedItems;item._selected?selectedItems[id]!==item&&(this._selectedItemCount++,selectedItems[id]=item):selectedItems[id]===item&&(this._selectedItemCount--,delete selectedItems[id])},selectAll:function(){for(var layers=this.layers,i=0,l=layers.length;i<l;i++)layers[i].setFullySelected(!0)},deselectAll:function(){var selectedItems=this._selectedItems;for(var i in selectedItems)selectedItems[i].setFullySelected(!1)},hitTest:function(){for(var point=Point.read(arguments),options=HitResult.getOptions(Base.read(arguments)),i=this.layers.length-1;i>=0;i--){var res=this.layers[i]._hitTest(point,options);if(res)return res}return null},getItems:function(match){return Item._getItems(this.layers,match)},getItem:function(match){return Item._getItems(this.layers,match,null,null,!0)[0]||null},importJSON:function(json){this.activate();var layer=this._activeLayer;return Base.importJSON(json,layer&&layer.isEmpty()&&layer)},draw:function(ctx,matrix,pixelRatio){this._updateVersion++,ctx.save(),matrix.applyToContext(ctx);for(var param=new Base({offset:new Point(0,0),pixelRatio:pixelRatio,viewMatrix:matrix.isIdentity()?null:matrix,matrices:[new Matrix],updateMatrix:!0}),i=0,layers=this.layers,l=layers.length;i<l;i++)layers[i].draw(ctx,param);if(ctx.restore(),this._selectedItemCount>0){ctx.save(),ctx.strokeWidth=1;var items=this._selectedItems,size=this._scope.settings.handleSize,version=this._updateVersion;for(var id in items)items[id]._drawSelection(ctx,matrix,size,items,version);ctx.restore()}}}),Symbol=Base.extend({_class:"Symbol",initialize:function Symbol(item,dontCenter){this._id=UID.get(),this.project=paper.project,this.project.symbols.push(this),item&&this.setDefinition(item,dontCenter)},_serialize:function(options,dictionary){return dictionary.add(this,function(){return Base.serialize([this._class,this._definition],options,!1,dictionary)})},_changed:function(flags){8&flags&&Item._clearBoundsCache(this),1&flags&&(this.project._needsUpdate=!0)},getDefinition:function(){return this._definition},setDefinition:function(item,_dontCenter){item._parentSymbol&&(item=item.clone()),this._definition&&(this._definition._parentSymbol=null),this._definition=item,item.remove(),item.setSelected(!1),_dontCenter||item.setPosition(new Point),item._parentSymbol=this,this._changed(9)},place:function(position){return new PlacedSymbol(this,position)},clone:function(){return new Symbol(this._definition.clone(!1))},equals:function(symbol){return symbol===this||symbol&&this.definition.equals(symbol.definition)||!1}}),Item=Base.extend(Emitter,{statics:{extend:function extend(src){return src._serializeFields&&(src._serializeFields=new Base(this.prototype._serializeFields,src._serializeFields)),extend.base.apply(this,arguments)},NO_INSERT:{insert:!1}},_class:"Item",_applyMatrix:!0,_canApplyMatrix:!0,_boundsSelected:!1,_selectChildren:!1,_serializeFields:{name:null,applyMatrix:null,matrix:new Matrix,pivot:null,locked:!1,visible:!0,blendMode:"normal",opacity:1,guide:!1,selected:!1,clipMask:!1,data:{}},initialize:function Item(){},_initialize:function(props,point){var hasProps=props&&Base.isPlainObject(props),internal=hasProps&&!0===props.internal,matrix=this._matrix=new Matrix,project=hasProps&&props.project||paper.project;return internal||(this._id=UID.get()),this._applyMatrix=this._canApplyMatrix&&paper.settings.applyMatrix,point&&matrix.translate(point),matrix._owner=this,this._style=new Style(project._currentStyle,this,project),this._project||(internal||hasProps&&!1===props.insert?this._setProject(project):hasProps&&props.parent?this.setParent(props.parent):(project._activeLayer||new Layer).addChild(this)),hasProps&&props!==Item.NO_INSERT&&this._set(props,{insert:!0,project:!0,parent:!0},!0),hasProps},_events:Base.each(["onMouseDown","onMouseUp","onMouseDrag","onClick","onDoubleClick","onMouseMove","onMouseEnter","onMouseLeave"],function(name){this[name]={install:function(type){this.getView()._installEvent(type)},uninstall:function(type){this.getView()._uninstallEvent(type)}}},{onFrame:{install:function(){this.getView()._animateItem(this,!0)},uninstall:function(){this.getView()._animateItem(this,!1)}},onLoad:{}}),_serialize:function(options,dictionary){var props={},that=this;function serialize(fields){for(var key in fields){var value=that[key];Base.equals(value,"leading"===key?1.2*fields.fontSize:fields[key])||(props[key]=Base.serialize(value,options,"data"!==key,dictionary))}}return serialize(this._serializeFields),this instanceof Group||serialize(this._style._defaults),[this._class,props]},_changed:function(flags){var symbol=this._parentSymbol,cacheParent=this._parent||symbol,project=this._project;if(8&flags&&(this._bounds=this._position=this._decomposed=this._globalMatrix=this._currentPath=undefined),cacheParent&&40&flags&&Item._clearBoundsCache(cacheParent),2&flags&&Item._clearBoundsCache(this),project&&(1&flags&&(project._needsUpdate=!0),project._changes)){var entry=project._changesById[this._id];entry?entry.flags|=flags:(entry={item:this,flags:flags},project._changesById[this._id]=entry,project._changes.push(entry))}symbol&&symbol._changed(flags)},set:function(props){return props&&this._set(props),this},getId:function(){return this._id},getName:function(){return this._name},setName:function(name,unique){if(this._name&&this._removeNamed(),name===+name+"")throw new Error("Names consisting only of numbers are not supported.");var parent=this._parent;if(name&&parent){for(var children=parent._children,namedChildren=parent._namedChildren,orig=name,i=1;unique&&children[name];)name=orig+" "+i++;(namedChildren[name]=namedChildren[name]||[]).push(this),children[name]=this}this._name=name||undefined,this._changed(128)},getStyle:function(){return this._style},setStyle:function(style){this.getStyle().set(style)}},Base.each(["locked","visible","blendMode","opacity","guide"],function(name){var part=Base.capitalize(name),name="_"+name;this["get"+part]=function(){return this[name]},this["set"+part]=function(value){value!=this[name]&&(this[name]=value,this._changed("_locked"===name?128:129))}},{}),{beans:!0,_locked:!1,_visible:!0,_blendMode:"normal",_opacity:1,_guide:!1,isSelected:function(){if(this._selectChildren)for(var children=this._children,i=0,l=children.length;i<l;i++)if(children[i].isSelected())return!0;return this._selected},setSelected:function(selected,noChildren){if(!noChildren&&this._selectChildren)for(var children=this._children,i=0,l=children.length;i<l;i++)children[i].setSelected(selected);(selected=!!selected)^this._selected&&(this._selected=selected,this._project._updateSelection(this),this._changed(129))},_selected:!1,isFullySelected:function(){var children=this._children;if(children&&this._selected){for(var i=0,l=children.length;i<l;i++)if(!children[i].isFullySelected())return!1;return!0}return this._selected},setFullySelected:function(selected){var children=this._children;if(children)for(var i=0,l=children.length;i<l;i++)children[i].setFullySelected(selected);this.setSelected(selected,!0)},isClipMask:function(){return this._clipMask},setClipMask:function(clipMask){this._clipMask!=(clipMask=!!clipMask)&&(this._clipMask=clipMask,clipMask&&(this.setFillColor(null),this.setStrokeColor(null)),this._changed(129),this._parent&&this._parent._changed(1024))},_clipMask:!1,getData:function(){return this._data||(this._data={}),this._data},setData:function(data){this._data=data},getPosition:function(_dontLink){var position=this._position,ctor=_dontLink?Point:LinkedPoint;if(!position){var pivot=this._pivot;position=this._position=pivot?this._matrix._transformPoint(pivot):this.getBounds().getCenter(!0)}return new ctor(position.x,position.y,this,"setPosition")},setPosition:function(){this.translate(Point.read(arguments).subtract(this.getPosition(!0)))},getPivot:function(_dontLink){var pivot=this._pivot,ctor;pivot&&(pivot=new(_dontLink?Point:LinkedPoint)(pivot.x,pivot.y,this,"setPivot"));return pivot},setPivot:function(){this._pivot=Point.read(arguments,0,{clone:!0,readNull:!0}),this._position=undefined},_pivot:null},Base.each(["bounds","strokeBounds","handleBounds","roughBounds","internalBounds","internalRoughBounds"],function(key){var getter="get"+Base.capitalize(key),match=key.match(/^internal(.*)$/),internalGetter=match?"get"+match[1]:null;this[getter]=function(_matrix){var boundsGetter=this._boundsGetter,name=!internalGetter&&("string"==typeof boundsGetter?boundsGetter:boundsGetter&&boundsGetter[getter])||getter,bounds=this._getCachedBounds(name,_matrix,this,internalGetter);return"bounds"===key?new LinkedRectangle(bounds.x,bounds.y,bounds.width,bounds.height,this,"setBounds"):bounds}},{beans:!0,_getBounds:function(getter,matrix,cacheItem){var children=this._children;if(!children||0==children.length)return new Rectangle;Item._updateBoundsCache(this,cacheItem);for(var x1=1/0,x2=-x1,y1=x1,y2=x2,i=0,l=children.length;i<l;i++){var child=children[i];if(child._visible&&!child.isEmpty()){var rect=child._getCachedBounds(getter,matrix&&matrix.chain(child._matrix),cacheItem);x1=Math.min(rect.x,x1),y1=Math.min(rect.y,y1),x2=Math.max(rect.x+rect.width,x2),y2=Math.max(rect.y+rect.height,y2)}}return isFinite(x1)?new Rectangle(x1,y1,x2-x1,y2-y1):new Rectangle},setBounds:function(){var rect=Rectangle.read(arguments),bounds=this.getBounds(),matrix=new Matrix,center=rect.getCenter();matrix.translate(center),rect.width==bounds.width&&rect.height==bounds.height||matrix.scale(0!=bounds.width?rect.width/bounds.width:1,0!=bounds.height?rect.height/bounds.height:1),center=bounds.getCenter(),matrix.translate(-center.x,-center.y),this.transform(matrix)},_getCachedBounds:function(getter,matrix,cacheItem,internalGetter){matrix=matrix&&matrix.orNullIfIdentity();var _matrix=internalGetter?null:this._matrix.orNullIfIdentity(),cache=(!matrix||matrix.equals(_matrix))&&getter;if(Item._updateBoundsCache(this._parent||this._parentSymbol,cacheItem),cache&&this._bounds&&this._bounds[cache])return this._bounds[cache].clone();var bounds=this._getBounds(internalGetter||getter,matrix||_matrix,cacheItem),cached;cache&&(this._bounds||(this._bounds={}),(this._bounds[cache]=bounds.clone())._internal=!!internalGetter);return bounds},statics:{_updateBoundsCache:function(parent,item){if(parent){var id=item._id,ref=parent._boundsCache=parent._boundsCache||{ids:{},list:[]};ref.ids[id]||(ref.list.push(item),ref.ids[id]=item)}},_clearBoundsCache:function(item){var cache=item._boundsCache;if(cache){item._bounds=item._position=item._boundsCache=undefined;for(var i=0,list=cache.list,l=list.length;i<l;i++){var other=list[i];other!==item&&(other._bounds=other._position=undefined,other._boundsCache&&Item._clearBoundsCache(other))}}}}}),{beans:!0,_decompose:function(){return this._decomposed=this._matrix.decompose()},getRotation:function(){var decomposed=this._decomposed||this._decompose();return decomposed&&decomposed.rotation},setRotation:function(rotation){var current=this.getRotation();if(null!=current&&null!=rotation){var decomposed=this._decomposed;this.rotate(rotation-current),decomposed.rotation=rotation,this._decomposed=decomposed}},getScaling:function(_dontLink){var decomposed=this._decomposed||this._decompose(),scaling=decomposed&&decomposed.scaling,ctor;return scaling&&new(_dontLink?Point:LinkedPoint)(scaling.x,scaling.y,this,"setScaling")},setScaling:function(){var current=this.getScaling();if(current){var scaling=Point.read(arguments,0,{clone:!0}),decomposed=this._decomposed;this.scale(scaling.x/current.x,scaling.y/current.y),decomposed.scaling=scaling,this._decomposed=decomposed}},getMatrix:function(){return this._matrix},setMatrix:function(){var matrix=this._matrix;matrix.initialize.apply(matrix,arguments),this._applyMatrix?this.transform(null,!0):this._changed(9)},getGlobalMatrix:function(_dontClone){var matrix=this._globalMatrix,updateVersion=this._project._updateVersion;if(matrix&&matrix._updateVersion!==updateVersion&&(matrix=null),!matrix){matrix=this._globalMatrix=this._matrix.clone();var parent=this._parent;parent&&matrix.preConcatenate(parent.getGlobalMatrix(!0)),matrix._updateVersion=updateVersion}return _dontClone?matrix:matrix.clone()},getApplyMatrix:function(){return this._applyMatrix},setApplyMatrix:function(apply){(this._applyMatrix=this._canApplyMatrix&&!!apply)&&this.transform(null,!0)},getTransformContent:"#getApplyMatrix",setTransformContent:"#setApplyMatrix"},{getProject:function(){return this._project},_setProject:function(project,installEvents){if(this._project!==project){this._project&&this._installEvents(!1),this._project=project;for(var children=this._children,i=0,l=children&&children.length;i<l;i++)children[i]._setProject(project);installEvents=!0}installEvents&&this._installEvents(!0)},getView:function(){return this._project.getView()},_installEvents:function _installEvents(install){_installEvents.base.call(this,install);for(var children=this._children,i=0,l=children&&children.length;i<l;i++)children[i]._installEvents(install)},getLayer:function(){for(var parent=this;parent=parent._parent;)if(parent instanceof Layer)return parent;return null},getParent:function(){return this._parent},setParent:function(item){return item.addChild(this)},getChildren:function(){return this._children},setChildren:function(items){this.removeChildren(),this.addChildren(items)},getFirstChild:function(){return this._children&&this._children[0]||null},getLastChild:function(){return this._children&&this._children[this._children.length-1]||null},getNextSibling:function(){return this._parent&&this._parent._children[this._index+1]||null},getPreviousSibling:function(){return this._parent&&this._parent._children[this._index-1]||null},getIndex:function(){return this._index},equals:function(item){return item===this||item&&this._class===item._class&&this._style.equals(item._style)&&this._matrix.equals(item._matrix)&&this._locked===item._locked&&this._visible===item._visible&&this._blendMode===item._blendMode&&this._opacity===item._opacity&&this._clipMask===item._clipMask&&this._guide===item._guide&&this._equals(item)||!1},_equals:function(item){return Base.equals(this._children,item._children)},clone:function(insert){return this._clone(new this.constructor(Item.NO_INSERT),insert)},_clone:function(copy,insert,includeMatrix){var keys=["_locked","_visible","_blendMode","_opacity","_clipMask","_guide"],children=this._children;copy.setStyle(this._style);for(var i=0,l=children&&children.length;i<l;i++)copy.addChild(children[i].clone(!1),!0);for(var i=0,l=keys.length;i<l;i++){var key=keys[i];this.hasOwnProperty(key)&&(copy[key]=this[key])}return!1!==includeMatrix&&copy._matrix.initialize(this._matrix),copy.setApplyMatrix(this._applyMatrix),copy.setPivot(this._pivot),copy.setSelected(this._selected),copy._data=this._data?Base.clone(this._data):null,(insert||insert===undefined)&&copy.insertAbove(this),this._name&&copy.setName(this._name,!0),copy},copyTo:function(itemOrProject){return itemOrProject.addChild(this.clone(!1))},rasterize:function(resolution){var bounds=this.getStrokeBounds(),scale=(resolution||this.getView().getResolution())/72,topLeft=bounds.getTopLeft().floor(),bottomRight=bounds.getBottomRight().ceil(),size=new Size(bottomRight.subtract(topLeft)),canvas=CanvasProvider.getCanvas(size.multiply(scale)),ctx=canvas.getContext("2d"),matrix=(new Matrix).scale(scale).translate(topLeft.negate());ctx.save(),matrix.applyToContext(ctx),this.draw(ctx,new Base({matrices:[matrix]})),ctx.restore();var raster=new Raster(Item.NO_INSERT);return raster.setCanvas(canvas),raster.transform((new Matrix).translate(topLeft.add(size.divide(2))).scale(1/scale)),raster.insertAbove(this),raster},contains:function(){return!!this._contains(this._matrix._inverseTransform(Point.read(arguments)))},_contains:function(point){if(this._children){for(var i=this._children.length-1;i>=0;i--)if(this._children[i].contains(point))return!0;return!1}return point.isInside(this.getInternalBounds())},isInside:function(){return Rectangle.read(arguments).contains(this.getBounds())},_asPathItem:function(){return new Path.Rectangle({rectangle:this.getInternalBounds(),matrix:this._matrix,insert:!1})},intersects:function(item,_matrix){return item instanceof Item&&this._asPathItem().getIntersections(item._asPathItem(),null,_matrix||item._matrix,!0).length>0},hitTest:function(){return this._hitTest(Point.read(arguments),HitResult.getOptions(Base.read(arguments)))},_hitTest:function(point,options){if(this._locked||!this._visible||this._guide&&!options.guides||this.isEmpty())return null;var matrix=this._matrix,parentTotalMatrix=options._totalMatrix,view=this.getView(),totalMatrix=options._totalMatrix=parentTotalMatrix?parentTotalMatrix.chain(matrix):this.getGlobalMatrix().preConcatenate(view._matrix),tolerancePadding=options._tolerancePadding=new Size(Path._getPenPadding(1,totalMatrix.inverted())).multiply(Math.max(options.tolerance,1e-6));if(point=matrix._inverseTransform(point),!this._children&&!this.getInternalRoughBounds().expand(tolerancePadding.multiply(2))._containsPoint(point))return null;var checkSelf=!(options.guides&&!this._guide||options.selected&&!this._selected||options.type&&options.type!==Base.hyphenate(this._class)||options.class&&!(this instanceof options.class)),that=this,res;function checkBounds(type,part){var pt=bounds["get"+part]();if(point.subtract(pt).divide(tolerancePadding).length<=1)return new HitResult(type,that,{name:Base.hyphenate(part),point:pt})}if(checkSelf&&(options.center||options.bounds)&&this._parent){var bounds=this.getInternalBounds();if(options.center&&(res=checkBounds("center","Center")),!res&&options.bounds)for(var points=["TopLeft","TopRight","BottomLeft","BottomRight","LeftCenter","TopCenter","RightCenter","BottomCenter"],i=0;i<8&&!res;i++)res=checkBounds("bounds",points[i])}var children=!res&&this._children;if(children)for(var opts=this._getChildHitTestOptions(options),i=children.length-1;i>=0&&!res;i--)res=children[i]._hitTest(point,opts);return!res&&checkSelf&&(res=this._hitTestSelf(point,options)),res&&res.point&&(res.point=matrix.transform(res.point)),options._totalMatrix=parentTotalMatrix,res},_getChildHitTestOptions:function(options){return options},_hitTestSelf:function(point,options){if(options.fill&&this.hasFill()&&this._contains(point))return new HitResult("fill",this)},matches:function(name,compare){function matchObject(obj1,obj2){for(var i in obj1)if(obj1.hasOwnProperty(i)){var val1=obj1[i],val2=obj2[i];if(Base.isPlainObject(val1)&&Base.isPlainObject(val2)){if(!matchObject(val1,val2))return!1}else if(!Base.equals(val1,val2))return!1}return!0}var type=typeof name;if("object"===type){for(var key in name)if(name.hasOwnProperty(key)&&!this.matches(key,name[key]))return!1}else{if("function"===type)return name(this);var value=/^(empty|editable)$/.test(name)?this["is"+Base.capitalize(name)]():"type"===name?Base.hyphenate(this._class):this[name];if(/^(constructor|class)$/.test(name)){if(!(this instanceof compare))return!1}else if(compare instanceof RegExp){if(!compare.test(value))return!1}else if("function"==typeof compare){if(!compare(value))return!1}else if(Base.isPlainObject(compare)){if(!matchObject(compare,value))return!1}else if(!Base.equals(value,compare))return!1}return!0},getItems:function(match){return Item._getItems(this._children,match,this._matrix)},getItem:function(match){return Item._getItems(this._children,match,this._matrix,null,!0)[0]||null},statics:{_getItems:function _getItems(children,match,matrix,param,firstOnly){if(!param&&"object"==typeof match){var overlapping=match.overlapping,inside=match.inside,bounds,rect;param={items:[],inside:!!inside,overlapping:!!overlapping,rect:rect=(bounds=overlapping||inside)&&Rectangle.read([bounds]),path:overlapping&&new Path.Rectangle({rectangle:rect,insert:!1})},bounds&&(match=Base.set({},match,{inside:!0,overlapping:!0}))}var items=param&&param.items,rect;matrix=(rect=param&&param.rect)&&(matrix||new Matrix);for(var i=0,l=children&&children.length;i<l;i++){var child=children[i],childMatrix=matrix&&matrix.chain(child._matrix),add=!0;if(rect){var bounds=child.getBounds(childMatrix);if(!rect.intersects(bounds))continue;param.inside&&rect.contains(bounds)||param.overlapping&&(bounds.contains(rect)||param.path.intersects(child,childMatrix))||(add=!1)}if(add&&child.matches(match)&&(items.push(child),firstOnly))break;if(_getItems(child._children,match,childMatrix,param,firstOnly),firstOnly&&items.length>0)break}return items}}},{importJSON:function(json){var res=Base.importJSON(json,this);return res!==this?this.addChild(res):res},addChild:function(item,_preserve){return this.insertChild(undefined,item,_preserve)},insertChild:function(index,item,_preserve){var res=item?this.insertChildren(index,[item],_preserve):null;return res&&res[0]},addChildren:function(items,_preserve){return this.insertChildren(this._children.length,items,_preserve)},insertChildren:function(index,items,_preserve,_proto){var children=this._children;if(children&&items&&items.length>0){for(var i=(items=Array.prototype.slice.apply(items)).length-1;i>=0;i--){var item=items[i];if(!_proto||item instanceof _proto){var shift=item._parent===this&&item._index<index;item._remove(!1,!0)&&shift&&index--}else items.splice(i,1)}Base.splice(children,items,index,0);for(var project=this._project,notifySelf=project&&project._changes,i=0,l=items.length;i<l;i++){var item;(item=items[i])._parent=this,item._setProject(this._project,!0),item._name&&item.setName(item._name),notifySelf&&this._changed(5)}this._changed(11)}else items=null;return items},_insertSibling:function(index,item,_preserve){return this._parent?this._parent.insertChild(index,item,_preserve):null},insertAbove:function(item,_preserve){return item._insertSibling(item._index+1,this,_preserve)},insertBelow:function(item,_preserve){return item._insertSibling(item._index,this,_preserve)},sendToBack:function(){return(this._parent||this instanceof Layer&&this._project).insertChild(0,this)},bringToFront:function(){return(this._parent||this instanceof Layer&&this._project).addChild(this)},appendTop:"#addChild",appendBottom:function(item){return this.insertChild(0,item)},moveAbove:"#insertAbove",moveBelow:"#insertBelow",reduce:function(){if(this._children&&1===this._children.length){var child=this._children[0].reduce();return child.insertAbove(this),child.setStyle(this._style),this.remove(),child}return this},_removeNamed:function(){var parent=this._parent;if(parent){var children=parent._children,namedChildren=parent._namedChildren,name=this._name,namedArray=namedChildren[name],index=namedArray?namedArray.indexOf(this):-1;-1!==index&&(children[name]==this&&delete children[name],namedArray.splice(index,1),namedArray.length?children[name]=namedArray[namedArray.length-1]:delete namedChildren[name])}},_remove:function(notifySelf,notifyParent){var parent=this._parent;if(parent){if(this._name&&this._removeNamed(),null!=this._index&&Base.splice(parent._children,null,this._index,1),this._installEvents(!1),notifySelf){var project=this._project;project&&project._changes&&this._changed(5)}return notifyParent&&parent._changed(11),this._parent=null,!0}return!1},remove:function(){return this._remove(!0,!0)},replaceWith:function(item){var ok=item&&item.insertBelow(this);return ok&&this.remove(),ok},removeChildren:function(from,to){if(!this._children)return null;from=from||0,to=Base.pick(to,this._children.length);for(var removed=Base.splice(this._children,null,from,to-from),i=removed.length-1;i>=0;i--)removed[i]._remove(!0,!1);return removed.length>0&&this._changed(11),removed},clear:"#removeChildren",reverseChildren:function(){if(this._children){this._children.reverse();for(var i=0,l=this._children.length;i<l;i++)this._children[i]._index=i;this._changed(11)}},isEmpty:function(){return!this._children||0===this._children.length},isEditable:function(){for(var item=this;item;){if(!item._visible||item._locked)return!1;item=item._parent}return!0},hasFill:function(){return this.getStyle().hasFill()},hasStroke:function(){return this.getStyle().hasStroke()},hasShadow:function(){return this.getStyle().hasShadow()},_getOrder:function(item){function getList(item){var list=[];do{list.unshift(item)}while(item=item._parent);return list}for(var list1=getList(this),list2=getList(item),i=0,l=Math.min(list1.length,list2.length);i<l;i++)if(list1[i]!=list2[i])return list1[i]._index<list2[i]._index?1:-1;return 0},hasChildren:function(){return this._children&&this._children.length>0},isInserted:function(){return!!this._parent&&this._parent.isInserted()},isAbove:function(item){return-1===this._getOrder(item)},isBelow:function(item){return 1===this._getOrder(item)},isParent:function(item){return this._parent===item},isChild:function(item){return item&&item._parent===this},isDescendant:function(item){for(var parent=this;parent=parent._parent;)if(parent==item)return!0;return!1},isAncestor:function(item){return!!item&&item.isDescendant(this)},isSibling:function(item){return this._parent===item._parent},isGroupedWith:function(item){for(var parent=this._parent;parent;){if(parent._parent&&/^(Group|Layer|CompoundPath)$/.test(parent._class)&&item.isDescendant(parent))return!0;parent=parent._parent}return!1},translate:function(){var mx=new Matrix;return this.transform(mx.translate.apply(mx,arguments))},rotate:function(angle){return this.transform((new Matrix).rotate(angle,Point.read(arguments,1,{readNull:!0})||this.getPosition(!0)))}},Base.each(["scale","shear","skew"],function(name){this[name]=function(){var point=Point.read(arguments),center=Point.read(arguments,0,{readNull:!0});return this.transform((new Matrix)[name](point,center||this.getPosition(!0)))}},{}),{transform:function(matrix,_applyMatrix,_applyRecursively,_setApplyMatrix){matrix&&matrix.isIdentity()&&(matrix=null);var _matrix=this._matrix,applyMatrix=(_applyMatrix||this._applyMatrix)&&(!_matrix.isIdentity()||matrix||_applyMatrix&&_applyRecursively&&this._children);if(!matrix&&!applyMatrix)return this;if(matrix&&_matrix.preConcatenate(matrix),applyMatrix=applyMatrix&&this._transformContent(_matrix,_applyRecursively,_setApplyMatrix)){var pivot=this._pivot,style=this._style,fillColor=style.getFillColor(!0),strokeColor=style.getStrokeColor(!0);pivot&&_matrix._transformPoint(pivot,pivot,!0),fillColor&&fillColor.transform(_matrix),strokeColor&&strokeColor.transform(_matrix),_matrix.reset(!0),_setApplyMatrix&&this._canApplyMatrix&&(this._applyMatrix=!0)}var bounds=this._bounds,position=this._position;this._changed(9);var decomp=bounds&&matrix&&matrix.decompose();if(decomp&&!decomp.shearing&&decomp.rotation%90==0){for(var key in bounds){var rect=bounds[key];!applyMatrix&&rect._internal||matrix._transformBounds(rect,rect)}var getter=this._boundsGetter,rect;(rect=bounds[getter&&getter.getBounds||getter||"getBounds"])&&(this._position=rect.getCenter(!0)),this._bounds=bounds}else matrix&&position&&(this._position=matrix._transformPoint(position,position));return this},_transformContent:function(matrix,applyRecursively,setApplyMatrix){var children=this._children;if(children){for(var i=0,l=children.length;i<l;i++)children[i].transform(matrix,!0,applyRecursively,setApplyMatrix);return!0}},globalToLocal:function(){return this.getGlobalMatrix(!0)._inverseTransform(Point.read(arguments))},localToGlobal:function(){return this.getGlobalMatrix(!0)._transformPoint(Point.read(arguments))},parentToLocal:function(){return this._matrix._inverseTransform(Point.read(arguments))},localToParent:function(){return this._matrix._transformPoint(Point.read(arguments))},fitBounds:function(rectangle,fill){rectangle=Rectangle.read(arguments);var bounds=this.getBounds(),itemRatio=bounds.height/bounds.width,rectRatio=rectangle.height/rectangle.width,scale=(fill?itemRatio>rectRatio:itemRatio<rectRatio)?rectangle.width/bounds.width:rectangle.height/bounds.height,newBounds=new Rectangle(new Point,new Size(bounds.width*scale,bounds.height*scale));newBounds.setCenter(rectangle.getCenter()),this.setBounds(newBounds)},_setStyles:function(ctx){var style=this._style,fillColor=style.getFillColor(),strokeColor=style.getStrokeColor(),shadowColor=style.getShadowColor();if(fillColor&&(ctx.fillStyle=fillColor.toCanvasStyle(ctx)),strokeColor){var strokeWidth=style.getStrokeWidth();if(strokeWidth>0){ctx.strokeStyle=strokeColor.toCanvasStyle(ctx),ctx.lineWidth=strokeWidth;var strokeJoin=style.getStrokeJoin(),strokeCap=style.getStrokeCap(),miterLimit=style.getMiterLimit();if(strokeJoin&&(ctx.lineJoin=strokeJoin),strokeCap&&(ctx.lineCap=strokeCap),miterLimit&&(ctx.miterLimit=miterLimit),paper.support.nativeDash){var dashArray=style.getDashArray(),dashOffset=style.getDashOffset();dashArray&&dashArray.length&&("setLineDash"in ctx?(ctx.setLineDash(dashArray),ctx.lineDashOffset=dashOffset):(ctx.mozDash=dashArray,ctx.mozDashOffset=dashOffset))}}}if(shadowColor){var shadowBlur=style.getShadowBlur();if(shadowBlur>0){ctx.shadowColor=shadowColor.toCanvasStyle(ctx),ctx.shadowBlur=shadowBlur;var offset=this.getShadowOffset();ctx.shadowOffsetX=offset.x,ctx.shadowOffsetY=offset.y}}},draw:function(ctx,param,parentStrokeMatrix){var updateVersion=this._updateVersion=this._project._updateVersion;if(this._visible&&0!==this._opacity){var matrices=param.matrices,viewMatrix=param.viewMatrix,matrix=this._matrix,globalMatrix=matrices[matrices.length-1].chain(matrix);if(globalMatrix.isInvertible()){matrices.push(globalMatrix),param.updateMatrix&&(globalMatrix._updateVersion=updateVersion,this._globalMatrix=globalMatrix);var blendMode=this._blendMode,opacity=this._opacity,normalBlend="normal"===blendMode,nativeBlend=BlendMode.nativeModes[blendMode],direct=normalBlend&&1===opacity||param.dontStart||param.clip||(nativeBlend||normalBlend&&opacity<1)&&this._canComposite(),pixelRatio=param.pixelRatio||1,mainCtx,itemOffset,prevOffset;if(!direct){var bounds=this.getStrokeBounds(getViewMatrix(globalMatrix));if(!bounds.width||!bounds.height)return;prevOffset=param.offset,itemOffset=param.offset=bounds.getTopLeft().floor(),mainCtx=ctx,ctx=CanvasProvider.getContext(bounds.getSize().ceil().add(1).multiply(pixelRatio)),1!==pixelRatio&&ctx.scale(pixelRatio,pixelRatio)}ctx.save();var strokeMatrix=parentStrokeMatrix?parentStrokeMatrix.chain(matrix):!this.getStrokeScaling(!0)&&getViewMatrix(globalMatrix),clip=!direct&&param.clipItem,transform=!strokeMatrix||clip;if(direct?(ctx.globalAlpha=opacity,nativeBlend&&(ctx.globalCompositeOperation=blendMode)):transform&&ctx.translate(-itemOffset.x,-itemOffset.y),transform&&(direct?matrix:getViewMatrix(globalMatrix)).applyToContext(ctx),clip&&param.clipItem.draw(ctx,param.extend({clip:!0})),strokeMatrix){ctx.setTransform(pixelRatio,0,0,pixelRatio,0,0);var offset=param.offset;offset&&ctx.translate(-offset.x,-offset.y)}this._draw(ctx,param,strokeMatrix),ctx.restore(),matrices.pop(),param.clip&&!param.dontFinish&&ctx.clip(),direct||(BlendMode.process(blendMode,ctx,mainCtx,opacity,itemOffset.subtract(prevOffset).multiply(pixelRatio)),CanvasProvider.release(ctx),param.offset=prevOffset)}}function getViewMatrix(matrix){return viewMatrix?viewMatrix.chain(matrix):matrix}},_isUpdated:function(updateVersion){var parent=this._parent;if(parent instanceof CompoundPath)return parent._isUpdated(updateVersion);var updated=this._updateVersion===updateVersion;return!updated&&parent&&parent._visible&&parent._isUpdated(updateVersion)&&(this._updateVersion=updateVersion,updated=!0),updated},_drawSelection:function(ctx,matrix,size,selectedItems,updateVersion){if((this._drawSelected||this._boundsSelected)&&this._isUpdated(updateVersion)){var color=this.getSelectedColor(!0)||this.getLayer().getSelectedColor(!0),mx=matrix.chain(this.getGlobalMatrix(!0));if(ctx.strokeStyle=ctx.fillStyle=color?color.toCanvasStyle(ctx):"#009dec",this._drawSelected&&this._drawSelected(ctx,mx,selectedItems),this._boundsSelected){var half=size/2,coords=mx._transformCorners(this.getInternalBounds());ctx.beginPath();for(var i=0;i<8;i++)ctx[0===i?"moveTo":"lineTo"](coords[i],coords[++i]);ctx.closePath(),ctx.stroke();for(var i=0;i<8;i++)ctx.fillRect(coords[i]-half,coords[++i]-half,size,size)}}},_canComposite:function(){return!1}},Base.each(["down","drag","up","move"],function(name){this["removeOn"+Base.capitalize(name)]=function(){var hash={};return hash[name]=!0,this.removeOn(hash)}},{removeOn:function(obj){for(var name in obj)if(obj[name]){var key="mouse"+name,project=this._project,sets=project._removeSets=project._removeSets||{};sets[key]=sets[key]||{},sets[key][this._id]=this}return this}})),Group=Item.extend({_class:"Group",_selectChildren:!0,_serializeFields:{children:[]},initialize:function Group(arg){this._children=[],this._namedChildren={},this._initialize(arg)||this.addChildren(Array.isArray(arg)?arg:arguments)},_changed:function _changed(flags){_changed.base.call(this,flags),1026&flags&&(this._clipItem=undefined)},_getClipItem:function(){var clipItem=this._clipItem;if(clipItem===undefined){clipItem=null;for(var i=0,l=this._children.length;i<l;i++){var child=this._children[i];if(child._clipMask){clipItem=child;break}}this._clipItem=clipItem}return clipItem},isClipped:function(){return!!this._getClipItem()},setClipped:function(clipped){var child=this.getFirstChild();child&&child.setClipMask(clipped)},_draw:function(ctx,param){var clip=param.clip,clipItem=!clip&&this._getClipItem(),draw=!0;if(param=param.extend({clipItem:clipItem,clip:!1}),clip?this._currentPath?(ctx.currentPath=this._currentPath,draw=!1):(ctx.beginPath(),param.dontStart=param.dontFinish=!0):clipItem&&clipItem.draw(ctx,param.extend({clip:!0})),draw)for(var i=0,l=this._children.length;i<l;i++){var item=this._children[i];item!==clipItem&&item.draw(ctx,param)}clip&&(this._currentPath=ctx.currentPath)}}),Layer=Group.extend({_class:"Layer",initialize:function Layer(arg){var props=Base.isPlainObject(arg)?new Base(arg):{children:Array.isArray(arg)?arg:arguments},insert=props.insert;props.insert=!1,Group.call(this,props),(insert||insert===undefined)&&(this._project.addChild(this),this.activate())},_remove:function _remove(notifySelf,notifyParent){if(this._parent)return _remove.base.call(this,notifySelf,notifyParent);if(null!=this._index){var project=this._project;return project._activeLayer===this&&(project._activeLayer=this.getNextSibling()||this.getPreviousSibling()),Base.splice(project.layers,null,this._index,1),this._installEvents(!1),notifySelf&&project._changes&&this._changed(5),notifyParent&&(project._needsUpdate=!0),!0}return!1},getNextSibling:function getNextSibling(){return this._parent?getNextSibling.base.call(this):this._project.layers[this._index+1]||null},getPreviousSibling:function getPreviousSibling(){return this._parent?getPreviousSibling.base.call(this):this._project.layers[this._index-1]||null},isInserted:function isInserted(){return this._parent?isInserted.base.call(this):null!=this._index},activate:function(){this._project._activeLayer=this},_insertSibling:function _insertSibling(index,item,_preserve){return this._parent?_insertSibling.base.call(this,index,item,_preserve):this._project.insertChild(index,item,_preserve)}}),Shape=Item.extend({_class:"Shape",_applyMatrix:!1,_canApplyMatrix:!1,_boundsSelected:!0,_serializeFields:{type:null,size:null,radius:null},initialize:function Shape(props){this._initialize(props)},_equals:function(item){return this._type===item._type&&this._size.equals(item._size)&&Base.equals(this._radius,item._radius)},clone:function(insert){var copy=new Shape(Item.NO_INSERT);return copy.setType(this._type),copy.setSize(this._size),copy.setRadius(this._radius),this._clone(copy,insert)},getType:function(){return this._type},setType:function(type){this._type=type},getShape:"#getType",setShape:"#setType",getSize:function(){var size=this._size;return new LinkedSize(size.width,size.height,this,"setSize")},setSize:function(){var size=Size.read(arguments);if(this._size){if(!this._size.equals(size)){var type=this._type,width=size.width,height=size.height;if("rectangle"===type){var radius=Size.min(this._radius,size.divide(2));this._radius.set(radius.width,radius.height)}else"circle"===type?(width=height=(width+height)/2,this._radius=width/2):"ellipse"===type&&this._radius.set(width/2,height/2);this._size.set(width,height),this._changed(9)}}else this._size=size.clone()},getRadius:function(){var rad=this._radius;return"circle"===this._type?rad:new LinkedSize(rad.width,rad.height,this,"setRadius")},setRadius:function(radius){var type=this._type;if("circle"===type){if(radius===this._radius)return;var size=2*radius;this._radius=radius,this._size.set(size,size)}else if(radius=Size.read(arguments),this._radius){if(this._radius.equals(radius))return;if(this._radius.set(radius.width,radius.height),"rectangle"===type){var size=Size.max(this._size,radius.multiply(2));this._size.set(size.width,size.height)}else"ellipse"===type&&this._size.set(2*radius.width,2*radius.height)}else this._radius=radius.clone();this._changed(9)},isEmpty:function(){return!1},toPath:function(insert){var path=this._clone(new(Path[Base.capitalize(this._type)])({center:new Point,size:this._size,radius:this._radius,insert:!1}),insert);return paper.settings.applyMatrix&&path.setApplyMatrix(!0),path},_draw:function(ctx,param,strokeMatrix){var style=this._style,hasFill=style.hasFill(),hasStroke=style.hasStroke(),dontPaint=param.dontFinish||param.clip,untransformed=!strokeMatrix;if(hasFill||hasStroke||dontPaint){var type=this._type,radius=this._radius,isCircle="circle"===type;if(param.dontStart||ctx.beginPath(),untransformed&&isCircle)ctx.arc(0,0,radius,0,2*Math.PI,!0);else{var rx=isCircle?radius:radius.width,ry=isCircle?radius:radius.height,size=this._size,width=size.width,height=size.height;if(untransformed&&"rectangle"===type&&0===rx&&0===ry)ctx.rect(-width/2,-height/2,width,height);else{var x=width/2,y=height/2,kappa=.44771525016920644,cx=rx*kappa,cy=ry*kappa,c=[-x,-y+ry,-x,-y+cy,-x+cx,-y,-x+rx,-y,x-rx,-y,x-cx,-y,x,-y+cy,x,-y+ry,x,y-ry,x,y-cy,x-cx,y,x-rx,y,-x+rx,y,-x+cx,y,-x,y-cy,-x,y-ry];strokeMatrix&&strokeMatrix.transform(c,c,32),ctx.moveTo(c[0],c[1]),ctx.bezierCurveTo(c[2],c[3],c[4],c[5],c[6],c[7]),x!==rx&&ctx.lineTo(c[8],c[9]),ctx.bezierCurveTo(c[10],c[11],c[12],c[13],c[14],c[15]),y!==ry&&ctx.lineTo(c[16],c[17]),ctx.bezierCurveTo(c[18],c[19],c[20],c[21],c[22],c[23]),x!==rx&&ctx.lineTo(c[24],c[25]),ctx.bezierCurveTo(c[26],c[27],c[28],c[29],c[30],c[31])}}ctx.closePath()}dontPaint||!hasFill&&!hasStroke||(this._setStyles(ctx),hasFill&&(ctx.fill(style.getWindingRule()),ctx.shadowColor="rgba(0,0,0,0)"),hasStroke&&ctx.stroke())},_canComposite:function(){return!(this.hasFill()&&this.hasStroke())},_getBounds:function(getter,matrix){var rect=new Rectangle(this._size).setCenter(0,0);return"getBounds"!==getter&&this.hasStroke()&&(rect=rect.expand(this.getStrokeWidth())),matrix?matrix._transformBounds(rect):rect}},new function(){function getCornerCenter(that,point,expand){var radius=that._radius;if(!radius.isZero())for(var halfSize=that._size.divide(2),i=0;i<4;i++){var dir=new Point(1&i?1:-1,i>1?1:-1),corner=dir.multiply(halfSize),center=corner.subtract(dir.multiply(radius)),rect=new Rectangle(corner,center);if((expand?rect.expand(expand):rect).contains(point))return center}}function getEllipseRadius(point,radius){var angle=point.getAngleInRadians(),width=2*radius.width,height=2*radius.height,x=width*Math.sin(angle),y=height*Math.cos(angle);return width*height/(2*Math.sqrt(x*x+y*y))}return{_contains:function _contains(point){if("rectangle"===this._type){var center=getCornerCenter(this,point);return center?point.subtract(center).divide(this._radius).getLength()<=1:_contains.base.call(this,point)}return point.divide(this.size).getLength()<=.5},_hitTestSelf:function _hitTestSelf(point,options){var hit=!1;if(this.hasStroke()){var type=this._type,radius=this._radius,strokeWidth=this.getStrokeWidth()+2*options.tolerance;if("rectangle"===type){var center=getCornerCenter(this,point,strokeWidth);if(center){var pt=point.subtract(center);hit=2*Math.abs(pt.getLength()-getEllipseRadius(pt,radius))<=strokeWidth}else{var rect=new Rectangle(this._size).setCenter(0,0),outer=rect.expand(strokeWidth),inner=rect.expand(-strokeWidth);hit=outer._containsPoint(point)&&!inner._containsPoint(point)}}else"ellipse"===type&&(radius=getEllipseRadius(point,radius)),hit=2*Math.abs(point.getLength()-radius)<=strokeWidth}return hit?new HitResult("stroke",this):_hitTestSelf.base.apply(this,arguments)}}},{statics:new function(){function createShape(type,point,size,radius,args){var item=new Shape(Base.getNamed(args));return item._type=type,item._size=size,item._radius=radius,item.translate(point)}return{Circle:function(){var center=Point.readNamed(arguments,"center"),radius=Base.readNamed(arguments,"radius");return createShape("circle",center,new Size(2*radius),radius,arguments)},Rectangle:function(){var rect=Rectangle.readNamed(arguments,"rectangle"),radius=Size.min(Size.readNamed(arguments,"radius"),rect.getSize(!0).divide(2));return createShape("rectangle",rect.getCenter(!0),rect.getSize(!0),radius,arguments)},Ellipse:function(){var ellipse=Shape._readEllipse(arguments),radius=ellipse.radius;return createShape("ellipse",ellipse.center,radius.multiply(2),radius,arguments)},_readEllipse:function(args){var center,radius;if(Base.hasNamed(args,"radius"))center=Point.readNamed(args,"center"),radius=Size.readNamed(args,"radius");else{var rect=Rectangle.readNamed(args,"rectangle");center=rect.getCenter(!0),radius=rect.getSize(!0).divide(2)}return{center:center,radius:radius}}}}}),Raster=Item.extend({_class:"Raster",_applyMatrix:!1,_canApplyMatrix:!1,_boundsGetter:"getBounds",_boundsSelected:!0,_serializeFields:{crossOrigin:null,source:null},initialize:function Raster(object,position){this._initialize(object,position!==undefined&&Point.read(arguments,1))||("string"==typeof object?this.setSource(object):this.setImage(object)),this._size||(this._size=new Size,this._loaded=!1)},_equals:function(item){return this.getSource()===item.getSource()},clone:function(insert){var copy=new Raster(Item.NO_INSERT),image=this._image,canvas=this._canvas;if(image)copy.setImage(image);else if(canvas){var copyCanvas=CanvasProvider.getCanvas(this._size);copyCanvas.getContext("2d").drawImage(canvas,0,0),copy.setImage(copyCanvas)}return copy._crossOrigin=this._crossOrigin,this._clone(copy,insert)},getSize:function(){var size=this._size;return new LinkedSize(size?size.width:0,size?size.height:0,this,"setSize")},setSize:function(){var size=Size.read(arguments);if(!size.equals(this._size))if(size.width>0&&size.height>0){var element=this.getElement();this.setImage(CanvasProvider.getCanvas(size)),element&&this.getContext(!0).drawImage(element,0,0,size.width,size.height)}else this._canvas&&CanvasProvider.release(this._canvas),this._size=size.clone()},getWidth:function(){return this._size?this._size.width:0},setWidth:function(width){this.setSize(width,this.getHeight())},getHeight:function(){return this._size?this._size.height:0},setHeight:function(height){this.setSize(this.getWidth(),height)},isEmpty:function(){var size=this._size;return!size||0===size.width&&0===size.height},getResolution:function(){var matrix=this._matrix,orig=new Point(0,0).transform(matrix),u=new Point(1,0).transform(matrix).subtract(orig),v=new Point(0,1).transform(matrix).subtract(orig);return new Size(72/u.getLength(),72/v.getLength())},getPpi:"#getResolution",getImage:function(){return this._image},setImage:function(image){this._canvas&&CanvasProvider.release(this._canvas),image&&image.getContext?(this._image=null,this._canvas=image,this._loaded=!0):(this._image=image,this._canvas=null,this._loaded=image&&image.complete),this._size=new Size(image?image.naturalWidth||image.width:0,image?image.naturalHeight||image.height:0),this._context=null,this._changed(521)},getCanvas:function(){if(!this._canvas){var ctx=CanvasProvider.getContext(this._size);try{this._image&&ctx.drawImage(this._image,0,0),this._canvas=ctx.canvas}catch(e){CanvasProvider.release(ctx)}}return this._canvas},setCanvas:"#setImage",getContext:function(modify){return this._context||(this._context=this.getCanvas().getContext("2d")),modify&&(this._image=null,this._changed(513)),this._context},setContext:function(context){this._context=context},getSource:function(){return this._image&&this._image.src||this.toDataURL()},setSource:function(src){var that=this,crossOrigin=this._crossOrigin,image;function loaded(){var view=that.getView();view&&(paper=view._scope,that.setImage(image),that.emit("load"),view.update())}image=document.getElementById(src)||new Image,crossOrigin&&(image.crossOrigin=crossOrigin),image.naturalWidth&&image.naturalHeight?setTimeout(loaded,0):(DomEvent.add(image,{load:loaded}),image.src||(image.src=src)),this.setImage(image)},getCrossOrigin:function(){return this._image&&this._image.crossOrigin||this._crossOrigin||""},setCrossOrigin:function(crossOrigin){this._crossOrigin=crossOrigin,this._image&&(this._image.crossOrigin=crossOrigin)},getElement:function(){return this._canvas||this._loaded&&this._image}},{beans:!1,getSubCanvas:function(){var rect=Rectangle.read(arguments),ctx=CanvasProvider.getContext(rect.getSize());return ctx.drawImage(this.getCanvas(),rect.x,rect.y,rect.width,rect.height,0,0,rect.width,rect.height),ctx.canvas},getSubRaster:function(){var rect=Rectangle.read(arguments),raster=new Raster(Item.NO_INSERT);return raster.setImage(this.getSubCanvas(rect)),raster.translate(rect.getCenter().subtract(this.getSize().divide(2))),raster._matrix.preConcatenate(this._matrix),raster.insertAbove(this),raster},toDataURL:function(){var src=this._image&&this._image.src;if(/^data:/.test(src))return src;var canvas=this.getCanvas();return canvas?canvas.toDataURL.apply(canvas,arguments):null},drawImage:function(image){var point=Point.read(arguments,1);this.getContext(!0).drawImage(image,point.x,point.y)},getAverageColor:function(object){var bounds,path;object?object instanceof PathItem?(path=object,bounds=object.getBounds()):object.width?bounds=new Rectangle(object):object.x&&(bounds=new Rectangle(object.x-.5,object.y-.5,1,1)):bounds=this.getBounds();var sampleSize=32,width=Math.min(bounds.width,32),height=Math.min(bounds.height,32),ctx=Raster._sampleContext;ctx?ctx.clearRect(0,0,33,33):ctx=Raster._sampleContext=CanvasProvider.getContext(new Size(32)),ctx.save();var matrix=(new Matrix).scale(width/bounds.width,height/bounds.height).translate(-bounds.x,-bounds.y);matrix.applyToContext(ctx),path&&path.draw(ctx,new Base({clip:!0,matrices:[matrix]})),this._matrix.applyToContext(ctx);var element=this.getElement(),size=this._size;element&&ctx.drawImage(element,-size.width/2,-size.height/2),ctx.restore();for(var pixels=ctx.getImageData(.5,.5,Math.ceil(width),Math.ceil(height)).data,channels=[0,0,0],total=0,i=0,l=pixels.length;i<l;i+=4){var alpha=pixels[i+3];total+=alpha,alpha/=255,channels[0]+=pixels[i]*alpha,channels[1]+=pixels[i+1]*alpha,channels[2]+=pixels[i+2]*alpha}for(var i=0;i<3;i++)channels[i]/=total;return total?Color.read(channels):null},getPixel:function(){var point=Point.read(arguments),data=this.getContext().getImageData(point.x,point.y,1,1).data;return new Color("rgb",[data[0]/255,data[1]/255,data[2]/255],data[3]/255)},setPixel:function(){var point=Point.read(arguments),color=Color.read(arguments),components=color._convert("rgb"),alpha=color._alpha,ctx=this.getContext(!0),imageData=ctx.createImageData(1,1),data=imageData.data;data[0]=255*components[0],data[1]=255*components[1],data[2]=255*components[2],data[3]=null!=alpha?255*alpha:255,ctx.putImageData(imageData,point.x,point.y)},createImageData:function(){var size=Size.read(arguments);return this.getContext().createImageData(size.width,size.height)},getImageData:function(){var rect=Rectangle.read(arguments);return rect.isEmpty()&&(rect=new Rectangle(this._size)),this.getContext().getImageData(rect.x,rect.y,rect.width,rect.height)},setImageData:function(data){var point=Point.read(arguments,1);this.getContext(!0).putImageData(data,point.x,point.y)},_getBounds:function(getter,matrix){var rect=new Rectangle(this._size).setCenter(0,0);return matrix?matrix._transformBounds(rect):rect},_hitTestSelf:function(point){if(this._contains(point)){var that=this;return new HitResult("pixel",that,{offset:point.add(that._size.divide(2)).round(),color:{get:function(){return that.getPixel(this.offset)}}})}},_draw:function(ctx){var element=this.getElement();element&&(ctx.globalAlpha=this._opacity,ctx.drawImage(element,-this._size.width/2,-this._size.height/2))},_canComposite:function(){return!0}}),PlacedSymbol=Item.extend({_class:"PlacedSymbol",_applyMatrix:!1,_canApplyMatrix:!1,_boundsGetter:{getBounds:"getStrokeBounds"},_boundsSelected:!0,_serializeFields:{symbol:null},initialize:function PlacedSymbol(arg0,arg1){this._initialize(arg0,arg1!==undefined&&Point.read(arguments,1))||this.setSymbol(arg0 instanceof Symbol?arg0:new Symbol(arg0))},_equals:function(item){return this._symbol===item._symbol},getSymbol:function(){return this._symbol},setSymbol:function(symbol){this._symbol=symbol,this._changed(9)},clone:function(insert){var copy=new PlacedSymbol(Item.NO_INSERT);return copy.setSymbol(this._symbol),this._clone(copy,insert)},isEmpty:function(){return this._symbol._definition.isEmpty()},_getBounds:function(getter,matrix,cacheItem){var definition=this.symbol._definition;return definition._getCachedBounds(getter,matrix&&matrix.chain(definition._matrix),cacheItem)},_hitTestSelf:function(point,options){var res=this._symbol._definition._hitTest(point,options);return res&&(res.item=this),res},_draw:function(ctx,param){this.symbol._definition.draw(ctx,param)}}),HitResult=Base.extend({_class:"HitResult",initialize:function HitResult(type,item,values){this.type=type,this.item=item,values&&(values.enumerable=!0,this.inject(values))},statics:{getOptions:function(options){return new Base({type:null,tolerance:paper.settings.hitTolerance,fill:!options,stroke:!options,segments:!options,handles:!1,ends:!1,center:!1,bounds:!1,guides:!1,selected:!1},options)}}}),Segment=Base.extend({_class:"Segment",beans:!0,initialize:function Segment(arg0,arg1,arg2,arg3,arg4,arg5){var count=arguments.length,point,handleIn,handleOut;0===count||(1===count?"point"in arg0?(point=arg0.point,handleIn=arg0.handleIn,handleOut=arg0.handleOut):point=arg0:2===count&&"number"==typeof arg0?point=arguments:count<=3?(point=arg0,handleIn=arg1,handleOut=arg2):(point=arg0!==undefined?[arg0,arg1]:null,handleIn=arg2!==undefined?[arg2,arg3]:null,handleOut=arg4!==undefined?[arg4,arg5]:null)),new SegmentPoint(point,this,"_point"),new SegmentPoint(handleIn,this,"_handleIn"),new SegmentPoint(handleOut,this,"_handleOut")},_serialize:function(options){return Base.serialize(this.hasHandles()?[this._point,this._handleIn,this._handleOut]:this._point,options,!0)},_changed:function(point){var path=this._path;if(path){var curves=path._curves,index=this._index,curve;curves&&(point&&point!==this._point&&point!==this._handleIn||!(curve=index>0?curves[index-1]:path._closed?curves[curves.length-1]:null)||curve._changed(),point&&point!==this._point&&point!==this._handleOut||!(curve=curves[index])||curve._changed()),path._changed(25)}},getPoint:function(){return this._point},setPoint:function(){var point=Point.read(arguments);this._point.set(point.x,point.y)},getHandleIn:function(){return this._handleIn},setHandleIn:function(){var point=Point.read(arguments);this._handleIn.set(point.x,point.y)},getHandleOut:function(){return this._handleOut},setHandleOut:function(){var point=Point.read(arguments);this._handleOut.set(point.x,point.y)},hasHandles:function(){return!this._handleIn.isZero()||!this._handleOut.isZero()},clearHandles:function(){this._handleIn.set(0,0),this._handleOut.set(0,0)},_selectionState:0,isSelected:function(_point){var state=this._selectionState;return _point?_point===this._point?!!(4&state):_point===this._handleIn?!!(1&state):_point===this._handleOut&&!!(2&state):!!(7&state)},setSelected:function(selected,_point){var path=this._path,selected=!!selected,state=this._selectionState,oldState=state,flag=_point?_point===this._point?4:_point===this._handleIn?1:_point===this._handleOut?2:0:7;selected?state|=flag:state&=~flag,this._selectionState=state,path&&state!==oldState&&(path._updateSelection(this,oldState,state),path._changed(129))},getIndex:function(){return this._index!==undefined?this._index:null},getPath:function(){return this._path||null},getCurve:function(){var path=this._path,index=this._index;return path?(index>0&&!path._closed&&index===path._segments.length-1&&index--,path.getCurves()[index]||null):null},getLocation:function(){var curve=this.getCurve();return curve?new CurveLocation(curve,this===curve._segment1?0:1):null},getNext:function(){var segments=this._path&&this._path._segments;return segments&&(segments[this._index+1]||this._path._closed&&segments[0])||null},getPrevious:function(){var segments=this._path&&this._path._segments;return segments&&(segments[this._index-1]||this._path._closed&&segments[segments.length-1])||null},isFirst:function(){return 0===this._index},isLast:function(){var path=this._path;return path&&this._index===path._segments.length-1||!1},reverse:function(){var handleIn=this._handleIn,handleOut=this._handleOut,inX=handleIn._x,inY=handleIn._y;handleIn.set(handleOut._x,handleOut._y),handleOut.set(inX,inY)},reversed:function(){return new Segment(this._point,this._handleOut,this._handleIn)},remove:function(){return!!this._path&&!!this._path.removeSegment(this._index)},clone:function(){return new Segment(this._point,this._handleIn,this._handleOut)},equals:function(segment){return segment===this||segment&&this._class===segment._class&&this._point.equals(segment._point)&&this._handleIn.equals(segment._handleIn)&&this._handleOut.equals(segment._handleOut)||!1},toString:function(){var parts=["point: "+this._point];return this._handleIn.isZero()||parts.push("handleIn: "+this._handleIn),this._handleOut.isZero()||parts.push("handleOut: "+this._handleOut),"{ "+parts.join(", ")+" }"},transform:function(matrix){this._transformCoordinates(matrix,new Array(6),!0),this._changed()},_transformCoordinates:function(matrix,coords,change){var point=this._point,handleIn=change&&this._handleIn.isZero()?null:this._handleIn,handleOut=change&&this._handleOut.isZero()?null:this._handleOut,x=point._x,y=point._y,i=2;return coords[0]=x,coords[1]=y,handleIn&&(coords[i++]=handleIn._x+x,coords[i++]=handleIn._y+y),handleOut&&(coords[i++]=handleOut._x+x,coords[i++]=handleOut._y+y),matrix&&(matrix._transformCoordinates(coords,coords,i/2),x=coords[0],y=coords[1],change?(point._x=x,point._y=y,i=2,handleIn&&(handleIn._x=coords[i++]-x,handleIn._y=coords[i++]-y),handleOut&&(handleOut._x=coords[i++]-x,handleOut._y=coords[i++]-y)):(handleIn||(coords[i++]=x,coords[i++]=y),handleOut||(coords[i++]=x,coords[i++]=y))),coords}}),SegmentPoint=Point.extend({initialize:function SegmentPoint(point,owner,key){var x,y,selected;if(point)if((x=point[0])!==undefined)y=point[1];else{var pt=point;(x=pt.x)===undefined&&(x=(pt=Point.read(arguments)).x),y=pt.y,selected=pt.selected}else x=y=0;this._x=x,this._y=y,this._owner=owner,owner[key]=this,selected&&this.setSelected(!0)},set:function(x,y){return this._x=x,this._y=y,this._owner._changed(this),this},_serialize:function(options){var f=options.formatter,x=f.number(this._x),y=f.number(this._y);return this.isSelected()?{x:x,y:y,selected:!0}:[x,y]},getX:function(){return this._x},setX:function(x){this._x=x,this._owner._changed(this)},getY:function(){return this._y},setY:function(y){this._y=y,this._owner._changed(this)},isZero:function(){return Numerical.isZero(this._x)&&Numerical.isZero(this._y)},setSelected:function(selected){this._owner.setSelected(selected,this)},isSelected:function(){return this._owner.isSelected(this)}}),Curve=Base.extend({_class:"Curve",initialize:function Curve(arg0,arg1,arg2,arg3,arg4,arg5,arg6,arg7){var count=arguments.length,seg1,seg2,point1,point2,handle1,handle2;3===count?(this._path=arg0,seg1=arg1,seg2=arg2):0===count?(seg1=new Segment,seg2=new Segment):1===count?"segment1"in arg0?(seg1=new Segment(arg0.segment1),seg2=new Segment(arg0.segment2)):"point1"in arg0?(point1=arg0.point1,handle1=arg0.handle1,handle2=arg0.handle2,point2=arg0.point2):Array.isArray(arg0)&&(point1=[arg0[0],arg0[1]],point2=[arg0[6],arg0[7]],handle1=[arg0[2]-arg0[0],arg0[3]-arg0[1]],handle2=[arg0[4]-arg0[6],arg0[5]-arg0[7]]):2===count?(seg1=new Segment(arg0),seg2=new Segment(arg1)):4===count?(point1=arg0,handle1=arg1,handle2=arg2,point2=arg3):8===count&&(point1=[arg0,arg1],point2=[arg6,arg7],handle1=[arg2-arg0,arg3-arg1],handle2=[arg4-arg6,arg5-arg7]),this._segment1=seg1||new Segment(point1,null,handle1),this._segment2=seg2||new Segment(point2,handle2,null)},_serialize:function(options){return Base.serialize(this.hasHandles()?[this.getPoint1(),this.getHandle1(),this.getHandle2(),this.getPoint2()]:[this.getPoint1(),this.getPoint2()],options,!0)},_changed:function(){this._length=this._bounds=undefined},clone:function(){return new Curve(this._segment1,this._segment2)},toString:function(){var parts=["point1: "+this._segment1._point];return this._segment1._handleOut.isZero()||parts.push("handle1: "+this._segment1._handleOut),this._segment2._handleIn.isZero()||parts.push("handle2: "+this._segment2._handleIn),parts.push("point2: "+this._segment2._point),"{ "+parts.join(", ")+" }"},remove:function(){var removed=!1;if(this._path){var segment2=this._segment2,handleOut=segment2._handleOut;(removed=segment2.remove())&&this._segment1._handleOut.set(handleOut.x,handleOut.y)}return removed},getPoint1:function(){return this._segment1._point},setPoint1:function(){var point=Point.read(arguments);this._segment1._point.set(point.x,point.y)},getPoint2:function(){return this._segment2._point},setPoint2:function(){var point=Point.read(arguments);this._segment2._point.set(point.x,point.y)},getHandle1:function(){return this._segment1._handleOut},setHandle1:function(){var point=Point.read(arguments);this._segment1._handleOut.set(point.x,point.y)},getHandle2:function(){return this._segment2._handleIn},setHandle2:function(){var point=Point.read(arguments);this._segment2._handleIn.set(point.x,point.y)},getSegment1:function(){return this._segment1},getSegment2:function(){return this._segment2},getPath:function(){return this._path},getIndex:function(){return this._segment1._index},getNext:function(){var curves=this._path&&this._path._curves;return curves&&(curves[this._segment1._index+1]||this._path._closed&&curves[0])||null},getPrevious:function(){var curves=this._path&&this._path._curves;return curves&&(curves[this._segment1._index-1]||this._path._closed&&curves[curves.length-1])||null},isFirst:function(){return 0===this._segment1._index},isLast:function(){var path=this._path;return path&&this._segment1._index===path._curves.length-1||!1},isSelected:function(){return this.getPoint1().isSelected()&&this.getHandle2().isSelected()&&this.getHandle2().isSelected()&&this.getPoint2().isSelected()},setSelected:function(selected){this.getPoint1().setSelected(selected),this.getHandle1().setSelected(selected),this.getHandle2().setSelected(selected),this.getPoint2().setSelected(selected)},getValues:function(matrix){return Curve.getValues(this._segment1,this._segment2,matrix)},getPoints:function(){for(var coords=this.getValues(),points=[],i=0;i<8;i+=2)points.push(new Point(coords[i],coords[i+1]));return points},getLength:function(){return null==this._length&&(this._length=Curve.getLength(this.getValues(),0,1)),this._length},getArea:function(){return Curve.getArea(this.getValues())},getLine:function(){return new Line(this._segment1._point,this._segment2._point)},getPart:function(from,to){return new Curve(Curve.getPart(this.getValues(),from,to))},getPartLength:function(from,to){return Curve.getLength(this.getValues(),from,to)},getIntersections:function(curve){return Curve._getIntersections(this.getValues(),curve&&curve!==this?curve.getValues():null,this,curve,[],{})},_getParameter:function(offset,isParameter){return isParameter?offset:offset&&offset.curve===this?offset.parameter:offset===undefined&&isParameter===undefined?.5:this.getParameterAt(offset,0)},divide:function(offset,isParameter,_setHandles){var parameter=this._getParameter(offset,isParameter),tMin=4e-7,tMax,res=null;if(parameter>=4e-7&&parameter<=1-4e-7){var parts=Curve.subdivide(this.getValues(),parameter),left=parts[0],right=parts[1],setHandles=_setHandles||this.hasHandles(),segment1=this._segment1,segment2=this._segment2,path=this._path;setHandles&&(segment1._handleOut.set(left[2]-left[0],left[3]-left[1]),segment2._handleIn.set(right[4]-right[6],right[5]-right[7]));var x=left[6],y=left[7],segment=new Segment(new Point(x,y),setHandles&&new Point(left[4]-x,left[5]-y),setHandles&&new Point(right[2]-x,right[3]-y));path?(path.insert(segment1._index+1,segment),res=this.getNext()):(this._segment2=segment,res=new Curve(segment,segment2))}return res},split:function(offset,isParameter){return this._path?this._path.split(this._segment1._index,this._getParameter(offset,isParameter)):null},reversed:function(){return new Curve(this._segment2.reversed(),this._segment1.reversed())},clearHandles:function(){this._segment1._handleOut.set(0,0),this._segment2._handleIn.set(0,0)},statics:{getValues:function(segment1,segment2,matrix){var p1=segment1._point,h1=segment1._handleOut,h2=segment2._handleIn,p2=segment2._point,values=[p1._x,p1._y,p1._x+h1._x,p1._y+h1._y,p2._x+h2._x,p2._y+h2._y,p2._x,p2._y];return matrix&&matrix._transformCoordinates(values,values,4),values},subdivide:function(v,t){var p1x=v[0],p1y=v[1],c1x=v[2],c1y=v[3],c2x=v[4],c2y=v[5],p2x=v[6],p2y=v[7];t===undefined&&(t=.5);var u=1-t,p3x=u*p1x+t*c1x,p3y=u*p1y+t*c1y,p4x=u*c1x+t*c2x,p4y=u*c1y+t*c2y,p5x=u*c2x+t*p2x,p5y=u*c2y+t*p2y,p6x=u*p3x+t*p4x,p6y=u*p3y+t*p4y,p7x=u*p4x+t*p5x,p7y=u*p4y+t*p5y,p8x=u*p6x+t*p7x,p8y=u*p6y+t*p7y;return[[p1x,p1y,p3x,p3y,p6x,p6y,p8x,p8y],[p8x,p8y,p7x,p7y,p5x,p5y,p2x,p2y]]},solveCubic:function(v,coord,val,roots,min,max){var p1=v[coord],c1=v[coord+2],c2,p2,c=3*(c1-p1),b=3*(v[coord+4]-c1)-c,a=v[coord+6]-p1-c-b;return Numerical.solveCubic(a,b,c,p1-val,roots,min,max)},getParameterOf:function(v,point){var p1=new Point(v[0],v[1]),p2=new Point(v[6],v[7]),epsilon=1e-12,t=point.isClose(p1,1e-12)?0:point.isClose(p2,1e-12)?1:null;if(null!==t)return t;for(var coords=[point.x,point.y],roots=[],geomEpsilon=2e-7,c=0;c<2;c++)for(var count=Curve.solveCubic(v,c,coords[c],roots,0,1),i=0;i<count;i++)if(t=roots[i],point.isClose(Curve.getPoint(v,t),2e-7))return t;return point.isClose(p1,2e-7)?0:point.isClose(p2,2e-7)?1:null},getNearestParameter:function(v,point){if(Curve.isStraight(v)){var p1x=v[0],p1y=v[1],p2x,p2y,vx=v[6]-p1x,vy=v[7]-p1y,det=vx*vx+vy*vy;if(0===det)return 0;var u=((point.x-p1x)*vx+(point.y-p1y)*vy)/det;return u<1e-12?0:u>.999999999999?1:Curve.getParameterOf(v,new Point(p1x+u*vx,p1y+u*vy))}var count=100,minDist=1/0,minT=0;function refine(t){if(t>=0&&t<=1){var dist=point.getDistance(Curve.getPoint(v,t),!0);if(dist<minDist)return minDist=dist,minT=t,!0}}for(var i=0;i<=100;i++)refine(i/100);for(var step=.005;step>4e-7;)refine(minT-step)||refine(minT+step)||(step/=2);return minT},getPart:function(v,from,to){var flip=from>to;if(flip){var tmp=from;from=to,to=tmp}return from>0&&(v=Curve.subdivide(v,from)[1]),to<1&&(v=Curve.subdivide(v,(to-from)/(1-from))[0]),flip?[v[6],v[7],v[4],v[5],v[2],v[3],v[0],v[1]]:v},hasHandles:function(v){var isZero=Numerical.isZero;return!(isZero(v[0]-v[2])&&isZero(v[1]-v[3])&&isZero(v[4]-v[6])&&isZero(v[5]-v[7]))},isFlatEnough:function(v,tolerance){var p1x=v[0],p1y=v[1],c1x=v[2],c1y=v[3],c2x=v[4],c2y=v[5],p2x=v[6],p2y=v[7],ux=3*c1x-2*p1x-p2x,uy=3*c1y-2*p1y-p2y,vx=3*c2x-2*p2x-p1x,vy=3*c2y-2*p2y-p1y;return Math.max(ux*ux,vx*vx)+Math.max(uy*uy,vy*vy)<10*tolerance*tolerance},getArea:function(v){var p1x=v[0],p1y=v[1],p2x=v[6],p2y=v[7],h1x=(v[2]+p1x)/2,h1y=(v[3]+p1y)/2,h2x=(v[4]+v[6])/2,h2y=(v[5]+v[7])/2;return 6*((p1x-h1x)*(h1y+p1y)+(h1x-h2x)*(h2y+h1y)+(h2x-p2x)*(p2y+h2y))/10},getBounds:function(v){for(var min=v.slice(0,2),max=min.slice(),roots=[0,0],i=0;i<2;i++)Curve._addBounds(v[i],v[i+2],v[i+4],v[i+6],i,0,min,max,roots);return new Rectangle(min[0],min[1],max[0]-min[0],max[1]-min[1])},_addBounds:function(v0,v1,v2,v3,coord,padding,min,max,roots){function add(value,padding){var left=value-padding,right=value+padding;left<min[coord]&&(min[coord]=left),right>max[coord]&&(max[coord]=right)}var a=3*(v1-v2)-v0+v3,b=2*(v0+v2)-4*v1,c=v1-v0,count=Numerical.solveQuadratic(a,b,c,roots),tMin=4e-7,tMax=1-4e-7;add(v3,0);for(var i=0;i<count;i++){var t=roots[i],u=1-t;4e-7<t&&t<tMax&&add(u*u*u*v0+3*u*u*t*v1+3*u*t*t*v2+t*t*t*v3,padding)}}}},Base.each(["getBounds","getStrokeBounds","getHandleBounds","getRoughBounds"],function(name){this[name]=function(){this._bounds||(this._bounds={});var bounds=this._bounds[name];if(!bounds){var path=this._path;bounds=this._bounds[name]=Path[name]([this._segment1,this._segment2],!1,path&&path.getStyle())}return bounds.clone()}},{}),Base.each({isStraight:function(l,h1,h2){if(h1.isZero()&&h2.isZero())return!0;if(l.isZero())return!1;if(h1.isCollinear(l)&&h2.isCollinear(l)){var div=l.dot(l),p1=l.dot(h1)/div,p2=l.dot(h2)/div;return p1>=0&&p1<=1&&p2<=0&&p2>=-1}return!1},isLinear:function(l,h1,h2){var third=l.divide(3);return h1.equals(third)&&h2.negate().equals(third)}},function(test,name){this[name]=function(){var seg1=this._segment1,seg2=this._segment2;return test(seg2._point.subtract(seg1._point),seg1._handleOut,seg2._handleIn)},this.statics[name]=function(v){var p1x=v[0],p1y=v[1],p2x=v[6],p2y=v[7];return test(new Point(p2x-p1x,p2y-p1y),new Point(v[2]-p1x,v[3]-p1y),new Point(v[4]-p2x,v[5]-p2y))}},{statics:{},hasHandles:function(){return!this._segment1._handleOut.isZero()||!this._segment2._handleIn.isZero()},isCollinear:function(curve){return curve&&this.isStraight()&&curve.isStraight()&&this.getLine().isCollinear(curve.getLine())},isHorizontal:function(){return this.isStraight()&&Math.abs(this.getTangentAt(.5,!0).y)<1e-7},isVertical:function(){return this.isStraight()&&Math.abs(this.getTangentAt(.5,!0).x)<1e-7}}),{beans:!1,getParameterAt:function(offset,start){return Curve.getParameterAt(this.getValues(),offset,start)},getParameterOf:function(){return Curve.getParameterOf(this.getValues(),Point.read(arguments))},getLocationAt:function(offset,isParameter){var t=isParameter?offset:this.getParameterAt(offset);return null!=t&&t>=0&&t<=1?new CurveLocation(this,t):null},getLocationOf:function(){return this.getLocationAt(this.getParameterOf(Point.read(arguments)),!0)},getOffsetOf:function(){var loc=this.getLocationOf.apply(this,arguments);return loc?loc.getOffset():null},getNearestLocation:function(){var point=Point.read(arguments),values=this.getValues(),t=Curve.getNearestParameter(values,point),pt=Curve.getPoint(values,t);return new CurveLocation(this,t,pt,null,point.getDistance(pt))},getNearestPoint:function(){return this.getNearestLocation.apply(this,arguments).getPoint()}},new function(){var methods=["getPoint","getTangent","getNormal","getWeightedTangent","getWeightedNormal","getCurvature"];return Base.each(methods,function(name){this[name+"At"]=function(offset,isParameter){var values=this.getValues();return Curve[name](values,isParameter?offset:Curve.getParameterAt(values,offset,0))}},{statics:{evaluateMethods:methods}})},new function(){function getLengthIntegrand(v){var p1x=v[0],p1y=v[1],c1x=v[2],c1y=v[3],c2x=v[4],c2y=v[5],p2x=v[6],p2y=v[7],ax=9*(c1x-c2x)+3*(p2x-p1x),bx=6*(p1x+c2x)-12*c1x,cx=3*(c1x-p1x),ay=9*(c1y-c2y)+3*(p2y-p1y),by=6*(p1y+c2y)-12*c1y,cy=3*(c1y-p1y);return function(t){var dx=(ax*t+bx)*t+cx,dy=(ay*t+by)*t+cy;return Math.sqrt(dx*dx+dy*dy)}}function getIterations(a,b){return Math.max(2,Math.min(16,Math.ceil(32*Math.abs(b-a))))}function evaluate(v,t,type,normalized){if(null==t||t<0||t>1)return null;var p1x=v[0],p1y=v[1],c1x=v[2],c1y=v[3],c2x=v[4],c2y=v[5],p2x=v[6],p2y=v[7],tMin=4e-7,tMax=1-4e-7,x,y;if(0===type&&(t<4e-7||t>tMax)){var isZero=t<4e-7;x=isZero?p1x:p2x,y=isZero?p1y:p2y}else{var cx=3*(c1x-p1x),bx=3*(c2x-c1x)-cx,ax=p2x-p1x-cx-bx,cy=3*(c1y-p1y),by=3*(c2y-c1y)-cy,ay=p2y-p1y-cy-by;if(0===type)x=((ax*t+bx)*t+cx)*t+p1x,y=((ay*t+by)*t+cy)*t+p1y;else{if(t<4e-7?(x=cx,y=cy):t>tMax?(x=3*(p2x-c2x),y=3*(p2y-c2y)):(x=(3*ax*t+2*bx)*t+cx,y=(3*ay*t+2*by)*t+cy),normalized){0===x&&0===y&&(t<4e-7||t>tMax)&&(x=c2x-c1x,y=c2y-c1y);var len=Math.sqrt(x*x+y*y);len&&(x/=len,y/=len)}if(3===type){var x2=6*ax*t+2*bx,y2=6*ay*t+2*by,d=Math.pow(x*x+y*y,1.5);x=0!==d?(x*y2-y*x2)/d:0,y=0}}}return 2===type?new Point(y,-x):new Point(x,y)}return{statics:{getLength:function(v,a,b){if(a===undefined&&(a=0),b===undefined&&(b=1),0===a&&1===b&&Curve.isStraight(v)){var dx=v[6]-v[0],dy=v[7]-v[1];return Math.sqrt(dx*dx+dy*dy)}var ds=getLengthIntegrand(v);return Numerical.integrate(ds,a,b,getIterations(a,b))},getParameterAt:function(v,offset,start){if(start===undefined&&(start=offset<0?1:0),0===offset)return start;var abs=Math.abs,forward=offset>0,a=forward?start:0,b=forward?1:start,ds=getLengthIntegrand(v),rangeLength=Numerical.integrate(ds,a,b,getIterations(a,b));if(abs(offset-rangeLength)<1e-12)return forward?b:a;if(abs(offset)>rangeLength)return null;var guess=offset/rangeLength,length=0;function f(t){return length+=Numerical.integrate(ds,start,t,getIterations(start,t)),start=t,length-offset}return Numerical.findRoot(f,ds,start+guess,a,b,32,1e-12)},getPoint:function(v,t){return evaluate(v,t,0,!1)},getTangent:function(v,t){return evaluate(v,t,1,!0)},getWeightedTangent:function(v,t){return evaluate(v,t,1,!1)},getNormal:function(v,t){return evaluate(v,t,2,!0)},getWeightedNormal:function(v,t){return evaluate(v,t,2,!1)},getCurvature:function(v,t){return evaluate(v,t,3,!1).x}}}},new function(){function addLocation(locations,param,v1,c1,t1,p1,v2,c2,t2,p2,overlap){var startConnected=param.startConnected,endConnected=param.endConnected,tMin=4e-7,tMax=1-4e-7;if(null==t1&&(t1=Curve.getParameterOf(v1,p1)),null!==t1&&t1>=(startConnected?4e-7:0)&&t1<=(endConnected?tMax:1)&&(null==t2&&(t2=Curve.getParameterOf(v2,p2)),null!==t2&&t2>=(endConnected?4e-7:0)&&t2<=(startConnected?tMax:1))){var renormalize=param.renormalize;if(renormalize){var res=renormalize(t1,t2);t1=res[0],t2=res[1]}var loc1=new CurveLocation(c1,t1,p1||Curve.getPoint(v1,t1),overlap),loc2=new CurveLocation(c2,t2,p2||Curve.getPoint(v2,t2),overlap),flip,loc=loc1.getPath()===loc2.getPath()&&loc1.getIndex()>loc2.getIndex()?loc2:loc1,include=param.include;loc1._intersection=loc2,loc2._intersection=loc1,include&&!include(loc)||CurveLocation.insert(locations,loc,!0)}}function addCurveIntersections(v1,v2,c1,c2,locations,param,tMin,tMax,uMin,uMax,oldTDiff,reverse,recursion){if(!(++recursion>=24)){var q0x=v2[0],q0y=v2[1],q3x=v2[6],q3y=v2[7],getSignedDistance=Line.getSignedDistance,d1=getSignedDistance(q0x,q0y,q3x,q3y,v2[2],v2[3]),d2=getSignedDistance(q0x,q0y,q3x,q3y,v2[4],v2[5]),factor=d1*d2>0?.75:4/9,dMin=factor*Math.min(0,d1,d2),dMax=factor*Math.max(0,d1,d2),dp0,dp1,dp2,dp3,hull=getConvexHull(getSignedDistance(q0x,q0y,q3x,q3y,v1[0],v1[1]),getSignedDistance(q0x,q0y,q3x,q3y,v1[2],v1[3]),getSignedDistance(q0x,q0y,q3x,q3y,v1[4],v1[5]),getSignedDistance(q0x,q0y,q3x,q3y,v1[6],v1[7])),top=hull[0],bottom=hull[1],tMinClip,tMaxClip;if(null!=(tMinClip=clipConvexHull(top,bottom,dMin,dMax))&&null!=(tMaxClip=clipConvexHull(top.reverse(),bottom.reverse(),dMin,dMax))){v1=Curve.getPart(v1,tMinClip,tMaxClip);var tDiff=tMaxClip-tMinClip,tMinNew=tMin+(tMax-tMin)*tMinClip,tMaxNew=tMin+(tMax-tMin)*tMaxClip;if(oldTDiff>.5&&tDiff>.5)if(tMaxNew-tMinNew>uMax-uMin){var parts,t=tMinNew+(tMaxNew-tMinNew)/2;addCurveIntersections(v2,(parts=Curve.subdivide(v1,.5))[0],c2,c1,locations,param,uMin,uMax,tMinNew,t,tDiff,!reverse,recursion),addCurveIntersections(v2,parts[1],c2,c1,locations,param,uMin,uMax,t,tMaxNew,tDiff,!reverse,recursion)}else{var parts,t=uMin+(uMax-uMin)/2;addCurveIntersections((parts=Curve.subdivide(v2,.5))[0],v1,c2,c1,locations,param,uMin,t,tMinNew,tMaxNew,tDiff,!reverse,recursion),addCurveIntersections(parts[1],v1,c2,c1,locations,param,t,uMax,tMinNew,tMaxNew,tDiff,!reverse,recursion)}else if(Math.max(uMax-uMin,tMaxNew-tMinNew)<1e-7){var t1=tMinNew+(tMaxNew-tMinNew)/2,t2=uMin+(uMax-uMin)/2;v1=c1.getValues(),v2=c2.getValues(),addLocation(locations,param,reverse?v2:v1,reverse?c2:c1,reverse?t2:t1,null,reverse?v1:v2,reverse?c1:c2,reverse?t1:t2,null)}else tDiff>1e-12&&addCurveIntersections(v2,v1,c2,c1,locations,param,uMin,uMax,tMinNew,tMaxNew,tDiff,!reverse,recursion)}}}function getConvexHull(dq0,dq1,dq2,dq3){var p0=[0,dq0],p1=[1/3,dq1],p2=[2/3,dq2],p3=[1,dq3],dist1=dq1-(2*dq0+dq3)/3,dist2=dq2-(dq0+2*dq3)/3,hull;if(dist1*dist2<0)hull=[[p0,p1,p3],[p0,p2,p3]];else{var distRatio=dist1/dist2;hull=[distRatio>=2?[p0,p1,p3]:distRatio<=.5?[p0,p2,p3]:[p0,p1,p2,p3],[p0,p3]]}return(dist1||dist2)<0?hull.reverse():hull}function clipConvexHull(hullTop,hullBottom,dMin,dMax){return hullTop[0][1]<dMin?clipConvexHullPart(hullTop,!0,dMin):hullBottom[0][1]>dMax?clipConvexHullPart(hullBottom,!1,dMax):hullTop[0][0]}function clipConvexHullPart(part,top,threshold){for(var px=part[0][0],py=part[0][1],i=1,l=part.length;i<l;i++){var qx=part[i][0],qy=part[i][1];if(top?qy>=threshold:qy<=threshold)return qy===threshold?qx:px+(threshold-py)*(qx-px)/(qy-py);px=qx,py=qy}return null}function addCurveLineIntersections(v1,v2,c1,c2,locations,param){for(var flip=Curve.isStraight(v1),vc=flip?v2:v1,vl=flip?v1:v2,lx1=vl[0],ly1=vl[1],lx2,ly2,ldx=vl[6]-lx1,ldy=vl[7]-ly1,angle=Math.atan2(-ldy,ldx),sin=Math.sin(angle),cos=Math.cos(angle),rvc=[],i=0;i<8;i+=2){var x=vc[i]-lx1,y=vc[i+1]-ly1;rvc.push(x*cos-y*sin,x*sin+y*cos)}for(var roots=[],count=Curve.solveCubic(rvc,1,0,roots,0,1),i=0;i<count;i++){var tc=roots[i],pc=Curve.getPoint(vc,tc),tl=Curve.getParameterOf(vl,pc);if(null!==tl){var pl=Curve.getPoint(vl,tl),t1=flip?tl:tc,t2=flip?tc:tl;(!param.endConnected||t2>Numerical.CURVETIME_EPSILON)&&addLocation(locations,param,v1,c1,t1,flip?pl:pc,v2,c2,t2,flip?pc:pl)}}}function addLineIntersection(v1,v2,c1,c2,locations,param){var pt=Line.intersect(v1[0],v1[1],v1[6],v1[7],v2[0],v2[1],v2[6],v2[7]);pt&&addLocation(locations,param,v1,c1,null,pt,v2,c2,null,pt)}return{statics:{_getIntersections:function(v1,v2,c1,c2,locations,param){if(!v2)return Curve._getSelfIntersection(v1,c1,locations,param);var c1p1x=v1[0],c1p1y=v1[1],c1p2x=v1[6],c1p2y=v1[7],c2p1x=v2[0],c2p1y=v2[1],c2p2x=v2[6],c2p2y=v2[7],c1s1x=(3*v1[2]+c1p1x)/4,c1s1y=(3*v1[3]+c1p1y)/4,c1s2x=(3*v1[4]+c1p2x)/4,c1s2y=(3*v1[5]+c1p2y)/4,c2s1x=(3*v2[2]+c2p1x)/4,c2s1y=(3*v2[3]+c2p1y)/4,c2s2x=(3*v2[4]+c2p2x)/4,c2s2y=(3*v2[5]+c2p2y)/4,min=Math.min,max=Math.max;if(!(max(c1p1x,c1s1x,c1s2x,c1p2x)>=min(c2p1x,c2s1x,c2s2x,c2p2x)&&min(c1p1x,c1s1x,c1s2x,c1p2x)<=max(c2p1x,c2s1x,c2s2x,c2p2x)&&max(c1p1y,c1s1y,c1s2y,c1p2y)>=min(c2p1y,c2s1y,c2s2y,c2p2y)&&min(c1p1y,c1s1y,c1s2y,c1p2y)<=max(c2p1y,c2s1y,c2s2y,c2p2y)))return locations;if(!param.startConnected&&!param.endConnected){var overlaps=Curve.getOverlaps(v1,v2);if(overlaps){for(var i=0;i<2;i++){var overlap=overlaps[i];addLocation(locations,param,v1,c1,overlap[0],null,v2,c2,overlap[1],null,!0)}return locations}}var straight1=Curve.isStraight(v1),straight2=Curve.isStraight(v2),straight=straight1&&straight2,epsilon=1e-12,before=locations.length;if((straight?addLineIntersection:straight1||straight2?addCurveLineIntersections:addCurveIntersections)(v1,v2,c1,c2,locations,param,0,1,0,1,0,!1,0),straight&&locations.length>before)return locations;var c1p1=new Point(c1p1x,c1p1y),c1p2=new Point(c1p2x,c1p2y),c2p1=new Point(c2p1x,c2p1y),c2p2=new Point(c2p2x,c2p2y);return c1p1.isClose(c2p1,1e-12)&&addLocation(locations,param,v1,c1,0,c1p1,v2,c2,0,c2p1),!param.startConnected&&c1p1.isClose(c2p2,1e-12)&&addLocation(locations,param,v1,c1,0,c1p1,v2,c2,1,c2p2),!param.endConnected&&c1p2.isClose(c2p1,1e-12)&&addLocation(locations,param,v1,c1,1,c1p2,v2,c2,0,c2p1),c1p2.isClose(c2p2,1e-12)&&addLocation(locations,param,v1,c1,1,c1p2,v2,c2,1,c2p2),locations},_getSelfIntersection:function(v1,c1,locations,param){var p1x=v1[0],p1y=v1[1],h1x=v1[2],h1y=v1[3],h2x=v1[4],h2y=v1[5],p2x=v1[6],p2y=v1[7],line=new Line(p1x,p1y,p2x,p2y,!1),side1=line.getSide(new Point(h1x,h1y),!0),side2,edgeSum;if(side1===line.getSide(new Point(h2x,h2y),!0)&&((p1x-h2x)*(h1y-p2y)+(h1x-p2x)*(h2y-p1y))*side1>0)return locations;var ax=p2x-3*h2x+3*h1x-p1x,bx=h2x-2*h1x+p1x,cx=h1x-p1x,ay=p2y-3*h2y+3*h1y-p1y,by=h2y-2*h1y+p1y,cy=h1y-p1y,ac=ay*cx-ax*cy,ab,bc;if(ac*ac-4*(ay*bx-ax*by)*(by*cx-bx*cy)<0){var roots=[],tSplit,count=Numerical.solveCubic(ax*ax+ay*ay,3*(ax*bx+ay*by),2*(bx*bx+by*by)+ax*cx+ay*cy,bx*cx+by*cy,roots,0,1);if(count>0){for(var i=0,maxCurvature=0;i<count;i++){var curvature=Math.abs(c1.getCurvatureAt(roots[i],!0));curvature>maxCurvature&&(maxCurvature=curvature,tSplit=roots[i])}var parts=Curve.subdivide(v1,tSplit);param.endConnected=!0,param.renormalize=function(t1,t2){return[t1*tSplit,t2*(1-tSplit)+tSplit]},Curve._getIntersections(parts[0],parts[1],c1,c1,locations,param)}}return locations},getOverlaps:function(v1,v2){var abs=Math.abs,timeEpsilon=4e-7,geomEpsilon=2e-7,straight1=Curve.isStraight(v1),straight2=Curve.isStraight(v2),straight=straight1&&straight2;function getLineLengthSquared(v){var x=v[6]-v[0],y=v[7]-v[1];return x*x+y*y}if(straight){var flip=getLineLengthSquared(v1)<getLineLengthSquared(v2),l1=flip?v2:v1,l2=flip?v1:v2,line=new Line(l1[0],l1[1],l1[6],l1[7]);if(line.getDistance(new Point(l2[0],l2[1]))>2e-7||line.getDistance(new Point(l2[6],l2[7]))>2e-7)return null}else if(straight1^straight2)return null;for(var v=[v1,v2],pairs=[],i=0,t1=0;i<2&&pairs.length<2;i+=0===t1?0:1,t1^=1){var t2=Curve.getParameterOf(v[1^i],new Point(v[i][0===t1?0:6],v[i][0===t1?1:7]));if(null!=t2){var pair=0===i?[t1,t2]:[t2,t1];(0===pairs.length||abs(pair[0]-pairs[0][0])>4e-7&&abs(pair[1]-pairs[0][1])>4e-7)&&pairs.push(pair)}if(1===i&&0===pairs.length)break}if(2!==pairs.length)pairs=null;else if(!straight){var o1=Curve.getPart(v1,pairs[0][0],pairs[1][0]),o2=Curve.getPart(v2,pairs[0][1],pairs[1][1]);(abs(o2[2]-o1[2])>2e-7||abs(o2[3]-o1[3])>2e-7||abs(o2[4]-o1[4])>2e-7||abs(o2[5]-o1[5])>2e-7)&&(pairs=null)}return pairs}}}}),CurveLocation=Base.extend({_class:"CurveLocation",beans:!0,initialize:function CurveLocation(curve,parameter,point,_overlap,_distance){if(parameter>.9999996){var next=curve.getNext();next&&(parameter=0,curve=next)}this._id=UID.get(CurveLocation),this._setCurve(curve),this._parameter=parameter,this._point=point||curve.getPointAt(parameter,!0),this._overlap=_overlap,this._distance=_distance,this._intersection=this._next=this._prev=null},_setCurve:function(curve){var path=curve._path;this._version=path?path._version:0,this._curve=curve,this._segment=null,this._segment1=curve._segment1,this._segment2=curve._segment2},_setSegment:function(segment){this._setCurve(segment.getCurve()),this._segment=segment,this._parameter=segment===this._segment1?0:1,this._point=segment._point.clone()},getSegment:function(){var curve=this.getCurve(),segment=this._segment;if(!segment){var parameter=this.getParameter();0===parameter?segment=curve._segment1:1===parameter?segment=curve._segment2:null!=parameter&&(segment=curve.getPartLength(0,parameter)<curve.getPartLength(parameter,1)?curve._segment1:curve._segment2),this._segment=segment}return segment},getCurve:function(){var curve=this._curve,path=curve&&curve._path,that=this;function trySegment(segment){var curve=segment&&segment.getCurve();if(curve&&null!=(that._parameter=curve.getParameterOf(that._point)))return that._setCurve(curve),that._segment=segment,curve}return path&&path._version!==this._version&&(curve=this._parameter=this._curve=this._offset=null),curve||trySegment(this._segment)||trySegment(this._segment1)||trySegment(this._segment2.getPrevious())},getPath:function(){var curve=this.getCurve();return curve&&curve._path},getIndex:function(){var curve=this.getCurve();return curve&&curve.getIndex()},getParameter:function(){var curve=this.getCurve(),parameter=this._parameter;return curve&&null==parameter?this._parameter=curve.getParameterOf(this._point):parameter},getPoint:function(){return this._point},getOffset:function(){var offset=this._offset;if(null==offset){offset=0;var path=this.getPath(),index=this.getIndex();if(path&&null!=index)for(var curves=path.getCurves(),i=0;i<index;i++)offset+=curves[i].getLength();this._offset=offset+=this.getCurveOffset()}return offset},getCurveOffset:function(){var curve=this.getCurve(),parameter=this.getParameter();return null!=parameter&&curve&&curve.getPartLength(0,parameter)},getIntersection:function(){return this._intersection},getDistance:function(){return this._distance},divide:function(){var curve=this.getCurve(),res=null;return curve&&(res=curve.divide(this.getParameter(),!0))&&this._setSegment(res._segment1),res},split:function(){var curve=this.getCurve();return curve?curve.split(this.getParameter(),!0):null},equals:function(loc,_ignoreOther){var res=this===loc,epsilon=2e-7;if(!res&&loc instanceof CurveLocation&&this.getPath()===loc.getPath()&&this.getPoint().isClose(loc.getPoint(),2e-7)){var c1=this.getCurve(),c2=loc.getCurve(),abs=Math.abs,diff=abs((c1.isLast()&&c2.isFirst()?-1:c1.getIndex())+this.getParameter()-((c2.isLast()&&c1.isFirst()?-1:c2.getIndex())+loc.getParameter()));res=(diff<4e-7||(diff=abs(this.getOffset()-loc.getOffset()))<2e-7||abs(this.getPath().getLength()-diff)<2e-7)&&(_ignoreOther||!this._intersection&&!loc._intersection||this._intersection&&this._intersection.equals(loc._intersection,!0))}return res},toString:function(){var parts=[],point=this.getPoint(),f=Formatter.instance;point&&parts.push("point: "+point);var index=this.getIndex();null!=index&&parts.push("index: "+index);var parameter=this.getParameter();return null!=parameter&&parts.push("parameter: "+f.number(parameter)),null!=this._distance&&parts.push("distance: "+f.number(this._distance)),"{ "+parts.join(", ")+" }"},isTouching:function(){var inter=this._intersection;if(inter&&this.getTangent().isCollinear(inter.getTangent())){var curve1=this.getCurve(),curve2=inter.getCurve();return!(curve1.isStraight()&&curve2.isStraight()&&curve1.getLine().intersect(curve2.getLine()))}return!1},isCrossing:function(){var inter=this._intersection;if(!inter)return!1;var t1=this.getParameter(),t2=inter.getParameter(),tMin=4e-7,tMax=1-4e-7;if(t1>=4e-7&&t1<=tMax||t2>=4e-7&&t2<=tMax)return!this.isTouching();var c2=this.getCurve(),c1=c2.getPrevious(),c4=inter.getCurve(),c3=c4.getPrevious(),PI=Math.PI;if(!c1||!c3)return!1;function isInRange(angle,min,max){return min<max?angle>min&&angle<max:angle>min&&angle<=PI||angle>=-PI&&angle<max}var a1=c1.getTangentAt(tMax,!0).negate().getAngleInRadians(),a2=c2.getTangentAt(4e-7,!0).getAngleInRadians(),a3=c3.getTangentAt(tMax,!0).negate().getAngleInRadians(),a4=c4.getTangentAt(4e-7,!0).getAngleInRadians();return isInRange(a3,a1,a2)^isInRange(a4,a1,a2)&&isInRange(a3,a2,a1)^isInRange(a4,a2,a1)},isOverlap:function(){return!!this._overlap}},Base.each(Curve.evaluateMethods,function(name){var get=name+"At";this[name]=function(){var parameter=this.getParameter(),curve=this.getCurve();return null!=parameter&&curve&&curve[get](parameter,!0)}},{preserve:!0}),new function(){function insert(locations,loc,merge){var length=locations.length,l=0,r=length-1;function search(index,dir){for(var i=index+dir;i>=-1&&i<=length;i+=dir){var loc2=locations[(i%length+length)%length];if(!loc.getPoint().isClose(loc2.getPoint(),2e-7))break;if(loc.equals(loc2))return loc2}return null}for(;l<=r;){var m=l+r>>>1,loc2=locations[m],found;if(merge&&(found=loc.equals(loc2)?loc2:search(m,-1)||search(m,1)))return loc._overlap&&(found._overlap=found._intersection._overlap=!0),found;var path1=loc.getPath(),path2=loc2.getPath(),diff;(path1===path2?loc.getIndex()+loc.getParameter()-(loc2.getIndex()+loc2.getParameter()):path1._id-path2._id)<0?r=m-1:l=m+1}return locations.splice(l,0,loc),loc}return{statics:{insert:insert,expand:function(locations){for(var expanded=locations.slice(),i=0,l=locations.length;i<l;i++)insert(expanded,locations[i]._intersection,!1);return expanded}}}}),PathItem=Item.extend({_class:"PathItem",initialize:function PathItem(){},getIntersections:function(path,include,_matrix,_returnFirst){var self=this===path||!path,matrix1=this._matrix.orNullIfIdentity(),matrix2=self?matrix1:(_matrix||path._matrix).orNullIfIdentity();if(!self&&!this.getBounds(matrix1).touches(path.getBounds(matrix2)))return[];for(var curves1=this.getCurves(),curves2=self?curves1:path.getCurves(),length1=curves1.length,length2=self?length1:curves2.length,values2=[],arrays=[],locations,path,i=0;i<length2;i++)values2[i]=curves2[i].getValues(matrix2);for(var i=0;i<length1;i++){var curve1=curves1[i],values1=self?values2[i]:curve1.getValues(matrix1),path1=curve1.getPath();path1!==path&&(path=path1,locations=[],arrays.push(locations)),self&&Curve._getSelfIntersection(values1,curve1,locations,{include:include,startConnected:1===length1&&curve1.getPoint1().equals(curve1.getPoint2())});for(var j=self?i+1:0;j<length2;j++){if(_returnFirst&&locations.length)return locations;var curve2=curves2[j];Curve._getIntersections(values1,values2[j],curve1,curve2,locations,{include:include,startConnected:self&&curve1.getPrevious()===curve2,endConnected:self&&curve1.getNext()===curve2})}}locations=[];for(var i=0,l=arrays.length;i<l;i++)locations.push.apply(locations,arrays[i]);return locations},getCrossings:function(path){return this.getIntersections(path,function(inter){return inter.isCrossing()})},_asPathItem:function(){return this},setPathData:function(data){var parts=data.match(/[mlhvcsqtaz][^mlhvcsqtaz]*/gi),coords,relative=!1,previous,control,current=new Point,start=new Point;function getCoord(index,coord){var val=+coords[index];return relative&&(val+=current[coord]),val}function getPoint(index){return new Point(getCoord(index,"x"),getCoord(index+1,"y"))}this.clear();for(var i=0,l=parts&&parts.length;i<l;i++){var part=parts[i],command=part[0],lower=command.toLowerCase(),length=(coords=part.match(/[+-]?(?:\d*\.\d+|\d+\.?)(?:[eE][+-]?\d+)?/g))&&coords.length;switch(relative=command===lower,"z"!==previous||/[mz]/.test(lower)||this.moveTo(current=start),lower){case"m":case"l":for(var move="m"===lower,j=0;j<length;j+=2)this[0===j&&move?"moveTo":"lineTo"](current=getPoint(j));control=current,move&&(start=current);break;case"h":case"v":for(var coord="h"===lower?"x":"y",j=0;j<length;j++)current[coord]=getCoord(j,coord),this.lineTo(current);control=current;break;case"c":for(var j=0;j<length;j+=6)this.cubicCurveTo(getPoint(j),control=getPoint(j+2),current=getPoint(j+4));break;case"s":for(var j=0;j<length;j+=4)this.cubicCurveTo(/[cs]/.test(previous)?current.multiply(2).subtract(control):current,control=getPoint(j),current=getPoint(j+2)),previous=lower;break;case"q":for(var j=0;j<length;j+=4)this.quadraticCurveTo(control=getPoint(j),current=getPoint(j+2));break;case"t":for(var j=0;j<length;j+=2)this.quadraticCurveTo(control=/[qt]/.test(previous)?current.multiply(2).subtract(control):current,current=getPoint(j)),previous=lower;break;case"a":for(var j=0;j<length;j+=7)this.arcTo(current=getPoint(j+5),new Size(+coords[j],+coords[j+1]),+coords[j+2],+coords[j+4],+coords[j+3]);break;case"z":this.closePath(!0)}previous=lower}},_canComposite:function(){return!(this.hasFill()&&this.hasStroke())},_contains:function(point){var winding=this._getWinding(point,!1,!0);return!!("evenodd"===this.getWindingRule()?1&winding:winding)}}),Path=PathItem.extend({_class:"Path",_serializeFields:{segments:[],closed:!1},initialize:function Path(arg){this._closed=!1,this._segments=[],this._version=0;var segments=Array.isArray(arg)?"object"==typeof arg[0]?arg:arguments:!arg||arg.size!==undefined||arg.x===undefined&&arg.point===undefined?null:arguments;segments&&segments.length>0?this.setSegments(segments):(this._curves=undefined,this._selectedSegmentState=0,segments||"string"!=typeof arg||(this.setPathData(arg),arg=null)),this._initialize(!segments&&arg)},_equals:function(item){return this._closed===item._closed&&Base.equals(this._segments,item._segments)},clone:function(insert){var copy=new Path(Item.NO_INSERT);return copy.setSegments(this._segments),copy._closed=this._closed,this._clockwise!==undefined&&(copy._clockwise=this._clockwise),this._clone(copy,insert)},_changed:function _changed(flags){if(_changed.base.call(this,flags),8&flags){var parent=this._parent;if(parent&&(parent._currentPath=undefined),this._length=this._area=this._clockwise=this._monoCurves=undefined,16&flags)this._version++;else if(this._curves)for(var i=0,l=this._curves.length;i<l;i++)this._curves[i]._changed()}else 32&flags&&(this._bounds=undefined)},getStyle:function(){var parent=this._parent;return(parent instanceof CompoundPath?parent:this)._style},getSegments:function(){return this._segments},setSegments:function(segments){var fullySelected=this.isFullySelected();this._segments.length=0,this._selectedSegmentState=0,this._curves=undefined,segments&&segments.length>0&&this._add(Segment.readAll(segments)),fullySelected&&this.setFullySelected(!0)},getFirstSegment:function(){return this._segments[0]},getLastSegment:function(){return this._segments[this._segments.length-1]},getCurves:function(){var curves=this._curves,segments=this._segments;if(!curves){var length=this._countCurves();curves=this._curves=new Array(length);for(var i=0;i<length;i++)curves[i]=new Curve(this,segments[i],segments[i+1]||segments[0])}return curves},getFirstCurve:function(){return this.getCurves()[0]},getLastCurve:function(){var curves=this.getCurves();return curves[curves.length-1]},isClosed:function(){return this._closed},setClosed:function(closed){if(this._closed!=(closed=!!closed)){if(this._closed=closed,this._curves){var length=this._curves.length=this._countCurves();closed&&(this._curves[length-1]=new Curve(this,this._segments[length-1],this._segments[0]))}this._changed(25)}}},{beans:!0,getPathData:function(_matrix,_precision){var segments=this._segments,length=segments.length,f=new Formatter(_precision),coords=new Array(6),first=!0,curX,curY,prevX,prevY,inX,inY,outX,outY,parts=[];function addSegment(segment,skipLine){segment._transformCoordinates(_matrix,coords,!1),curX=coords[0],curY=coords[1],first?(parts.push("M"+f.pair(curX,curY)),first=!1):(inX=coords[2],inY=coords[3],inX===curX&&inY===curY&&outX===prevX&&outY===prevY?skipLine||parts.push("l"+f.pair(curX-prevX,curY-prevY)):parts.push("c"+f.pair(outX-prevX,outY-prevY)+" "+f.pair(inX-prevX,inY-prevY)+" "+f.pair(curX-prevX,curY-prevY))),prevX=curX,prevY=curY,outX=coords[4],outY=coords[5]}if(0===length)return"";for(var i=0;i<length;i++)addSegment(segments[i]);return this._closed&&length>0&&(addSegment(segments[0],!0),parts.push("z")),parts.join("")}},{isEmpty:function(){return 0===this._segments.length},_transformContent:function(matrix){for(var coords=new Array(6),i=0,l=this._segments.length;i<l;i++)this._segments[i]._transformCoordinates(matrix,coords,!0);return!0},_add:function(segs,index){for(var segments=this._segments,curves=this._curves,amount=segs.length,append=null==index,index=append?segments.length:index,i=0;i<amount;i++){var segment=segs[i];segment._path&&(segment=segs[i]=segment.clone()),segment._path=this,segment._index=index+i,segment._selectionState&&this._updateSelection(segment,0,segment._selectionState)}if(append)segments.push.apply(segments,segs);else{segments.splice.apply(segments,[index,0].concat(segs));for(var i=index+amount,l=segments.length;i<l;i++)segments[i]._index=i}if(curves){var total=this._countCurves(),from=index+amount-1===total?index-1:index,start=from,to=Math.min(from+amount,total);segs._curves&&(curves.splice.apply(curves,[from,0].concat(segs._curves)),start+=segs._curves.length);for(var i=start;i<to;i++)curves.splice(i,0,new Curve(this,null,null));this._adjustCurves(from,to)}return this._changed(25),segs},_adjustCurves:function(from,to){for(var segments=this._segments,curves=this._curves,curve,i=from;i<to;i++)(curve=curves[i])._path=this,curve._segment1=segments[i],curve._segment2=segments[i+1]||segments[0],curve._changed();(curve=curves[this._closed&&0===from?segments.length-1:from-1])&&(curve._segment2=segments[from]||segments[0],curve._changed()),(curve=curves[to])&&(curve._segment1=segments[to],curve._changed())},_countCurves:function(){var length=this._segments.length;return!this._closed&&length>0?length-1:length},add:function(segment1){return arguments.length>1&&"number"!=typeof segment1?this._add(Segment.readAll(arguments)):this._add([Segment.read(arguments)])[0]},insert:function(index,segment1){return arguments.length>2&&"number"!=typeof segment1?this._add(Segment.readAll(arguments,1),index):this._add([Segment.read(arguments,1)],index)[0]},addSegment:function(){return this._add([Segment.read(arguments)])[0]},insertSegment:function(index){return this._add([Segment.read(arguments,1)],index)[0]},addSegments:function(segments){return this._add(Segment.readAll(segments))},insertSegments:function(index,segments){return this._add(Segment.readAll(segments),index)},removeSegment:function(index){return this.removeSegments(index,index+1)[0]||null},removeSegments:function(from,to,_includeCurves){from=from||0,to=Base.pick(to,this._segments.length);var segments=this._segments,curves=this._curves,count=segments.length,removed=segments.splice(from,to-from),amount=removed.length;if(!amount)return removed;for(var i=0;i<amount;i++){var segment=removed[i];segment._selectionState&&this._updateSelection(segment,segment._selectionState,0),segment._index=segment._path=null}for(var i=from,l=segments.length;i<l;i++)segments[i]._index=i;if(curves){var index=from>0&&to===count+(this._closed?1:0)?from-1:from,curves=curves.splice(index,amount);_includeCurves&&(removed._curves=curves.slice(1)),this._adjustCurves(index,index)}return this._changed(25),removed},clear:"#removeSegments",hasHandles:function(){for(var segments=this._segments,i=0,l=segments.length;i<l;i++)if(segments[i].hasHandles())return!0;return!1},clearHandles:function(){for(var segments=this._segments,i=0,l=segments.length;i<l;i++)segments[i].clearHandles()},getLength:function(){if(null==this._length){for(var curves=this.getCurves(),length=0,i=0,l=curves.length;i<l;i++)length+=curves[i].getLength();this._length=length}return this._length},getArea:function(){if(null==this._area){for(var segments=this._segments,count=segments.length,last=count-1,area=0,i=0,l=this._closed?count:last;i<l;i++)area+=Curve.getArea(Curve.getValues(segments[i],segments[i<last?i+1:0]));this._area=area}return this._area},isClockwise:function(){return this._clockwise!==undefined?this._clockwise:this.getArea()>=0},setClockwise:function(clockwise){this.isClockwise()!=(clockwise=!!clockwise)&&this.reverse(),this._clockwise=clockwise},isFullySelected:function(){var length=this._segments.length;return this._selected&&length>0&&this._selectedSegmentState===7*length},setFullySelected:function(selected){selected&&this._selectSegments(!0),this.setSelected(selected)},setSelected:function setSelected(selected){selected||this._selectSegments(!1),setSelected.base.call(this,selected)},_selectSegments:function(selected){var length=this._segments.length;this._selectedSegmentState=selected?7*length:0;for(var i=0;i<length;i++)this._segments[i]._selectionState=selected?7:0},_updateSelection:function(segment,oldState,newState){var total;segment._selectionState=newState,(this._selectedSegmentState+=newState-oldState)>0&&this.setSelected(!0)},flatten:function(maxDistance){for(var iterator=new PathIterator(this,64,.1),pos=0,step=iterator.length/Math.ceil(iterator.length/maxDistance),end=iterator.length+(this._closed?-step:step)/2,segments=[];pos<=end;)segments.push(new Segment(iterator.getPointAt(pos))),pos+=step;this.setSegments(segments)},reduce:function(){for(var curves=this.getCurves(),i=curves.length-1;i>=0;i--){var curve=curves[i];curve.hasHandles()||0!==curve.getLength()&&!curve.isCollinear(curve.getNext())||curve.remove()}return this},simplify:function(tolerance){if(this._segments.length>2){var fitter=new PathFitter(this,tolerance||2.5);this.setSegments(fitter.fit())}},split:function(index,parameter){if(null===parameter)return null;if(1===arguments.length){var arg=index;if("number"==typeof arg&&(arg=this.getLocationAt(arg)),!arg)return null;index=arg.index,parameter=arg.parameter}var tMin=4e-7,tMax;parameter>=1-4e-7&&(index++,parameter--);var curves=this.getCurves();if(index>=0&&index<curves.length){parameter>=4e-7&&curves[index++].divide(parameter,!0);var segs=this.removeSegments(index,this._segments.length,!0),path;return this._closed?(this.setClosed(!1),path=this):((path=new Path(Item.NO_INSERT)).insertAbove(this,!0),this._clone(path)),path._add(segs,0),this.addSegment(segs[0]),path}return null},reverse:function(){this._segments.reverse();for(var i=0,l=this._segments.length;i<l;i++){var segment=this._segments[i],handleIn=segment._handleIn;segment._handleIn=segment._handleOut,segment._handleOut=handleIn,segment._index=i}this._curves=null,this._clockwise!==undefined&&(this._clockwise=!this._clockwise),this._changed(9)},join:function(path){if(path){var segments=path._segments,last1=this.getLastSegment(),last2=path.getLastSegment();if(!last2)return this;last1&&last1._point.equals(last2._point)&&path.reverse();var first2=path.getFirstSegment();if(last1&&last1._point.equals(first2._point))last1.setHandleOut(first2._handleOut),this._add(segments.slice(1));else{var first1=this.getFirstSegment();first1&&first1._point.equals(first2._point)&&path.reverse(),last2=path.getLastSegment(),first1&&first1._point.equals(last2._point)?(first1.setHandleIn(last2._handleIn),this._add(segments.slice(0,segments.length-1),0)):this._add(segments.slice())}path._closed&&this._add([segments[0]]),path.remove()}var first=this.getFirstSegment(),last=this.getLastSegment();return first!==last&&first._point.equals(last._point)&&(first.setHandleIn(last._handleIn),last.remove(),this.setClosed(!0)),this},toShape:function(insert){if(!this._closed)return null;var segments=this._segments,type,size,radius,topCenter;function isCollinear(i,j){var seg1=segments[i],seg2=seg1.getNext(),seg3=segments[j],seg4=seg3.getNext();return seg1._handleOut.isZero()&&seg2._handleIn.isZero()&&seg3._handleOut.isZero()&&seg4._handleIn.isZero()&&seg2._point.subtract(seg1._point).isCollinear(seg4._point.subtract(seg3._point))}function isOrthogonal(i){var seg2=segments[i],seg1=seg2.getPrevious(),seg3=seg2.getNext();return seg1._handleOut.isZero()&&seg2._handleIn.isZero()&&seg2._handleOut.isZero()&&seg3._handleIn.isZero()&&seg2._point.subtract(seg1._point).isOrthogonal(seg3._point.subtract(seg2._point))}function isArc(i){var seg1=segments[i],seg2=seg1.getNext(),handle1=seg1._handleOut,handle2=seg2._handleIn,kappa=.5522847498307936;if(handle1.isOrthogonal(handle2)){var pt1=seg1._point,pt2=seg2._point,corner=new Line(pt1,handle1,!0).intersect(new Line(pt2,handle2,!0),!0);return corner&&Numerical.isZero(handle1.getLength()/corner.subtract(pt1).getLength()-kappa)&&Numerical.isZero(handle2.getLength()/corner.subtract(pt2).getLength()-kappa)}return!1}function getDistance(i,j){return segments[i]._point.getDistance(segments[j]._point)}if(!this.hasHandles()&&4===segments.length&&isCollinear(0,2)&&isCollinear(1,3)&&isOrthogonal(1)?(type=Shape.Rectangle,size=new Size(getDistance(0,3),getDistance(0,1)),topCenter=segments[1]._point.add(segments[2]._point).divide(2)):8===segments.length&&isArc(0)&&isArc(2)&&isArc(4)&&isArc(6)&&isCollinear(1,5)&&isCollinear(3,7)?(type=Shape.Rectangle,radius=(size=new Size(getDistance(1,6),getDistance(0,3))).subtract(new Size(getDistance(0,7),getDistance(1,2))).divide(2),topCenter=segments[3]._point.add(segments[4]._point).divide(2)):4===segments.length&&isArc(0)&&isArc(1)&&isArc(2)&&isArc(3)&&(Numerical.isZero(getDistance(0,2)-getDistance(1,3))?(type=Shape.Circle,radius=getDistance(0,2)/2):(type=Shape.Ellipse,radius=new Size(getDistance(2,0)/2,getDistance(3,1)/2)),topCenter=segments[1]._point),type){var center=this.getPosition(!0),shape=this._clone(new type({center:center,size:size,radius:radius,insert:!1}),insert,!1);return shape.rotate(topCenter.subtract(center).getAngle()+90),shape}return null},_hitTestSelf:function(point,options){var that=this,style=this.getStyle(),segments=this._segments,numSegments=segments.length,closed=this._closed,tolerancePadding=options._tolerancePadding,strokePadding=tolerancePadding,join,cap,miterLimit,area,loc,res,hitStroke=options.stroke&&style.hasStroke(),hitFill=options.fill&&style.hasFill(),hitCurves=options.curves,radius=hitStroke?style.getStrokeWidth()/2:hitFill&&options.tolerance>0||hitCurves?0:null;function isCloseEnough(pt,padding){return point.subtract(pt).divide(padding).length<=1}function checkSegmentPoint(seg,pt,name){if(!options.selected||pt.isSelected()){var anchor=seg._point;if(pt!==anchor&&(pt=pt.add(anchor)),isCloseEnough(pt,strokePadding))return new HitResult(name,that,{segment:seg,point:pt})}}function checkSegmentPoints(seg,ends){return(ends||options.segments)&&checkSegmentPoint(seg,seg._point,"segment")||!ends&&options.handles&&(checkSegmentPoint(seg,seg._handleIn,"handle-in")||checkSegmentPoint(seg,seg._handleOut,"handle-out"))}function addToArea(point){area.add(point)}function checkSegmentStroke(segment){var loc;if(("round"!==join||"round"!==cap)&&(area=new Path({internal:!0,closed:!0}),closed||segment._index>0&&segment._index<numSegments-1?"round"!==join&&(segment._handleIn.isZero()||segment._handleOut.isZero())&&Path._addBevelJoin(segment,join,radius,miterLimit,addToArea,!0):"round"!==cap&&Path._addSquareCap(segment,cap,radius,addToArea,!0),!area.isEmpty()))return area.contains(point)||(loc=area.getNearestLocation(point))&&isCloseEnough(loc.getPoint(),tolerancePadding);return isCloseEnough(segment._point,strokePadding)}if(null!==radius&&(radius>0?(join=style.getStrokeJoin(),cap=style.getStrokeCap(),miterLimit=radius*style.getMiterLimit(),strokePadding=tolerancePadding.add(new Point(radius,radius))):join=cap="round"),!options.ends||options.segments||closed){if(options.segments||options.handles)for(var i=0;i<numSegments;i++)if(res=checkSegmentPoints(segments[i]))return res}else if(res=checkSegmentPoints(segments[0],!0)||checkSegmentPoints(segments[numSegments-1],!0))return res;if(null!==radius){if(loc=this.getNearestLocation(point)){var parameter=loc.getParameter();0===parameter||1===parameter&&numSegments>1?checkSegmentStroke(loc.getSegment())||(loc=null):isCloseEnough(loc.getPoint(),strokePadding)||(loc=null)}if(!loc&&"miter"===join&&numSegments>1)for(var i=0;i<numSegments;i++){var segment=segments[i];if(point.getDistance(segment._point)<=miterLimit&&checkSegmentStroke(segment)){loc=segment.getLocation();break}}}return!loc&&hitFill&&this._contains(point)||loc&&!hitStroke&&!hitCurves?new HitResult("fill",this):loc?new HitResult(hitStroke?"stroke":"curve",this,{location:loc,point:loc.getPoint()}):null}},Base.each(Curve.evaluateMethods,function(name){this[name+"At"]=function(offset,isParameter){var loc=this.getLocationAt(offset,isParameter);return loc&&loc[name]()}},{beans:!1,getLocationOf:function(){for(var point=Point.read(arguments),curves=this.getCurves(),i=0,l=curves.length;i<l;i++){var loc=curves[i].getLocationOf(point);if(loc)return loc}return null},getOffsetOf:function(){var loc=this.getLocationOf.apply(this,arguments);return loc?loc.getOffset():null},getLocationAt:function(offset,isParameter){var curves=this.getCurves(),length=0;if(isParameter){var index=~~offset,curve;return(curve=curves[index])?curve.getLocationAt(offset-index,!0):null}for(var i=0,l=curves.length;i<l;i++){var start=length,curve;if((length+=(curve=curves[i]).getLength())>offset)return curve.getLocationAt(offset-start)}return curves.length>0&&offset<=this.getLength()?new CurveLocation(curves[curves.length-1],1):null},getNearestLocation:function(){for(var point=Point.read(arguments),curves=this.getCurves(),minDist=1/0,minLoc=null,i=0,l=curves.length;i<l;i++){var loc=curves[i].getNearestLocation(point);loc._distance<minDist&&(minDist=loc._distance,minLoc=loc)}return minLoc},getNearestPoint:function(){return this.getNearestLocation.apply(this,arguments).getPoint()}}),new function(){function drawHandles(ctx,segments,matrix,size){var half=size/2;function drawHandle(index){var hX=coords[index],hY=coords[index+1];pX==hX&&pY==hY||(ctx.beginPath(),ctx.moveTo(pX,pY),ctx.lineTo(hX,hY),ctx.stroke(),ctx.beginPath(),ctx.arc(hX,hY,half,0,2*Math.PI,!0),ctx.fill())}for(var coords=new Array(6),i=0,l=segments.length;i<l;i++){var segment=segments[i];segment._transformCoordinates(matrix,coords,!1);var state=segment._selectionState,pX=coords[0],pY=coords[1];if(1&state&&drawHandle(2),2&state&&drawHandle(4),ctx.fillRect(pX-half,pY-half,size,size),!(4&state)){var fillStyle=ctx.fillStyle;ctx.fillStyle="#ffffff",ctx.fillRect(pX-half+1,pY-half+1,size-2,size-2),ctx.fillStyle=fillStyle}}}function drawSegments(ctx,path,matrix){var segments=path._segments,length=segments.length,coords=new Array(6),first=!0,curX,curY,prevX,prevY,inX,inY,outX,outY;function drawSegment(segment){if(matrix)segment._transformCoordinates(matrix,coords,!1),curX=coords[0],curY=coords[1];else{var point=segment._point;curX=point._x,curY=point._y}if(first)ctx.moveTo(curX,curY),first=!1;else{if(matrix)inX=coords[2],inY=coords[3];else{var handle=segment._handleIn;inX=curX+handle._x,inY=curY+handle._y}inX===curX&&inY===curY&&outX===prevX&&outY===prevY?ctx.lineTo(curX,curY):ctx.bezierCurveTo(outX,outY,inX,inY,curX,curY)}if(prevX=curX,prevY=curY,matrix)outX=coords[4],outY=coords[5];else{var handle=segment._handleOut;outX=prevX+handle._x,outY=prevY+handle._y}}for(var i=0;i<length;i++)drawSegment(segments[i]);path._closed&&length>0&&drawSegment(segments[0])}return{_draw:function(ctx,param,strokeMatrix){var dontStart=param.dontStart,dontPaint=param.dontFinish||param.clip,style=this.getStyle(),hasFill=style.hasFill(),hasStroke=style.hasStroke(),dashArray=style.getDashArray(),dashLength=!paper.support.nativeDash&&hasStroke&&dashArray&&dashArray.length;function getOffset(i){return dashArray[(i%dashLength+dashLength)%dashLength]}if(dontStart||ctx.beginPath(),!dontStart&&this._currentPath?ctx.currentPath=this._currentPath:(hasFill||hasStroke&&!dashLength||dontPaint)&&(drawSegments(ctx,this,strokeMatrix),this._closed&&ctx.closePath(),dontStart||(this._currentPath=ctx.currentPath)),!dontPaint&&(hasFill||hasStroke)&&(this._setStyles(ctx),hasFill&&(ctx.fill(style.getWindingRule()),ctx.shadowColor="rgba(0,0,0,0)"),hasStroke)){if(dashLength){dontStart||ctx.beginPath();var iterator=new PathIterator(this,32,.25,strokeMatrix),length=iterator.length,from=-style.getDashOffset(),to,i=0;for(from%=length;from>0;)from-=getOffset(i--)+getOffset(i--);for(;from<length;)to=from+getOffset(i++),(from>0||to>0)&&iterator.drawPart(ctx,Math.max(from,0),Math.max(to,0)),from=to+getOffset(i++)}ctx.stroke()}},_drawSelected:function(ctx,matrix){ctx.beginPath(),drawSegments(ctx,this,matrix),ctx.stroke(),drawHandles(ctx,this._segments,matrix,paper.settings.handleSize)}}},new function(){function getFirstControlPoints(rhs){var n=rhs.length,x=[],tmp=[],b=2;x[0]=rhs[0]/b;for(var i=1;i<n;i++)tmp[i]=1/b,b=(i<n-1?4:2)-tmp[i],x[i]=(rhs[i]-x[i-1])/b;for(var i=1;i<n;i++)x[n-i-1]-=tmp[n-i]*x[n-i];return x}return{smooth:function(){var segments=this._segments,size=segments.length,closed=this._closed,n=size,overlap=0;if(!(size<=2)){closed&&(overlap=Math.min(size,4),n+=2*Math.min(size,overlap));for(var knots=[],i=0;i<size;i++)knots[i+overlap]=segments[i]._point;if(closed)for(var i=0;i<overlap;i++)knots[i]=segments[i+size-overlap]._point,knots[i+size+overlap]=segments[i]._point;else n--;for(var rhs=[],i=1;i<n-1;i++)rhs[i]=4*knots[i]._x+2*knots[i+1]._x;rhs[0]=knots[0]._x+2*knots[1]._x,rhs[n-1]=3*knots[n-1]._x;for(var x=getFirstControlPoints(rhs),i=1;i<n-1;i++)rhs[i]=4*knots[i]._y+2*knots[i+1]._y;rhs[0]=knots[0]._y+2*knots[1]._y,rhs[n-1]=3*knots[n-1]._y;var y=getFirstControlPoints(rhs);if(closed){for(var i=0,j=size;i<overlap;i++,j++){var f1=i/overlap,f2=1-f1,ie=i+overlap,je=j+overlap;x[j]=x[i]*f1+x[j]*f2,y[j]=y[i]*f1+y[j]*f2,x[je]=x[ie]*f2+x[je]*f1,y[je]=y[ie]*f2+y[je]*f1}n--}for(var handleIn=null,i=overlap,segment;i<=n-overlap;i++){var segment=segments[i-overlap];handleIn&&segment.setHandleIn(handleIn.subtract(segment._point)),i<n&&(segment.setHandleOut(new Point(x[i],y[i]).subtract(segment._point)),handleIn=i<n-1?new Point(2*knots[i+1]._x-x[i+1],2*knots[i+1]._y-y[i+1]):new Point((knots[n]._x+x[n-1])/2,(knots[n]._y+y[n-1])/2))}if(closed&&handleIn)(segment=this._segments[0]).setHandleIn(handleIn.subtract(segment._point))}}}},new function(){function getCurrentSegment(that){var segments=that._segments;if(0===segments.length)throw new Error("Use a moveTo() command first");return segments[segments.length-1]}return{moveTo:function(){var segments=this._segments;1===segments.length&&this.removeSegment(0),segments.length||this._add([new Segment(Point.read(arguments))])},moveBy:function(){throw new Error("moveBy() is unsupported on Path items.")},lineTo:function(){this._add([new Segment(Point.read(arguments))])},cubicCurveTo:function(){var handle1=Point.read(arguments),handle2=Point.read(arguments),to=Point.read(arguments),current=getCurrentSegment(this);current.setHandleOut(handle1.subtract(current._point)),this._add([new Segment(to,handle2.subtract(to))])},quadraticCurveTo:function(){var handle=Point.read(arguments),to=Point.read(arguments),current=getCurrentSegment(this)._point;this.cubicCurveTo(handle.add(current.subtract(handle).multiply(1/3)),handle.add(to.subtract(handle).multiply(1/3)),to)},curveTo:function(){var through=Point.read(arguments),to=Point.read(arguments),t=Base.pick(Base.read(arguments),.5),t1=1-t,current=getCurrentSegment(this)._point,handle=through.subtract(current.multiply(t1*t1)).subtract(to.multiply(t*t)).divide(2*t*t1);if(handle.isNaN())throw new Error("Cannot put a curve through points with parameter = "+t);this.quadraticCurveTo(handle,to)},arcTo:function(){var current=getCurrentSegment(this),from=current._point,to=Point.read(arguments),through,peek=Base.peek(arguments),clockwise,center,extent,vector,matrix;if("boolean"==typeof(clockwise=Base.pick(peek,!0)))var middle,through=(middle=from.add(to).divide(2)).add(middle.subtract(from).rotate(clockwise?-90:90));else if(Base.remain(arguments)<=2)through=to,to=Point.read(arguments);else{var radius=Size.read(arguments);if(radius.isZero())return this.lineTo(to);var rotation=Base.read(arguments),clockwise=!!Base.read(arguments),large=!!Base.read(arguments),middle=from.add(to).divide(2),pt,x=(pt=from.subtract(middle).rotate(-rotation)).x,y=pt.y,abs=Math.abs,rx=abs(radius.width),ry=abs(radius.height),rxSq=rx*rx,rySq=ry*ry,xSq=x*x,ySq=y*y,factor=Math.sqrt(xSq/rxSq+ySq/rySq);if(factor>1&&(rxSq=(rx*=factor)*rx,rySq=(ry*=factor)*ry),abs(factor=(rxSq*rySq-rxSq*ySq-rySq*xSq)/(rxSq*ySq+rySq*xSq))<1e-12&&(factor=0),factor<0)throw new Error("Cannot create an arc with the given arguments");center=new Point(rx*y/ry,-ry*x/rx).multiply((large===clockwise?-1:1)*Math.sqrt(factor)).rotate(rotation).add(middle),extent=(vector=(matrix=(new Matrix).translate(center).rotate(rotation).scale(rx,ry))._inverseTransform(from)).getDirectedAngle(matrix._inverseTransform(to)),!clockwise&&extent>0?extent-=360:clockwise&&extent<0&&(extent+=360)}if(through){var l1=new Line(from.add(through).divide(2),through.subtract(from).rotate(90),!0),l2=new Line(through.add(to).divide(2),to.subtract(through).rotate(90),!0),line=new Line(from,to),throughSide=line.getSide(through);if(!(center=l1.intersect(l2,!0))){if(!throughSide)return this.lineTo(to);throw new Error("Cannot create an arc with the given arguments")}extent=(vector=from.subtract(center)).getDirectedAngle(to.subtract(center));var centerSide=line.getSide(center);0===centerSide?extent=throughSide*Math.abs(extent):throughSide===centerSide&&(extent+=extent<0?360:-360)}for(var ext=Math.abs(extent),count=ext>=360?4:Math.ceil(ext/90),inc=extent/count,half=inc*Math.PI/360,z=4/3*Math.sin(half)/(1+Math.cos(half)),segments=[],i=0;i<=count;i++){var pt=to,out=null;if(i<count&&(out=vector.rotate(90).multiply(z),matrix?(pt=matrix._transformPoint(vector),out=matrix._transformPoint(vector.add(out)).subtract(pt)):pt=center.add(vector)),0===i)current.setHandleOut(out);else{var _in=vector.rotate(-90).multiply(z);matrix&&(_in=matrix._transformPoint(vector.add(_in)).subtract(pt)),segments.push(new Segment(pt,_in,out))}vector=vector.rotate(inc)}this._add(segments)},lineBy:function(){var to=Point.read(arguments),current=getCurrentSegment(this)._point;this.lineTo(current.add(to))},curveBy:function(){var through=Point.read(arguments),to=Point.read(arguments),parameter=Base.read(arguments),current=getCurrentSegment(this)._point;this.curveTo(current.add(through),current.add(to),parameter)},cubicCurveBy:function(){var handle1=Point.read(arguments),handle2=Point.read(arguments),to=Point.read(arguments),current=getCurrentSegment(this)._point;this.cubicCurveTo(current.add(handle1),current.add(handle2),current.add(to))},quadraticCurveBy:function(){var handle=Point.read(arguments),to=Point.read(arguments),current=getCurrentSegment(this)._point;this.quadraticCurveTo(current.add(handle),current.add(to))},arcBy:function(){var current=getCurrentSegment(this)._point,point=current.add(Point.read(arguments)),clockwise=Base.pick(Base.peek(arguments),!0);"boolean"==typeof clockwise?this.arcTo(point,clockwise):this.arcTo(point,current.add(Point.read(arguments)))},closePath:function(join){this.setClosed(!0),join&&this.join()}}},{_getBounds:function(getter,matrix){return Path[getter](this._segments,this._closed,this.getStyle(),matrix)},statics:{getBounds:function(segments,closed,style,matrix,strokePadding){var first=segments[0];if(!first)return new Rectangle;var coords=new Array(6),prevCoords=first._transformCoordinates(matrix,new Array(6),!1),min=prevCoords.slice(0,2),max=min.slice(),roots=new Array(2);function processSegment(segment){segment._transformCoordinates(matrix,coords,!1);for(var i=0;i<2;i++)Curve._addBounds(prevCoords[i],prevCoords[i+4],coords[i+2],coords[i],i,strokePadding?strokePadding[i]:0,min,max,roots);var tmp=prevCoords;prevCoords=coords,coords=tmp}for(var i=1,l=segments.length;i<l;i++)processSegment(segments[i]);return closed&&processSegment(first),new Rectangle(min[0],min[1],max[0]-min[0],max[1]-min[1])},getStrokeBounds:function(segments,closed,style,matrix){if(!style.hasStroke())return Path.getBounds(segments,closed,style,matrix);var length=segments.length-(closed?0:1),radius=style.getStrokeWidth()/2,padding=Path._getPenPadding(radius,matrix),bounds=Path.getBounds(segments,closed,style,matrix,padding),join=style.getStrokeJoin(),cap=style.getStrokeCap(),miterLimit=radius*style.getMiterLimit(),joinBounds=new Rectangle(new Size(padding).multiply(2));function add(point){bounds=bounds.include(matrix?matrix._transformPoint(point,point):point)}function addRound(segment){bounds=bounds.unite(joinBounds.setCenter(matrix?matrix._transformPoint(segment._point):segment._point))}function addJoin(segment,join){var handleIn=segment._handleIn,handleOut=segment._handleOut;"round"===join||!handleIn.isZero()&&!handleOut.isZero()&&handleIn.isCollinear(handleOut)?addRound(segment):Path._addBevelJoin(segment,join,radius,miterLimit,add)}function addCap(segment,cap){"round"===cap?addRound(segment):Path._addSquareCap(segment,cap,radius,add)}for(var i=1;i<length;i++)addJoin(segments[i],join);return closed?addJoin(segments[0],join):length>0&&(addCap(segments[0],cap),addCap(segments[segments.length-1],cap)),bounds},_getPenPadding:function(radius,matrix){if(!matrix)return[radius,radius];var mx=matrix.shiftless(),hor=mx.transform(new Point(radius,0)),ver=mx.transform(new Point(0,radius)),phi=hor.getAngleInRadians(),a=hor.getLength(),b=ver.getLength(),sin=Math.sin(phi),cos=Math.cos(phi),tan=Math.tan(phi),tx=-Math.atan(b*tan/a),ty=Math.atan(b/(tan*a));return[Math.abs(a*Math.cos(tx)*cos-b*Math.sin(tx)*sin),Math.abs(b*Math.sin(ty)*cos+a*Math.cos(ty)*sin)]},_addBevelJoin:function(segment,join,radius,miterLimit,addPoint,area){var curve2=segment.getCurve(),curve1=curve2.getPrevious(),point=curve2.getPointAt(0,!0),normal1=curve1.getNormalAt(1,!0),normal2=curve2.getNormalAt(0,!0),step=normal1.getDirectedAngle(normal2)<0?-radius:radius;if(normal1.setLength(step),normal2.setLength(step),area&&(addPoint(point),addPoint(point.add(normal1))),"miter"===join){var corner=new Line(point.add(normal1),new Point(-normal1.y,normal1.x),!0).intersect(new Line(point.add(normal2),new Point(-normal2.y,normal2.x),!0),!0);if(corner&&point.getDistance(corner)<=miterLimit&&(addPoint(corner),!area))return}area||addPoint(point.add(normal1)),addPoint(point.add(normal2))},_addSquareCap:function(segment,cap,radius,addPoint,area){var point=segment._point,loc=segment.getLocation(),normal=loc.getNormal().multiply(radius);area&&(addPoint(point.subtract(normal)),addPoint(point.add(normal))),"square"===cap&&(point=point.add(normal.rotate(0===loc.getParameter()?-90:90))),addPoint(point.add(normal)),addPoint(point.subtract(normal))},getHandleBounds:function(segments,closed,style,matrix,strokePadding,joinPadding){for(var coords=new Array(6),x1=1/0,x2=-x1,y1=x1,y2=x2,i=0,l=segments.length;i<l;i++){var segment;segments[i]._transformCoordinates(matrix,coords,!1);for(var j=0;j<6;j+=2){var padding=0===j?joinPadding:strokePadding,paddingX=padding?padding[0]:0,paddingY=padding?padding[1]:0,x=coords[j],y=coords[j+1],xn=x-paddingX,xx=x+paddingX,yn=y-paddingY,yx=y+paddingY;xn<x1&&(x1=xn),xx>x2&&(x2=xx),yn<y1&&(y1=yn),yx>y2&&(y2=yx)}}return new Rectangle(x1,y1,x2-x1,y2-y1)},getRoughBounds:function(segments,closed,style,matrix){var strokeRadius=style.hasStroke()?style.getStrokeWidth()/2:0,joinRadius=strokeRadius;return strokeRadius>0&&("miter"===style.getStrokeJoin()&&(joinRadius=strokeRadius*style.getMiterLimit()),"square"===style.getStrokeCap()&&(joinRadius=Math.max(joinRadius,strokeRadius*Math.sqrt(2)))),Path.getHandleBounds(segments,closed,style,matrix,Path._getPenPadding(strokeRadius,matrix),Path._getPenPadding(joinRadius,matrix))}}});Path.inject({statics:new function(){var kappa=.5522847498307936,ellipseSegments=[new Segment([-1,0],[0,kappa],[0,-kappa]),new Segment([0,-1],[-kappa,0],[kappa,0]),new Segment([1,0],[0,-kappa],[0,kappa]),new Segment([0,1],[kappa,0],[-kappa,0])];function createPath(segments,closed,args){var props=Base.getNamed(args),path=new Path(props&&!1===props.insert&&Item.NO_INSERT);return path._add(segments),path._closed=closed,path.set(props)}function createEllipse(center,radius,args){for(var segments=new Array(4),i=0;i<4;i++){var segment=ellipseSegments[i];segments[i]=new Segment(segment._point.multiply(radius).add(center),segment._handleIn.multiply(radius),segment._handleOut.multiply(radius))}return createPath(segments,!0,args)}return{Line:function(){return createPath([new Segment(Point.readNamed(arguments,"from")),new Segment(Point.readNamed(arguments,"to"))],!1,arguments)},Circle:function(){var center=Point.readNamed(arguments,"center"),radius=Base.readNamed(arguments,"radius");return createEllipse(center,new Size(radius),arguments)},Rectangle:function(){var rect=Rectangle.readNamed(arguments,"rectangle"),radius=Size.readNamed(arguments,"radius",0,{readNull:!0}),bl=rect.getBottomLeft(!0),tl=rect.getTopLeft(!0),tr=rect.getTopRight(!0),br=rect.getBottomRight(!0),segments;if(!radius||radius.isZero())segments=[new Segment(bl),new Segment(tl),new Segment(tr),new Segment(br)];else{var rx=(radius=Size.min(radius,rect.getSize(!0).divide(2))).width,ry=radius.height,hx=rx*kappa,hy=ry*kappa;segments=[new Segment(bl.add(rx,0),null,[-hx,0]),new Segment(bl.subtract(0,ry),[0,hy]),new Segment(tl.add(0,ry),null,[0,-hy]),new Segment(tl.add(rx,0),[-hx,0],null),new Segment(tr.subtract(rx,0),null,[hx,0]),new Segment(tr.add(0,ry),[0,-hy],null),new Segment(br.subtract(0,ry),null,[0,hy]),new Segment(br.subtract(rx,0),[hx,0])]}return createPath(segments,!0,arguments)},RoundRectangle:"#Rectangle",Ellipse:function(){var ellipse=Shape._readEllipse(arguments);return createEllipse(ellipse.center,ellipse.radius,arguments)},Oval:"#Ellipse",Arc:function(){var from=Point.readNamed(arguments,"from"),through=Point.readNamed(arguments,"through"),to=Point.readNamed(arguments,"to"),props=Base.getNamed(arguments),path=new Path(props&&!1===props.insert&&Item.NO_INSERT);return path.moveTo(from),path.arcTo(through,to),path.set(props)},RegularPolygon:function(){for(var center=Point.readNamed(arguments,"center"),sides=Base.readNamed(arguments,"sides"),radius=Base.readNamed(arguments,"radius"),step=360/sides,three=!(sides%3),vector=new Point(0,three?-radius:radius),offset=three?-1:.5,segments=new Array(sides),i=0;i<sides;i++)segments[i]=new Segment(center.add(vector.rotate((i+offset)*step)));return createPath(segments,!0,arguments)},Star:function(){for(var center=Point.readNamed(arguments,"center"),points=2*Base.readNamed(arguments,"points"),radius1=Base.readNamed(arguments,"radius1"),radius2=Base.readNamed(arguments,"radius2"),step=360/points,vector=new Point(0,-1),segments=new Array(points),i=0;i<points;i++)segments[i]=new Segment(center.add(vector.rotate(step*i).multiply(i%2?radius2:radius1)));return createPath(segments,!0,arguments)}}}});var CompoundPath=PathItem.extend({_class:"CompoundPath",_serializeFields:{children:[]},initialize:function CompoundPath(arg){this._children=[],this._namedChildren={},this._initialize(arg)||("string"==typeof arg?this.setPathData(arg):this.addChildren(Array.isArray(arg)?arg:arguments))},insertChildren:function insertChildren(index,items,_preserve){for(var i=items.length-1;i>=0;i--){var item;(item=items[i])instanceof CompoundPath&&(items.splice.apply(items,[i,1].concat(item.removeChildren())),item.remove())}items=insertChildren.base.call(this,index,items,_preserve,Path);for(var i=0,l=!_preserve&&items&&items.length;i<l;i++){var item;(item=items[i])._clockwise===undefined&&item.setClockwise(0===item._index)}return items},reverse:function(){for(var children=this._children,i=0,l=children.length;i<l;i++)children[i].reverse()},smooth:function(){for(var i=0,l=this._children.length;i<l;i++)this._children[i].smooth()},reduce:function reduce(){for(var children=this._children,i=children.length-1,path;i>=0;i--){var path;(path=children[i].reduce()).isEmpty()&&children.splice(i,1)}return 0===children.length?((path=new Path(Item.NO_INSERT)).insertAbove(this),path.setStyle(this._style),this.remove(),path):reduce.base.call(this)},isClockwise:function(){var child=this.getFirstChild();return child&&child.isClockwise()},setClockwise:function(clockwise){this.isClockwise()!==!!clockwise&&this.reverse()},getFirstSegment:function(){var first=this.getFirstChild();return first&&first.getFirstSegment()},getLastSegment:function(){var last=this.getLastChild();return last&&last.getLastSegment()},getCurves:function(){for(var children=this._children,curves=[],i=0,l=children.length;i<l;i++)curves.push.apply(curves,children[i].getCurves());return curves},getFirstCurve:function(){var first=this.getFirstChild();return first&&first.getFirstCurve()},getLastCurve:function(){var last=this.getLastChild();return last&&last.getFirstCurve()},getArea:function(){for(var children=this._children,area=0,i=0,l=children.length;i<l;i++)area+=children[i].getArea();return area}},{beans:!0,getPathData:function(_matrix,_precision){for(var children=this._children,paths=[],i=0,l=children.length;i<l;i++){var child=children[i],mx=child._matrix;paths.push(child.getPathData(_matrix&&!mx.isIdentity()?_matrix.chain(mx):_matrix,_precision))}return paths.join(" ")}},{_getChildHitTestOptions:function(options){return options.class===Path||"path"===options.type?options:new Base(options,{fill:!1})},_draw:function(ctx,param,strokeMatrix){var children=this._children;if(0!==children.length){if(this._currentPath)ctx.currentPath=this._currentPath;else{param=param.extend({dontStart:!0,dontFinish:!0}),ctx.beginPath();for(var i=0,l=children.length;i<l;i++)children[i].draw(ctx,param,strokeMatrix);this._currentPath=ctx.currentPath}if(!param.clip){this._setStyles(ctx);var style=this._style;style.hasFill()&&(ctx.fill(style.getWindingRule()),ctx.shadowColor="rgba(0,0,0,0)"),style.hasStroke()&&ctx.stroke()}}},_drawSelected:function(ctx,matrix,selectedItems){for(var children=this._children,i=0,l=children.length;i<l;i++){var child=children[i],mx=child._matrix;selectedItems[child._id]||child._drawSelected(ctx,mx.isIdentity()?matrix:matrix.chain(mx))}}},new function(){function getCurrentPath(that,check){var children=that._children;if(check&&0===children.length)throw new Error("Use a moveTo() command first");return children[children.length-1]}var fields={moveTo:function(){var current=getCurrentPath(this),path=current&&current.isEmpty()?current:new Path(Item.NO_INSERT);path!==current&&this.addChild(path),path.moveTo.apply(path,arguments)},moveBy:function(){var current=getCurrentPath(this,!0),last=current&&current.getLastSegment(),point=Point.read(arguments);this.moveTo(last?point.add(last._point):point)},closePath:function(join){getCurrentPath(this,!0).closePath(join)}};return Base.each(["lineTo","cubicCurveTo","quadraticCurveTo","curveTo","arcTo","lineBy","cubicCurveBy","quadraticCurveBy","curveBy","arcBy"],function(key){fields[key]=function(){var path=getCurrentPath(this,!0);path[key].apply(path,arguments)}}),fields});PathItem.inject(new function(){var operators={unite:function(w){return 1===w||0===w},intersect:function(w){return 2===w},subtract:function(w){return 1===w},exclude:function(w){return 1===w}};function preparePath(path,resolve){var res=path.clone(!1).reduce().transform(null,!0,!0);return resolve?res.resolveCrossings().reorient():res}function finishBoolean(ctor,paths,path1,path2,reduce){var result=new ctor(Item.NO_INSERT);return result.addChildren(paths,!0),reduce&&(result=result.reduce()),result.insertAbove(path2&&path1.isSibling(path2)&&path1.getIndex()<path2.getIndex()?path2:path1),result.setStyle(path1._style),result}function computeBoolean(path1,path2,operation){if(!path1._children&&!path1._closed)return computeOpenBoolean(path1,path2,operation);var _path1=preparePath(path1,!0),_path2=path2&&path1!==path2&&preparePath(path2,!0);_path2&&/^(subtract|exclude)$/.test(operation)^_path2.isClockwise()!==_path1.isClockwise()&&_path2.reverse();var intersections=CurveLocation.expand(_path1.getIntersections(_path2,function(inter){return _path2&&inter.isOverlap()||inter.isCrossing()}));divideLocations(intersections);var segments=[],monoCurves=[];function collect(paths){for(var i=0,l=paths.length;i<l;i++){var path=paths[i];segments.push.apply(segments,path._segments),monoCurves.push.apply(monoCurves,path._getMonoCurves())}}collect(_path1._children||[_path1]),_path2&&collect(_path2._children||[_path2]);for(var i=0,l=intersections.length;i<l;i++)propagateWinding(intersections[i]._segment,_path1,_path2,monoCurves,operation);for(var i=0,l=segments.length;i<l;i++){var segment=segments[i];null==segment._winding&&propagateWinding(segment,_path1,_path2,monoCurves,operation)}return finishBoolean(CompoundPath,tracePaths(segments,operation),path1,path2,!0)}function computeOpenBoolean(path1,path2,operation){if(!path2||!path2._children&&!path2._closed||!/^(subtract|intersect)$/.test(operation))return null;var _path1=preparePath(path1,!1),_path2=preparePath(path2,!1),intersections=_path1.getIntersections(_path2,function(inter){return inter.isOverlap()||inter.isCrossing()}),sub="subtract"===operation,paths=[];function addPath(path){if(_path2.contains(path.getPointAt(path.getLength()/2))^sub)return paths.unshift(path),!0}for(var i=intersections.length-1;i>=0;i--){var path=intersections[i].split();path&&(addPath(path)&&path.getFirstSegment().setHandleIn(0,0),_path1.getLastSegment().setHandleOut(0,0))}return addPath(_path1),finishBoolean(Group,paths,path1,path2)}function linkIntersections(from,to){for(var prev=from;prev;){if(prev===to)return;prev=prev._prev}for(;from._next&&from._next!==to;)from=from._next;if(!from._next){for(;to._prev;)to=to._prev;from._next=to,to._prev=from}}function divideLocations(locations){for(var tMin=4e-7,tMax=1-4e-7,noHandles=!1,clearSegments=[],prevCurve,prevT,i=locations.length-1;i>=0;i--){var loc=locations[i],curve=loc._curve,t=loc._parameter,origT=t,segment;curve!==prevCurve?noHandles=!curve.hasHandles():prevT>0&&(t/=prevT),t<4e-7?segment=curve._segment1:t>tMax?segment=curve._segment2:(segment=curve.divide(t,!0,!0)._segment1,noHandles&&clearSegments.push(segment)),loc._setSegment(segment);var inter=segment._intersection,dest=loc._intersection;if(inter){linkIntersections(inter,dest);for(var other=inter;other;)linkIntersections(other._intersection,inter),other=other._next}else segment._intersection=dest;prevCurve=curve,prevT=origT}for(var i=0,l=clearSegments.length;i<l;i++)clearSegments[i].clearHandles()}function getWinding(point,curves,horizontal,testContains){var epsilon=2e-7,tMin=4e-7,tMax=1-4e-7,px=point.x,py=point.y,windLeft=0,windRight=0,roots=[],abs=Math.abs;if(horizontal){for(var yTop=-1/0,yBottom=1/0,yBefore=py-2e-7,yAfter=py+2e-7,i=0,l=curves.length;i<l;i++){var values=curves[i].values;if(Curve.solveCubic(values,0,px,roots,0,1)>0)for(var j=roots.length-1;j>=0;j--){var y=Curve.getPoint(values,roots[j]).y;y<yBefore&&y>yTop?yTop=y:y>yAfter&&y<yBottom&&(yBottom=y)}}yBottom=(yBottom+py)/2,(yTop=(yTop+py)/2)>-1/0&&(windLeft=getWinding(new Point(px,yTop),curves,!1,testContains)),yBottom<1/0&&(windRight=getWinding(new Point(px,yBottom),curves,!1,testContains))}else for(var xBefore=px-2e-7,xAfter=px+2e-7,startCounted=!1,prevCurve,prevT,i=0,l=curves.length;i<l;i++){var curve=curves[i],values=curve.values,winding=curve.winding;if(winding&&(1===winding&&py>=values[1]&&py<=values[7]||py>=values[7]&&py<=values[1])&&1===Curve.solveCubic(values,1,py,roots,0,1)){var t=roots[0];if(!(t>tMax&&startCounted&&curve.next!==curves[i+1]||t<4e-7&&prevT>tMax&&curve.previous===prevCurve)){var x=Curve.getPoint(values,t).x,slope=Curve.getTangent(values,t).y,counted=!1;Numerical.isZero(slope)&&!Curve.isStraight(values)||t<4e-7&&slope*Curve.getTangent(curve.previous.values,1).y<0||t>tMax&&slope*Curve.getTangent(curve.next.values,0).y<0?testContains&&x>=xBefore&&x<=xAfter&&(++windLeft,++windRight,counted=!0):x<=xBefore?(windLeft+=winding,counted=!0):x>=xAfter&&(windRight+=winding,counted=!0),curve.previous!==curves[i-1]&&(startCounted=t<4e-7&&counted)}prevCurve=curve,prevT=t}}return Math.max(abs(windLeft),abs(windRight))}function propagateWinding(segment,path1,path2,monoCurves,operation){var epsilon=2e-7,chain=[],start=segment,totalLength=0,windingSum=0;do{var curve,length=(curve=segment.getCurve()).getLength();chain.push({segment:segment,curve:curve,length:length}),totalLength+=length,segment=segment.getNext()}while(segment&&!segment._intersection&&segment!==start);for(var i=0;i<3;i++)for(var length=totalLength*(i+1)/4,k=0,m=chain.length;k<m;k++){var node=chain[k],curveLength=node.length;if(length<=curveLength){(length<2e-7||curveLength-length<2e-7)&&(length=curveLength/2);var curve,path=(curve=node.curve)._path,parent=path._parent,pt=curve.getPointAt(length),hor=curve.isHorizontal();parent instanceof CompoundPath&&(path=parent),windingSum+="subtract"===operation&&path2&&(path===path1&&path2._getWinding(pt,hor)||path===path2&&!path1._getWinding(pt,hor))?0:getWinding(pt,monoCurves,hor);break}length-=curveLength}for(var winding=Math.round(windingSum/3),j=chain.length-1;j>=0;j--)chain[j].segment._winding=winding}function tracePaths(segments,operation){var paths=[],start,otherStart,operator=operators[operation],overlapWinding={unite:{1:2},intersect:{2:1}}[operation];function isValid(seg,adjusted){if(seg._visited)return!1;if(!operator)return!0;var winding=seg._winding,inter=seg._intersection;return inter&&adjusted&&overlapWinding&&inter.isOverlap()&&(winding=overlapWinding[winding]||winding),operator(winding)}function isStart(seg){return seg===start||seg===otherStart}function findBestIntersection(inter,strict){if(!inter._next)return inter;for(;inter;){var seg=inter._segment,nextSeg=seg.getNext(),nextInter=nextSeg._intersection;if(isStart(nextSeg)||!seg._visited&&!nextSeg._visited&&(!operator||(!strict||isValid(seg))&&(!(strict&&nextInter&&nextInter.isOverlap())&&isValid(nextSeg)||!strict&&nextInter&&isValid(nextInter._segment))))return inter;inter=inter._next}return null}function findStartSegment(inter,next){for(;inter;){var seg=inter._segment;if(isStart(seg))return seg;inter=inter[next?"_next":"_prev"]}}for(var i=0,l=segments.length;i<l;i++){var seg=segments[i],path=null,finished=!1;if(isValid(seg,!0)){for(start=otherStart=null;!finished;){var inter=seg._intersection,handleIn=path&&seg._handleIn,other=(inter=inter&&(findBestIntersection(inter,!0)||findBestIntersection(inter,!1))||inter)&&inter._segment;if(other&&isValid(other)&&(seg=other),seg._visited){if(!(finished=isStart(seg))&&inter){var found=findStartSegment(inter,!0)||findStartSegment(inter,!1);found&&(seg=found,finished=!0)}break}path||(path=new Path(Item.NO_INSERT),start=seg,otherStart=other),path.add(new Segment(seg._point,handleIn,seg._handleOut)),seg._visited=!0,finished=isStart(seg=seg.getNext())}finished?(path.firstSegment.setHandleIn(seg._handleIn),path.setClosed(!0)):path&&(console.error("Boolean operation resulted in open path","segments =",path._segments.length,"length =",path.getLength()),path=null),path&&(path._segments.length>8||!Numerical.isZero(path.getArea()))&&(paths.push(path),path=null)}}return paths}return{_getWinding:function(point,horizontal,testContains){return getWinding(point,this._getMonoCurves(),horizontal,testContains)},unite:function(path){return computeBoolean(this,path,"unite")},intersect:function(path){return computeBoolean(this,path,"intersect")},subtract:function(path){return computeBoolean(this,path,"subtract")},exclude:function(path){return computeBoolean(this,path,"exclude")},divide:function(path){return finishBoolean(Group,[this.subtract(path),this.intersect(path)],this,path,!0)},resolveCrossings:function(){var crossings=this.getCrossings();if(!crossings.length)return this;divideLocations(CurveLocation.expand(crossings));for(var paths=this._children||[this],segments=[],i=0,l=paths.length;i<l;i++)segments.push.apply(segments,paths[i]._segments);return finishBoolean(CompoundPath,tracePaths(segments),this,null,!1)}}}),Path.inject({_getMonoCurves:function(){var monoCurves=this._monoCurves,prevCurve;function insertCurve(v){var y0=v[1],y1=v[7],curve={values:v,winding:y0===y1?0:y0>y1?-1:1,previous:prevCurve,next:null};prevCurve&&(prevCurve.next=curve),monoCurves.push(curve),prevCurve=curve}function handleCurve(v){if(0!==Curve.getLength(v)){var y0=v[1],y1=v[3],y2=v[5],y3=v[7];if(Curve.isStraight(v))insertCurve(v);else{var a=3*(y1-y2)-y0+y3,b=2*(y0+y2)-4*y1,c=y1-y0,tMin=4e-7,tMax=1-4e-7,roots=[],n=Numerical.solveQuadratic(a,b,c,roots,4e-7,tMax);if(0===n)insertCurve(v);else{roots.sort();var t=roots[0],parts=Curve.subdivide(v,t);insertCurve(parts[0]),n>1&&(t=(roots[1]-t)/(1-t),insertCurve((parts=Curve.subdivide(parts[1],t))[0])),insertCurve(parts[1])}}}}if(!monoCurves){monoCurves=this._monoCurves=[];for(var curves=this.getCurves(),segments=this._segments,i=0,l=curves.length;i<l;i++)handleCurve(curves[i].getValues());if(!this._closed&&segments.length>1){var p1=segments[segments.length-1]._point,p2=segments[0]._point,p1x=p1._x,p1y=p1._y,p2x=p2._x,p2y=p2._y;handleCurve([p1x,p1y,p1x,p1y,p2x,p2y,p2x,p2y])}if(monoCurves.length>0){var first=monoCurves[0],last=monoCurves[monoCurves.length-1];first.previous=last,last.next=first}}return monoCurves},getInteriorPoint:function(){var bounds,point=this.getBounds().getCenter(!0);if(!this.contains(point)){for(var curves=this._getMonoCurves(),roots=[],y=point.y,xIntercepts=[],i=0,l=curves.length;i<l;i++){var values=curves[i].values;if((1===curves[i].winding&&y>=values[1]&&y<=values[7]||y>=values[7]&&y<=values[1])&&Curve.solveCubic(values,1,y,roots,0,1)>0)for(var j=roots.length-1;j>=0;j--)xIntercepts.push(Curve.getPoint(values,roots[j]).x);if(xIntercepts.length>1)break}point.x=(xIntercepts[0]+xIntercepts[1])/2}return point},reorient:function(){return this.setClockwise(!0),this}}),CompoundPath.inject({_getMonoCurves:function(){for(var children=this._children,monoCurves=[],i=0,l=children.length;i<l;i++)monoCurves.push.apply(monoCurves,children[i]._getMonoCurves());return monoCurves},reorient:function(){var children=this.removeChildren().sort(function(a,b){return b.getBounds().getArea()-a.getBounds().getArea()});if(children.length>0){this.addChildren(children);for(var clockwise=children[0].isClockwise(),i=1,l=children.length;i<l;i++){for(var point=children[i].getInteriorPoint(),counters=0,j=i-1;j>=0;j--)children[j].contains(point)&&counters++;children[i].setClockwise(counters%2==0&&clockwise)}}return this}});var PathIterator=Base.extend({_class:"PathIterator",initialize:function(path,maxRecursion,tolerance,matrix){var curves=[],parts=[],length=0,minDifference=1/(maxRecursion||32),segments=path._segments,segment1=segments[0],segment2;function addCurve(segment1,segment2){var curve=Curve.getValues(segment1,segment2,matrix);curves.push(curve),computeParts(curve,segment1._index,0,1)}function computeParts(curve,index,minT,maxT){if(maxT-minT>minDifference&&!Curve.isFlatEnough(curve,tolerance||.25)){var split=Curve.subdivide(curve,.5),halfT=(minT+maxT)/2;computeParts(split[0],index,minT,halfT),computeParts(split[1],index,halfT,maxT)}else{var x=curve[6]-curve[0],y=curve[7]-curve[1],dist=Math.sqrt(x*x+y*y);dist>1e-6&&(length+=dist,parts.push({offset:length,value:maxT,index:index}))}}for(var i=1,l=segments.length;i<l;i++)addCurve(segment1,segment2=segments[i]),segment1=segment2;path._closed&&addCurve(segment2,segments[0]),this.curves=curves,this.parts=parts,this.length=length,this.index=0},getParameterAt:function(offset){for(var i,j=this.index;i=j,!(0==j||this.parts[--j].offset<offset););for(var l=this.parts.length;i<l;i++){var part;if((part=this.parts[i]).offset>=offset){this.index=i;var prev=this.parts[i-1],prevVal=prev&&prev.index==part.index?prev.value:0,prevLen=prev?prev.offset:0;return{value:prevVal+(part.value-prevVal)*(offset-prevLen)/(part.offset-prevLen),index:part.index}}}var part;return{value:1,index:(part=this.parts[this.parts.length-1]).index}},drawPart:function(ctx,from,to){from=this.getParameterAt(from),to=this.getParameterAt(to);for(var i=from.index;i<=to.index;i++){var curve=Curve.getPart(this.curves[i],i==from.index?from.value:0,i==to.index?to.value:1);i==from.index&&ctx.moveTo(curve[0],curve[1]),ctx.bezierCurveTo.apply(ctx,curve.slice(2))}}},Base.each(Curve.evaluateMethods,function(name){this[name+"At"]=function(offset,weighted){var param=this.getParameterAt(offset);return Curve[name](this.curves[param.index],param.value,weighted)}},{})),PathFitter=Base.extend({initialize:function(path,error){for(var points=this.points=[],segments=path._segments,prev,i=0,l=segments.length;i<l;i++){var point=segments[i].point.clone();prev&&prev.equals(point)||(points.push(point),prev=point)}path._closed&&(this.closed=!0,points.unshift(points[points.length-1]),points.push(points[1])),this.error=error},fit:function(){var points=this.points,length=points.length,segments=this.segments=length>0?[new Segment(points[0])]:[];return length>1&&this.fitCubic(0,length-1,points[1].subtract(points[0]).normalize(),points[length-2].subtract(points[length-1]).normalize()),this.closed&&(segments.shift(),segments.pop()),segments},fitCubic:function(first,last,tan1,tan2){if(last-first!=1){for(var uPrime=this.chordLengthParameterize(first,last),maxError=Math.max(this.error,this.error*this.error),split,parametersInOrder=!0,i=0;i<=4;i++){var curve=this.generateBezier(first,last,uPrime,tan1,tan2),max=this.findMaxError(first,last,curve,uPrime);if(max.error<this.error&&parametersInOrder)return void this.addCurve(curve);if(split=max.index,max.error>=maxError)break;parametersInOrder=this.reparameterize(first,last,uPrime,curve),maxError=max.error}var V1=this.points[split-1].subtract(this.points[split]),V2=this.points[split].subtract(this.points[split+1]),tanCenter=V1.add(V2).divide(2).normalize();this.fitCubic(first,split,tan1,tanCenter),this.fitCubic(split,last,tanCenter.negate(),tan2)}else{var pt1=this.points[first],pt2=this.points[last],dist=pt1.getDistance(pt2)/3;this.addCurve([pt1,pt1.add(tan1.normalize(dist)),pt2.add(tan2.normalize(dist)),pt2])}},addCurve:function(curve){var prev;this.segments[this.segments.length-1].setHandleOut(curve[1].subtract(curve[0])),this.segments.push(new Segment(curve[3],curve[2].subtract(curve[3])))},generateBezier:function(first,last,uPrime,tan1,tan2){for(var epsilon=1e-12,pt1=this.points[first],pt2=this.points[last],C=[[0,0],[0,0]],X=[0,0],i=0,l=last-first+1;i<l;i++){var u=uPrime[i],t=1-u,b=3*u*t,b0=t*t*t,b1=b*t,b2=b*u,b3=u*u*u,a1=tan1.normalize(b1),a2=tan2.normalize(b2),tmp=this.points[first+i].subtract(pt1.multiply(b0+b1)).subtract(pt2.multiply(b2+b3));C[0][0]+=a1.dot(a1),C[0][1]+=a1.dot(a2),C[1][0]=C[0][1],C[1][1]+=a2.dot(a2),X[0]+=a1.dot(tmp),X[1]+=a2.dot(tmp)}var detC0C1=C[0][0]*C[1][1]-C[1][0]*C[0][1],alpha1,alpha2;if(Math.abs(detC0C1)>1e-12){var detC0X=C[0][0]*X[1]-C[1][0]*X[0],detXC1;alpha1=(X[0]*C[1][1]-X[1]*C[0][1])/detC0C1,alpha2=detC0X/detC0C1}else{var c0=C[0][0]+C[0][1],c1=C[1][0]+C[1][1];alpha1=alpha2=Math.abs(c0)>1e-12?X[0]/c0:Math.abs(c1)>1e-12?X[1]/c1:0}var segLength=pt2.getDistance(pt1),eps=1e-12*segLength,handle1,handle2;if(alpha1<eps||alpha2<eps)alpha1=alpha2=segLength/3;else{var line=pt2.subtract(pt1);handle1=tan1.normalize(alpha1),handle2=tan2.normalize(alpha2),handle1.dot(line)-handle2.dot(line)>segLength*segLength&&(alpha1=alpha2=segLength/3,handle1=handle2=null)}return[pt1,pt1.add(handle1||tan1.normalize(alpha1)),pt2.add(handle2||tan2.normalize(alpha2)),pt2]},reparameterize:function(first,last,u,curve){for(var i=first;i<=last;i++)u[i-first]=this.findRoot(curve,this.points[i],u[i-first]);for(var i=1,l=u.length;i<l;i++)if(u[i]<=u[i-1])return!1;return!0},findRoot:function(curve,point,u){for(var curve1=[],curve2=[],i=0;i<=2;i++)curve1[i]=curve[i+1].subtract(curve[i]).multiply(3);for(var i=0;i<=1;i++)curve2[i]=curve1[i+1].subtract(curve1[i]).multiply(2);var pt=this.evaluate(3,curve,u),pt1=this.evaluate(2,curve1,u),pt2=this.evaluate(1,curve2,u),diff=pt.subtract(point),df=pt1.dot(pt1)+diff.dot(pt2);return Math.abs(df)<1e-6?u:u-diff.dot(pt1)/df},evaluate:function(degree,curve,t){for(var tmp=curve.slice(),i=1;i<=degree;i++)for(var j=0;j<=degree-i;j++)tmp[j]=tmp[j].multiply(1-t).add(tmp[j+1].multiply(t));return tmp[0]},chordLengthParameterize:function(first,last){for(var u=[0],i=first+1;i<=last;i++)u[i-first]=u[i-first-1]+this.points[i].getDistance(this.points[i-1]);for(var i=1,m=last-first;i<=m;i++)u[i]/=u[m];return u},findMaxError:function(first,last,curve,u){for(var index=Math.floor((last-first+1)/2),maxDist=0,i=first+1;i<last;i++){var P,v=this.evaluate(3,curve,u[i-first]).subtract(this.points[i]),dist=v.x*v.x+v.y*v.y;dist>=maxDist&&(maxDist=dist,index=i)}return{error:maxDist,index:index}}}),TextItem=Item.extend({_class:"TextItem",_boundsSelected:!0,_applyMatrix:!1,_canApplyMatrix:!1,_serializeFields:{content:null},_boundsGetter:"getBounds",initialize:function TextItem(arg){this._content="",this._lines=[];var hasProps=arg&&Base.isPlainObject(arg)&&arg.x===undefined&&arg.y===undefined;this._initialize(hasProps&&arg,!hasProps&&Point.read(arguments))},_equals:function(item){return this._content===item._content},_clone:function _clone(copy,insert,includeMatrix){return copy.setContent(this._content),_clone.base.call(this,copy,insert,includeMatrix)},getContent:function(){return this._content},setContent:function(content){this._content=""+content,this._lines=this._content.split(/\r\n|\n|\r/gm),this._changed(265)},isEmpty:function(){return!this._content},getCharacterStyle:"#getStyle",setCharacterStyle:"#setStyle",getParagraphStyle:"#getStyle",setParagraphStyle:"#setStyle"}),PointText=TextItem.extend({_class:"PointText",initialize:function PointText(){TextItem.apply(this,arguments)},clone:function(insert){return this._clone(new PointText(Item.NO_INSERT),insert)},getPoint:function(){var point=this._matrix.getTranslation();return new LinkedPoint(point.x,point.y,this,"setPoint")},setPoint:function(){var point=Point.read(arguments);this.translate(point.subtract(this._matrix.getTranslation()))},_draw:function(ctx){if(this._content){this._setStyles(ctx);var style=this._style,lines=this._lines,leading=style.getLeading(),shadowColor=ctx.shadowColor;ctx.font=style.getFontStyle(),ctx.textAlign=style.getJustification();for(var i=0,l=lines.length;i<l;i++){ctx.shadowColor=shadowColor;var line=lines[i];style.hasFill()&&(ctx.fillText(line,0,0),ctx.shadowColor="rgba(0,0,0,0)"),style.hasStroke()&&ctx.strokeText(line,0,0),ctx.translate(0,leading)}}},_getBounds:function(getter,matrix){var style=this._style,lines=this._lines,numLines=lines.length,justification=style.getJustification(),leading=style.getLeading(),width=this.getView().getTextWidth(style.getFontStyle(),lines),x=0;"left"!==justification&&(x-=width/("center"===justification?2:1));var bounds=new Rectangle(x,numLines?-.75*leading:0,width,numLines*leading);return matrix?matrix._transformBounds(bounds,bounds):bounds}}),Color=Base.extend(new function(){var types={gray:["gray"],rgb:["red","green","blue"],hsb:["hue","saturation","brightness"],hsl:["hue","saturation","lightness"],gradient:["gradient","origin","destination","highlight"]},componentParsers={},colorCache={},colorCtx;function fromCSS(string){var match=string.match(/^#(\w{1,2})(\w{1,2})(\w{1,2})$/),components;if(match){components=[0,0,0];for(var i=0;i<3;i++){var value=match[i+1];components[i]=parseInt(1==value.length?value+value:value,16)/255}}else if(match=string.match(/^rgba?\((.*)\)$/))for(var i=0,l=(components=match[1].split(",")).length;i<l;i++){var value=+components[i];components[i]=i<3?value/255:value}else{var cached=colorCache[string];if(!cached){colorCtx||((colorCtx=CanvasProvider.getContext(1,1)).globalCompositeOperation="copy"),colorCtx.fillStyle="rgba(0,0,0,0)",colorCtx.fillStyle=string,colorCtx.fillRect(0,0,1,1);var data=colorCtx.getImageData(0,0,1,1).data;cached=colorCache[string]=[data[0]/255,data[1]/255,data[2]/255]}components=cached.slice()}return components}var hsbIndices=[[0,3,1],[2,0,1],[1,0,3],[1,2,0],[3,1,0],[0,1,2]],converters={"rgb-hsb":function(r,g,b){var max=Math.max(r,g,b),min,delta=max-Math.min(r,g,b),h;return[0===delta?0:60*(max==r?(g-b)/delta+(g<b?6:0):max==g?(b-r)/delta+2:(r-g)/delta+4),0===max?0:delta/max,max]},"hsb-rgb":function(h,s,b){var i,f=(h=(h/60%6+6)%6)-(i=Math.floor(h)),i,v=[b,b*(1-s),b*(1-s*f),b*(1-s*(1-f))];return[v[(i=hsbIndices[i])[0]],v[i[1]],v[i[2]]]},"rgb-hsl":function(r,g,b){var max=Math.max(r,g,b),min=Math.min(r,g,b),delta=max-min,achromatic=0===delta,h,l=(max+min)/2,s;return[achromatic?0:60*(max==r?(g-b)/delta+(g<b?6:0):max==g?(b-r)/delta+2:(r-g)/delta+4),achromatic?0:l<.5?delta/(max+min):delta/(2-max-min),l]},"hsl-rgb":function(h,s,l){if(0===s)return[l,l,l];for(var t3s=[(h=(h/360%1+1)%1)+1/3,h,h-1/3],t2=l<.5?l*(1+s):l+s-l*s,t1=2*l-t2,c=[],i=0;i<3;i++){var t3=t3s[i];t3<0&&(t3+=1),t3>1&&(t3-=1),c[i]=6*t3<1?t1+6*(t2-t1)*t3:2*t3<1?t2:3*t3<2?t1+(t2-t1)*(2/3-t3)*6:t1}return c},"rgb-gray":function(r,g,b){return[.2989*r+.587*g+.114*b]},"gray-rgb":function(g){return[g,g,g]},"gray-hsb":function(g){return[0,0,g]},"gray-hsl":function(g){return[0,0,g]},"gradient-rgb":function(){return[]},"rgb-gradient":function(){return[]}};return Base.each(types,function(properties,type){componentParsers[type]=[],Base.each(properties,function(name,index){var part=Base.capitalize(name),hasOverlap=/^(hue|saturation)$/.test(name),parser=componentParsers[type][index]="gradient"===name?function(value){var current=this._components[0];return current!==(value=Gradient.read(Array.isArray(value)?value:arguments,0,{readNull:!0}))&&(current&&current._removeOwner(this),value&&value._addOwner(this)),value}:"gradient"===type?function(){return Point.read(arguments,0,{readNull:"highlight"===name,clone:!0})}:function(value){return null==value||isNaN(value)?0:value};this["get"+part]=function(){return this._type===type||hasOverlap&&/^hs[bl]$/.test(this._type)?this._components[index]:this._convert(type)[index]},this["set"+part]=function(value){this._type===type||hasOverlap&&/^hs[bl]$/.test(this._type)||(this._components=this._convert(type),this._properties=types[type],this._type=type),this._components[index]=parser.call(this,value),this._changed()}},this)},{_class:"Color",_readIndex:!0,initialize:function Color(arg){var slice=Array.prototype.slice,args=arguments,read=0,type,components,alpha,values;Array.isArray(arg)&&(arg=(args=arg)[0]);var argType=null!=arg&&typeof arg;if("string"===argType&&arg in types&&(type=arg,arg=args[1],Array.isArray(arg)?(components=arg,alpha=args[2]):(this.__read&&(read=1),args=slice.call(args,1),argType=typeof arg)),!components){if(values="number"===argType?args:"object"===argType&&null!=arg.length?arg:null){type||(type=values.length>=3?"rgb":"gray");var length=types[type].length;alpha=values[length],this.__read&&(read+=values===arguments?length+(null!=alpha?1:0):1),values.length>length&&(values=slice.call(values,0,length))}else if("string"===argType)type="rgb",4===(components=fromCSS(arg)).length&&(alpha=components[3],components.length--);else if("object"===argType)if(arg.constructor===Color){if(type=arg._type,components=arg._components.slice(),alpha=arg._alpha,"gradient"===type)for(var i=1,l=components.length;i<l;i++){var point=components[i];point&&(components[i]=point.clone())}}else if(arg.constructor===Gradient)type="gradient",values=args;else{var properties=types[type="hue"in arg?"lightness"in arg?"hsl":"hsb":"gradient"in arg||"stops"in arg||"radial"in arg?"gradient":"gray"in arg?"gray":"rgb"],parsers=componentParsers[type];this._components=components=[];for(var i=0,l=properties.length;i<l;i++){var value;null==(value=arg[properties[i]])&&0===i&&"gradient"===type&&"stops"in arg&&(value={stops:arg.stops,radial:arg.radial}),null!=(value=parsers[i].call(this,value))&&(components[i]=value)}alpha=arg.alpha}this.__read&&type&&(read=1)}if(this._type=type||"rgb",this._id=UID.get(Color),!components){this._components=components=[];for(var parsers,i=0,l=(parsers=componentParsers[this._type]).length;i<l;i++){var value;null!=(value=parsers[i].call(this,values&&values[i]))&&(components[i]=value)}}this._components=components,this._properties=types[this._type],this._alpha=alpha,this.__read&&(this.__read=read)},_serialize:function(options,dictionary){var components=this.getComponents();return Base.serialize(/^(gray|rgb)$/.test(this._type)?components:[this._type].concat(components),options,!0,dictionary)},_changed:function(){this._canvasStyle=null,this._owner&&this._owner._changed(65)},_convert:function(type){var converter;return this._type===type?this._components.slice():(converter=converters[this._type+"-"+type])?converter.apply(this,this._components):converters["rgb-"+type].apply(this,converters[this._type+"-rgb"].apply(this,this._components))},convert:function(type){return new Color(type,this._convert(type),this._alpha)},getType:function(){return this._type},setType:function(type){this._components=this._convert(type),this._properties=types[type],this._type=type},getComponents:function(){var components=this._components.slice();return null!=this._alpha&&components.push(this._alpha),components},getAlpha:function(){return null!=this._alpha?this._alpha:1},setAlpha:function(alpha){this._alpha=null==alpha?null:Math.min(Math.max(alpha,0),1),this._changed()},hasAlpha:function(){return null!=this._alpha},equals:function(color){var col=Base.isPlainValue(color,!0)?Color.read(arguments):color;return col===this||col&&this._class===col._class&&this._type===col._type&&this._alpha===col._alpha&&Base.equals(this._components,col._components)||!1},toString:function(){for(var properties=this._properties,parts=[],isGradient="gradient"===this._type,f=Formatter.instance,i=0,l=properties.length;i<l;i++){var value=this._components[i];null!=value&&parts.push(properties[i]+": "+(isGradient?value:f.number(value)))}return null!=this._alpha&&parts.push("alpha: "+f.number(this._alpha)),"{ "+parts.join(", ")+" }"},toCSS:function(hex){var components=this._convert("rgb"),alpha=hex||null==this._alpha?1:this._alpha;function convert(val){return Math.round(255*(val<0?0:val>1?1:val))}return components=[convert(components[0]),convert(components[1]),convert(components[2])],alpha<1&&components.push(alpha<0?0:alpha),hex?"#"+((1<<24)+(components[0]<<16)+(components[1]<<8)+components[2]).toString(16).slice(1):(4==components.length?"rgba(":"rgb(")+components.join(",")+")"},toCanvasStyle:function(ctx){if(this._canvasStyle)return this._canvasStyle;if("gradient"!==this._type)return this._canvasStyle=this.toCSS();var components=this._components,gradient=components[0],stops=gradient._stops,origin=components[1],destination=components[2],canvasGradient;if(gradient._radial){var radius=destination.getDistance(origin),highlight=components[3];if(highlight){var vector=highlight.subtract(origin);vector.getLength()>radius&&(highlight=origin.add(vector.normalize(radius-.1)))}var start=highlight||origin;canvasGradient=ctx.createRadialGradient(start.x,start.y,0,origin.x,origin.y,radius)}else canvasGradient=ctx.createLinearGradient(origin.x,origin.y,destination.x,destination.y);for(var i=0,l=stops.length;i<l;i++){var stop=stops[i];canvasGradient.addColorStop(stop._rampPoint,stop._color.toCanvasStyle())}return this._canvasStyle=canvasGradient},transform:function(matrix){if("gradient"===this._type){for(var components=this._components,i=1,l=components.length;i<l;i++){var point=components[i];matrix._transformPoint(point,point,!0)}this._changed()}},statics:{_types:types,random:function(){var random=Math.random;return new Color(random(),random(),random())}}})},new function(){var operators={add:function(a,b){return a+b},subtract:function(a,b){return a-b},multiply:function(a,b){return a*b},divide:function(a,b){return a/b}};return Base.each(operators,function(operator,name){this[name]=function(color){color=Color.read(arguments);for(var type=this._type,components1=this._components,components2=color._convert(type),i=0,l=components1.length;i<l;i++)components2[i]=operator(components1[i],components2[i]);return new Color(type,components2,null!=this._alpha?operator(this._alpha,color.getAlpha()):null)}},{})}),Gradient=Base.extend({_class:"Gradient",initialize:function Gradient(stops,radial){this._id=UID.get(),stops&&this._set(stops)&&(stops=radial=null),this._stops||this.setStops(stops||["white","black"]),null==this._radial&&this.setRadial("string"==typeof radial&&"radial"===radial||radial||!1)},_serialize:function(options,dictionary){return dictionary.add(this,function(){return Base.serialize([this._stops,this._radial],options,!0,dictionary)})},_changed:function(){for(var i=0,l=this._owners&&this._owners.length;i<l;i++)this._owners[i]._changed()},_addOwner:function(color){this._owners||(this._owners=[]),this._owners.push(color)},_removeOwner:function(color){var index=this._owners?this._owners.indexOf(color):-1;-1!=index&&(this._owners.splice(index,1),0===this._owners.length&&(this._owners=undefined))},clone:function(){for(var stops=[],i=0,l=this._stops.length;i<l;i++)stops[i]=this._stops[i].clone();return new Gradient(stops,this._radial)},getStops:function(){return this._stops},setStops:function(stops){if(this.stops)for(var i=0,l=this._stops.length;i<l;i++)this._stops[i]._owner=undefined;if(stops.length<2)throw new Error("Gradient stop list needs to contain at least two stops.");this._stops=GradientStop.readAll(stops,0,{clone:!0});for(var i=0,l=this._stops.length;i<l;i++){var stop=this._stops[i];stop._owner=this,stop._defaultRamp&&stop.setRampPoint(i/(l-1))}this._changed()},getRadial:function(){return this._radial},setRadial:function(radial){this._radial=radial,this._changed()},equals:function(gradient){if(gradient===this)return!0;if(gradient&&this._class===gradient._class&&this._stops.length===gradient._stops.length){for(var i=0,l=this._stops.length;i<l;i++)if(!this._stops[i].equals(gradient._stops[i]))return!1;return!0}return!1}}),GradientStop=Base.extend({_class:"GradientStop",initialize:function GradientStop(arg0,arg1){var color,rampPoint;arg0&&(arg1===undefined&&Array.isArray(arg0)?(color=arg0[0],rampPoint=arg0[1]):arg0.color?(color=arg0.color,rampPoint=arg0.rampPoint):(color=arg0,rampPoint=arg1),this.setColor(color),this.setRampPoint(rampPoint))},clone:function(){return new GradientStop(this._color.clone(),this._rampPoint)},_serialize:function(options,dictionary){return Base.serialize([this._color,this._rampPoint],options,!0,dictionary)},_changed:function(){this._owner&&this._owner._changed(65)},getRampPoint:function(){return this._rampPoint},setRampPoint:function(rampPoint){this._defaultRamp=null==rampPoint,this._rampPoint=rampPoint||0,this._changed()},getColor:function(){return this._color},setColor:function(color){this._color=Color.read(arguments),this._color===color&&(this._color=color.clone()),this._color._owner=this,this._changed()},equals:function(stop){return stop===this||stop&&this._class===stop._class&&this._color.equals(stop._color)&&this._rampPoint==stop._rampPoint||!1}}),Style=Base.extend(new function(){var defaults={fillColor:undefined,strokeColor:undefined,strokeWidth:1,strokeCap:"butt",strokeJoin:"miter",strokeScaling:!0,miterLimit:10,dashOffset:0,dashArray:[],windingRule:"nonzero",shadowColor:undefined,shadowBlur:0,shadowOffset:new Point,selectedColor:undefined,fontFamily:"sans-serif",fontWeight:"normal",fontSize:12,font:"sans-serif",leading:null,justification:"left"},flags={strokeWidth:97,strokeCap:97,strokeJoin:97,strokeScaling:105,miterLimit:97,fontFamily:9,fontWeight:9,fontSize:9,font:9,leading:9,justification:9},item={beans:!0},fields={_defaults:defaults,_textDefaults:new Base(defaults,{fillColor:new Color}),beans:!0};return Base.each(defaults,function(value,key){var isColor=/Color$/.test(key),isPoint="shadowOffset"===key,part=Base.capitalize(key),flag=flags[key],set="set"+part,get="get"+part;fields[set]=function(value){var owner=this._owner,children=owner&&owner._children;if(children&&children.length>0&&!(owner instanceof CompoundPath))for(var i=0,l=children.length;i<l;i++)children[i]._style[set](value);else{var old=this._values[key];old!==value&&(isColor&&(old&&(old._owner=undefined),value&&value.constructor===Color&&(value._owner&&(value=value.clone()),value._owner=owner)),this._values[key]=value,owner&&owner._changed(flag||65))}},fields[get]=function(_dontMerge){var owner=this._owner,children=owner&&owner._children,value;if(!children||0===children.length||_dontMerge||owner instanceof CompoundPath){var value;if((value=this._values[key])===undefined)(value=this._defaults[key])&&value.clone&&(value=value.clone());else{var ctor=isColor?Color:isPoint?Point:null;!ctor||value&&value.constructor===ctor||(this._values[key]=value=ctor.read([value],0,{readNull:!0,clone:!0}),value&&isColor&&(value._owner=owner))}return value}for(var i=0,l=children.length;i<l;i++){var childValue=children[i]._style[get]();if(0===i)value=childValue;else if(!Base.equals(value,childValue))return undefined}return value},item[get]=function(_dontMerge){return this._style[get](_dontMerge)},item[set]=function(value){this._style[set](value)}}),Item.inject(item),fields},{_class:"Style",initialize:function Style(style,_owner,_project){this._values={},this._owner=_owner,this._project=_owner&&_owner._project||_project||paper.project,_owner instanceof TextItem&&(this._defaults=this._textDefaults),style&&this.set(style)},set:function(style){var isStyle=style instanceof Style,values=isStyle?style._values:style;if(values)for(var key in values)if(key in this._defaults){var value=values[key];this[key]=value&&isStyle&&value.clone?value.clone():value}},equals:function(style){return style===this||style&&this._class===style._class&&Base.equals(this._values,style._values)||!1},hasFill:function(){return!!this.getFillColor()},hasStroke:function(){return!!this.getStrokeColor()&&this.getStrokeWidth()>0},hasShadow:function(){return!!this.getShadowColor()&&this.getShadowBlur()>0},getView:function(){return this._project.getView()},getFontStyle:function(){var fontSize=this.getFontSize();return this.getFontWeight()+" "+fontSize+(/[a-z]/i.test(fontSize+"")?" ":"px ")+this.getFontFamily()},getFont:"#getFontFamily",setFont:"#setFontFamily",getLeading:function getLeading(){var leading=getLeading.base.call(this),fontSize=this.getFontSize();return/pt|em|%|px/.test(fontSize)&&(fontSize=this.getView().getPixelSize(fontSize)),null!=leading?leading:1.2*fontSize}}),DomElement=new function(){function handlePrefix(el,name,set,value){for(var prefixes=["","webkit","moz","Moz","ms","o"],suffix=name[0].toUpperCase()+name.substring(1),i=0;i<6;i++){var prefix=prefixes[i],key=prefix?prefix+suffix:name;if(key in el){if(!set)return el[key];el[key]=value;break}}}return{getStyles:function(el){var doc=el&&9!==el.nodeType?el.ownerDocument:el,view=doc&&doc.defaultView;return view&&view.getComputedStyle(el,"")},getBounds:function(el,viewport){var doc=el.ownerDocument,body=doc.body,html=doc.documentElement,rect;try{rect=el.getBoundingClientRect()}catch(e){rect={left:0,top:0,width:0,height:0}}var x=rect.left-(html.clientLeft||body.clientLeft||0),y=rect.top-(html.clientTop||body.clientTop||0);if(!viewport){var view=doc.defaultView;x+=view.pageXOffset||html.scrollLeft||body.scrollLeft,y+=view.pageYOffset||html.scrollTop||body.scrollTop}return new Rectangle(x,y,rect.width,rect.height)},getViewportBounds:function(el){var doc=el.ownerDocument,view=doc.defaultView,html=doc.documentElement;return new Rectangle(0,0,view.innerWidth||html.clientWidth,view.innerHeight||html.clientHeight)},getOffset:function(el,viewport){return DomElement.getBounds(el,viewport).getPoint()},getSize:function(el){return DomElement.getBounds(el,!0).getSize()},isInvisible:function(el){return DomElement.getSize(el).equals(new Size(0,0))},isInView:function(el){return!DomElement.isInvisible(el)&&DomElement.getViewportBounds(el).intersects(DomElement.getBounds(el,!0))},getPrefixed:function(el,name){return handlePrefix(el,name)},setPrefixed:function(el,name,value){if("object"==typeof name)for(var key in name)handlePrefix(el,key,!0,name[key]);else handlePrefix(el,name,!0,value)}}},DomEvent={add:function(el,events){for(var type in events)for(var func=events[type],parts=type.split(/[\s,]+/g),i=0,l=parts.length;i<l;i++)el.addEventListener(parts[i],func,!1)},remove:function(el,events){for(var type in events)for(var func=events[type],parts=type.split(/[\s,]+/g),i=0,l=parts.length;i<l;i++)el.removeEventListener(parts[i],func,!1)},getPoint:function(event){var pos=event.targetTouches?event.targetTouches.length?event.targetTouches[0]:event.changedTouches[0]:event;return new Point(pos.pageX||pos.clientX+document.documentElement.scrollLeft,pos.pageY||pos.clientY+document.documentElement.scrollTop)},getTarget:function(event){return event.target||event.srcElement},getRelatedTarget:function(event){return event.relatedTarget||event.toElement},getOffset:function(event,target){return DomEvent.getPoint(event).subtract(DomElement.getOffset(target||DomEvent.getTarget(event)))},stop:function(event){event.stopPropagation(),event.preventDefault()}};DomEvent.requestAnimationFrame=new function(){var nativeRequest=DomElement.getPrefixed(window,"requestAnimationFrame"),requested=!1,callbacks=[],focused=!0,timer;function handleCallbacks(){for(var i=callbacks.length-1;i>=0;i--){var entry=callbacks[i],func=entry[0],el=entry[1];(!el||("true"==PaperScope.getAttribute(el,"keepalive")||focused)&&DomElement.isInView(el))&&(callbacks.splice(i,1),func())}nativeRequest&&(callbacks.length?nativeRequest(handleCallbacks):requested=!1)}return DomEvent.add(window,{focus:function(){focused=!0},blur:function(){focused=!1}}),function(callback,element){callbacks.push([callback,element]),nativeRequest?requested||(nativeRequest(handleCallbacks),requested=!0):timer||(timer=setInterval(handleCallbacks,1e3/60))}};var View=Base.extend(Emitter,{_class:"View",initialize:function View(project,element){var size;this._project=project,this._scope=project._scope,this._element=element,this._pixelRatio||(this._pixelRatio=window.devicePixelRatio||1),this._id=element.getAttribute("id"),null==this._id&&element.setAttribute("id",this._id="view-"+View._id++),DomEvent.add(element,this._viewEvents);var none="none";function getSize(name){return element[name]||parseInt(element.getAttribute(name),10)}function getCanvasSize(){var size=DomElement.getSize(element);return size.isNaN()||size.isZero()?new Size(getSize("width"),getSize("height")):size}if(DomElement.setPrefixed(element.style,{userSelect:none,touchAction:none,touchCallout:none,contentZooming:none,userDrag:none,tapHighlightColor:"rgba(0,0,0,0)"}),PaperScope.hasAttribute(element,"resize")){var that=this;DomEvent.add(window,this._windowEvents={resize:function(){that.setViewSize(getCanvasSize())}})}if(this._setViewSize(size=getCanvasSize()),PaperScope.hasAttribute(element,"stats")&&"undefined"!=typeof Stats){this._stats=new Stats;var stats=this._stats.domElement,style=stats.style,offset=DomElement.getOffset(element);style.position="absolute",style.left=offset.x+"px",style.top=offset.y+"px",document.body.appendChild(stats)}View._views.push(this),View._viewsById[this._id]=this,this._viewSize=size,(this._matrix=new Matrix)._owner=this,this._zoom=1,View._focused||(View._focused=this),this._frameItems={},this._frameItemCount=0},remove:function(){return!!this._project&&(View._focused===this&&(View._focused=null),View._views.splice(View._views.indexOf(this),1),delete View._viewsById[this._id],this._project._view===this&&(this._project._view=null),DomEvent.remove(this._element,this._viewEvents),DomEvent.remove(window,this._windowEvents),this._element=this._project=null,this.off("frame"),this._animate=!1,this._frameItems={},!0)},_events:Base.each(["onResize","onMouseDown","onMouseUp","onMouseMove"],function(name){this[name]={install:function(type){this._installEvent(type)},uninstall:function(type){this._uninstallEvent(type)}}},{onFrame:{install:function(){this.play()},uninstall:function(){this.pause()}}}),_animate:!1,_time:0,_count:0,_requestFrame:function(){var that=this;DomEvent.requestAnimationFrame(function(){that._requested=!1,that._animate&&(that._requestFrame(),that._handleFrame())},this._element),this._requested=!0},_handleFrame:function(){paper=this._scope;var now=Date.now()/1e3,delta=this._before?now-this._before:0;this._before=now,this._handlingFrame=!0,this.emit("frame",new Base({delta:delta,time:this._time+=delta,count:this._count++})),this._stats&&this._stats.update(),this._handlingFrame=!1,this.update()},_animateItem:function(item,animate){var items=this._frameItems;animate?(items[item._id]={item:item,time:0,count:0},1==++this._frameItemCount&&this.on("frame",this._handleFrameItems)):(delete items[item._id],0==--this._frameItemCount&&this.off("frame",this._handleFrameItems))},_handleFrameItems:function(event){for(var i in this._frameItems){var entry=this._frameItems[i];entry.item.emit("frame",new Base(event,{time:entry.time+=event.delta,count:entry.count++}))}},_update:function(){this._project._needsUpdate=!0,this._handlingFrame||(this._animate?this._handleFrame():this.update())},_changed:function(flags){1&flags&&(this._project._needsUpdate=!0)},_transform:function(matrix){this._matrix.concatenate(matrix),this._bounds=null,this._update()},getElement:function(){return this._element},getPixelRatio:function(){return this._pixelRatio},getResolution:function(){return 72*this._pixelRatio},getViewSize:function(){var size=this._viewSize;return new LinkedSize(size.width,size.height,this,"setViewSize")},setViewSize:function(){var size=Size.read(arguments),delta=size.subtract(this._viewSize);delta.isZero()||(this._viewSize.set(size.width,size.height),this._setViewSize(size),this._bounds=null,this.emit("resize",{size:size,delta:delta}),this._update())},_setViewSize:function(size){var element=this._element;element.width=size.width,element.height=size.height},getBounds:function(){return this._bounds||(this._bounds=this._matrix.inverted()._transformBounds(new Rectangle(new Point,this._viewSize))),this._bounds},getSize:function(){return this.getBounds().getSize()},getCenter:function(){return this.getBounds().getCenter()},setCenter:function(){var center=Point.read(arguments);this.scrollBy(center.subtract(this.getCenter()))},getZoom:function(){return this._zoom},setZoom:function(zoom){this._transform((new Matrix).scale(zoom/this._zoom,this.getCenter())),this._zoom=zoom},isVisible:function(){return DomElement.isInView(this._element)},scrollBy:function(){this._transform((new Matrix).translate(Point.read(arguments).negate()))},play:function(){this._animate=!0,this._requested||this._requestFrame()},pause:function(){this._animate=!1},draw:function(){this.update()},projectToView:function(){return this._matrix._transformPoint(Point.read(arguments))},viewToProject:function(){return this._matrix._inverseTransform(Point.read(arguments))}},{statics:{_views:[],_viewsById:{},_id:0,create:function(project,element){return"string"==typeof element&&(element=document.getElementById(element)),new CanvasView(project,element)}}},new function(){var tool,prevFocus,tempFocus,dragging=!1;function getView(event){var target=DomEvent.getTarget(event);return target.getAttribute&&View._viewsById[target.getAttribute("id")]}function viewToProject(view,event){return view.viewToProject(DomEvent.getOffset(event,view._element))}function updateFocus(){if(!View._focused||!View._focused.isVisible())for(var i=0,l=View._views.length;i<l;i++){var view=View._views[i];if(view&&view.isVisible()){View._focused=tempFocus=view;break}}}function handleMouseMove(view,point,event){view._handleEvent("mousemove",point,event);var tool=view._scope.tool;return tool&&tool._handleEvent(dragging&&tool.responds("mousedrag")?"mousedrag":"mousemove",point,event),view.update(),tool}var navigator=window.navigator,mousedown,mousemove,mouseup;navigator.pointerEnabled||navigator.msPointerEnabled?(mousedown="pointerdown MSPointerDown",mousemove="pointermove MSPointerMove",mouseup="pointerup pointercancel MSPointerUp MSPointerCancel"):(mousedown="touchstart",mousemove="touchmove",mouseup="touchend touchcancel","ontouchstart"in window&&navigator.userAgent.match(/mobile|tablet|ip(ad|hone|od)|android|silk/i)||(mousedown+=" mousedown",mousemove+=" mousemove",mouseup+=" mouseup"));var viewEvents={"selectstart dragstart":function(event){dragging&&event.preventDefault()}},docEvents={mouseout:function(event){var view=View._focused,target=DomEvent.getRelatedTarget(event);!view||target&&"HTML"!==target.nodeName||handleMouseMove(view,viewToProject(view,event),event)},scroll:updateFocus};viewEvents[mousedown]=function(event){var view=View._focused=getView(event),point=viewToProject(view,event);dragging=!0,view._handleEvent("mousedown",point,event),(tool=view._scope.tool)&&tool._handleEvent("mousedown",point,event),view.update()},docEvents[mousemove]=function(event){var view=View._focused;if(!dragging){var target=getView(event);target?(view!==target&&handleMouseMove(view,viewToProject(view,event),event),prevFocus=view,view=View._focused=tempFocus=target):tempFocus&&tempFocus===view&&(view=View._focused=prevFocus,updateFocus())}if(view){var point=viewToProject(view,event);(dragging||view.getBounds().contains(point))&&(tool=handleMouseMove(view,point,event))}},docEvents[mouseup]=function(event){var view=View._focused;if(view&&dragging){var point=viewToProject(view,event);dragging=!1,view._handleEvent("mouseup",point,event),tool&&tool._handleEvent("mouseup",point,event),view.update()}},DomEvent.add(document,docEvents),DomEvent.add(window,{load:updateFocus});var mouseFlags={mousedown:{mousedown:1,mousedrag:1,click:1,doubleclick:1},mouseup:{mouseup:1,mousedrag:1,click:1,doubleclick:1},mousemove:{mousedrag:1,mousemove:1,mouseenter:1,mouseleave:1}};return{_viewEvents:viewEvents,_handleEvent:function(){},_installEvent:function(type){var counters=this._eventCounters;if(counters)for(var key in mouseFlags)counters[key]=(counters[key]||0)+(mouseFlags[key][type]||0)},_uninstallEvent:function(type){var counters=this._eventCounters;if(counters)for(var key in mouseFlags)counters[key]-=mouseFlags[key][type]||0},statics:{updateFocus:updateFocus}}}),CanvasView=View.extend({_class:"CanvasView",initialize:function CanvasView(project,canvas){if(!(canvas instanceof HTMLCanvasElement)){var size=Size.read(arguments,1);if(size.isZero())throw new Error("Cannot create CanvasView with the provided argument: "+[].slice.call(arguments,1));canvas=CanvasProvider.getCanvas(size)}if(this._context=canvas.getContext("2d"),this._eventCounters={},this._pixelRatio=1,!/^off|false$/.test(PaperScope.getAttribute(canvas,"hidpi"))){var deviceRatio=window.devicePixelRatio||1,backingStoreRatio=DomElement.getPrefixed(this._context,"backingStorePixelRatio")||1;this._pixelRatio=deviceRatio/backingStoreRatio}View.call(this,project,canvas)},_setViewSize:function(size){var element=this._element,pixelRatio=this._pixelRatio,width=size.width,height=size.height;if(element.width=width*pixelRatio,element.height=height*pixelRatio,1!==pixelRatio){if(!PaperScope.hasAttribute(element,"resize")){var style=element.style;style.width=width+"px",style.height=height+"px"}this._context.scale(pixelRatio,pixelRatio)}},getPixelSize:function(size){var browser=paper.browser,pixels;if(browser&&browser.firefox){var parent=this._element.parentNode,temp=document.createElement("div");temp.style.fontSize=size,parent.appendChild(temp),pixels=parseFloat(DomElement.getStyles(temp).fontSize),parent.removeChild(temp)}else{var ctx=this._context,prevFont=ctx.font;ctx.font=size+" serif",pixels=parseFloat(ctx.font),ctx.font=prevFont}return pixels},getTextWidth:function(font,lines){var ctx=this._context,prevFont=ctx.font,width=0;ctx.font=font;for(var i=0,l=lines.length;i<l;i++)width=Math.max(width,ctx.measureText(lines[i]).width);return ctx.font=prevFont,width},update:function(force){var project=this._project;if(!project||!force&&!project._needsUpdate)return!1;var ctx=this._context,size=this._viewSize;return ctx.clearRect(0,0,size.width+1,size.height+1),project.draw(ctx,this._matrix,this._pixelRatio),project._needsUpdate=!1,!0}},new function(){var downPoint,lastPoint,overPoint,downItem,lastItem,overItem,dragItem,dblClick,clickTime;function callEvent(view,type,event,point,target,lastPoint){var item=target,mouseEvent;function call(obj){if(obj.responds(type)&&(mouseEvent||(mouseEvent=new MouseEvent(type,event,point,target,lastPoint?point.subtract(lastPoint):null)),obj.emit(type,mouseEvent)&&mouseEvent.isStopped))return event.preventDefault(),!0}for(;item;){if(call(item))return!0;item=item.getParent()}return!!call(view)}return{_handleEvent:function(type,point,event){if(this._eventCounters[type]){var project,hit=this._project.hitTest(point,{tolerance:0,fill:!0,stroke:!0}),item=hit&&hit.item,stopped=!1;switch(type){case"mousedown":for(stopped=callEvent(this,type,event,point,item),dblClick=lastItem==item&&Date.now()-clickTime<300,downItem=lastItem=item,downPoint=lastPoint=overPoint=point,dragItem=!stopped&&item;dragItem&&!dragItem.responds("mousedrag");)dragItem=dragItem._parent;break;case"mouseup":stopped=callEvent(this,type,event,point,item,downPoint),dragItem&&(lastPoint&&!lastPoint.equals(point)&&callEvent(this,"mousedrag",event,point,dragItem,lastPoint),item!==dragItem&&callEvent(this,"mousemove",event,point,item,overPoint=point)),!stopped&&item&&item===downItem&&(clickTime=Date.now(),callEvent(this,dblClick&&downItem.responds("doubleclick")?"doubleclick":"click",event,downPoint,item),dblClick=!1),downItem=dragItem=null;break;case"mousemove":dragItem&&(stopped=callEvent(this,"mousedrag",event,point,dragItem,lastPoint)),stopped||(item!==overItem&&(overPoint=point),stopped=callEvent(this,type,event,point,item,overPoint)),lastPoint=overPoint=point,item!==overItem&&(callEvent(this,"mouseleave",event,point,overItem),overItem=item,callEvent(this,"mouseenter",event,point,item))}return stopped}}}}),Event=Base.extend({_class:"Event",initialize:function Event(event){this.event=event},isPrevented:!1,isStopped:!1,preventDefault:function(){this.isPrevented=!0,this.event.preventDefault()},stopPropagation:function(){this.isStopped=!0,this.event.stopPropagation()},stop:function(){this.stopPropagation(),this.preventDefault()},getModifiers:function(){return Key.modifiers}}),KeyEvent=Event.extend({_class:"KeyEvent",initialize:function KeyEvent(down,key,character,event){Event.call(this,event),this.type=down?"keydown":"keyup",this.key=key,this.character=character},toString:function(){return"{ type: '"+this.type+"', key: '"+this.key+"', character: '"+this.character+"', modifiers: "+this.getModifiers()+" }"}}),Key=new function(){var specialKeys={8:"backspace",9:"tab",13:"enter",16:"shift",17:"control",18:"option",19:"pause",20:"caps-lock",27:"escape",32:"space",35:"end",36:"home",37:"left",38:"up",39:"right",40:"down",46:"delete",91:"command",93:"command",224:"command"},specialChars={9:!0,13:!0,32:!0},modifiers=new Base({shift:!1,control:!1,option:!1,command:!1,capsLock:!1,space:!1}),charCodeMap={},keyMap={},commandFixMap,downCode;function handleKey(down,keyCode,charCode,event){var character=charCode?String.fromCharCode(charCode):"",specialKey=specialKeys[keyCode],key=specialKey||character.toLowerCase(),type=down?"keydown":"keyup",view=View._focused,scope=view&&view.isVisible()&&view._scope,tool=scope&&scope.tool,name;if(keyMap[key]=down,down?charCodeMap[keyCode]=charCode:delete charCodeMap[keyCode],specialKey&&(name=Base.camelize(specialKey))in modifiers){modifiers[name]=down;var browser=paper.browser;if("command"===name&&browser&&browser.mac)if(down)commandFixMap={};else{for(var code in commandFixMap)code in charCodeMap&&handleKey(!1,code,commandFixMap[code],event);commandFixMap=null}}else down&&commandFixMap&&(commandFixMap[keyCode]=charCode);tool&&tool.responds(type)&&(paper=scope,tool.emit(type,new KeyEvent(down,key,character,event)),view&&view.update())}return DomEvent.add(document,{keydown:function(event){var code=event.which||event.keyCode;code in specialKeys||modifiers.command?handleKey(!0,code,code in specialChars||modifiers.command?code:0,event):downCode=code},keypress:function(event){null!=downCode&&(handleKey(!0,downCode,event.which||event.keyCode,event),downCode=null)},keyup:function(event){var code=event.which||event.keyCode;code in charCodeMap&&handleKey(!1,code,charCodeMap[code],event)}}),DomEvent.add(window,{blur:function(event){for(var code in charCodeMap)handleKey(!1,code,charCodeMap[code],event)}}),{modifiers:modifiers,isDown:function(key){return!!keyMap[key]}}},MouseEvent=Event.extend({_class:"MouseEvent",initialize:function MouseEvent(type,event,point,target,delta){Event.call(this,event),this.type=type,this.point=point,this.target=target,this.delta=delta},toString:function(){return"{ type: '"+this.type+"', point: "+this.point+", target: "+this.target+(this.delta?", delta: "+this.delta:"")+", modifiers: "+this.getModifiers()+" }"}}),ToolEvent=Event.extend({_class:"ToolEvent",_item:null,initialize:function ToolEvent(tool,type,event){this.tool=tool,this.type=type,this.event=event},_choosePoint:function(point,toolPoint){return point||(toolPoint?toolPoint.clone():null)},getPoint:function(){return this._choosePoint(this._point,this.tool._point)},setPoint:function(point){this._point=point},getLastPoint:function(){return this._choosePoint(this._lastPoint,this.tool._lastPoint)},setLastPoint:function(lastPoint){this._lastPoint=lastPoint},getDownPoint:function(){return this._choosePoint(this._downPoint,this.tool._downPoint)},setDownPoint:function(downPoint){this._downPoint=downPoint},getMiddlePoint:function(){return!this._middlePoint&&this.tool._lastPoint?this.tool._point.add(this.tool._lastPoint).divide(2):this._middlePoint},setMiddlePoint:function(middlePoint){this._middlePoint=middlePoint},getDelta:function(){return!this._delta&&this.tool._lastPoint?this.tool._point.subtract(this.tool._lastPoint):this._delta},setDelta:function(delta){this._delta=delta},getCount:function(){return/^mouse(down|up)$/.test(this.type)?this.tool._downCount:this.tool._count},setCount:function(count){this.tool[/^mouse(down|up)$/.test(this.type)?"downCount":"count"]=count},getItem:function(){if(!this._item){var result=this.tool._scope.project.hitTest(this.getPoint());if(result){for(var item=result.item,parent=item._parent;/^(Group|CompoundPath)$/.test(parent._class);)item=parent,parent=parent._parent;this._item=item}}return this._item},setItem:function(item){this._item=item},toString:function(){return"{ type: "+this.type+", point: "+this.getPoint()+", count: "+this.getCount()+", modifiers: "+this.getModifiers()+" }"}}),Tool=PaperScopeItem.extend({_class:"Tool",_list:"tools",_reference:"tool",_events:["onActivate","onDeactivate","onEditOptions","onMouseDown","onMouseUp","onMouseDrag","onMouseMove","onKeyDown","onKeyUp"],initialize:function Tool(props){PaperScopeItem.call(this),this._firstMove=!0,this._count=0,this._downCount=0,this._set(props)},getMinDistance:function(){return this._minDistance},setMinDistance:function(minDistance){this._minDistance=minDistance,null!=minDistance&&null!=this._maxDistance&&minDistance>this._maxDistance&&(this._maxDistance=minDistance)},getMaxDistance:function(){return this._maxDistance},setMaxDistance:function(maxDistance){this._maxDistance=maxDistance,null!=this._minDistance&&null!=maxDistance&&maxDistance<this._minDistance&&(this._minDistance=maxDistance)},getFixedDistance:function(){return this._minDistance==this._maxDistance?this._minDistance:null},setFixedDistance:function(distance){this._minDistance=this._maxDistance=distance},_updateEvent:function(type,point,minDistance,maxDistance,start,needsChange,matchMaxDistance){if(!start){if(null!=minDistance||null!=maxDistance){var minDist=null!=minDistance?minDistance:0,vector=point.subtract(this._point),distance=vector.getLength();if(distance<minDist)return!1;if(null!=maxDistance&&0!=maxDistance)if(distance>maxDistance)point=this._point.add(vector.normalize(maxDistance));else if(matchMaxDistance)return!1}if(needsChange&&point.equals(this._point))return!1}switch(this._lastPoint=start&&"mousemove"==type?point:this._point,this._point=point,type){case"mousedown":this._lastPoint=this._downPoint,this._downPoint=this._point,this._downCount++;break;case"mouseup":this._lastPoint=this._downPoint}return this._count=start?0:this._count+1,!0},_fireEvent:function(type,event){var sets=paper.project._removeSets;if(sets){"mouseup"===type&&(sets.mousedrag=null);var set=sets[type];if(set){for(var id in set){var item=set[id];for(var key in sets){var other=sets[key];other&&other!=set&&delete other[item._id]}item.remove()}sets[type]=null}}return this.responds(type)&&this.emit(type,new ToolEvent(this,type,event))},_handleEvent:function(type,point,event){paper=this._scope;var called=!1;switch(type){case"mousedown":this._updateEvent(type,point,null,null,!0,!1,!1),called=this._fireEvent(type,event);break;case"mousedrag":for(var needsChange=!1,matchMaxDistance=!1;this._updateEvent(type,point,this.minDistance,this.maxDistance,!1,needsChange,matchMaxDistance);)called=this._fireEvent(type,event)||called,needsChange=!0,matchMaxDistance=!0;break;case"mouseup":!point.equals(this._point)&&this._updateEvent("mousedrag",point,this.minDistance,this.maxDistance,!1,!1,!1)&&(called=this._fireEvent("mousedrag",event)),this._updateEvent(type,point,null,this.maxDistance,!1,!1,!1),called=this._fireEvent(type,event)||called,this._updateEvent(type,point,null,null,!0,!1,!1),this._firstMove=!0;break;case"mousemove":for(;this._updateEvent(type,point,this.minDistance,this.maxDistance,this._firstMove,!0,!1);)called=this._fireEvent(type,event)||called,this._firstMove=!1}return called&&event.preventDefault(),called}}),Http={request:function(method,url,callback,async){async=async===undefined||async;var xhr=new(window.ActiveXObject||XMLHttpRequest)("Microsoft.XMLHTTP");return xhr.open(method.toUpperCase(),url,async),"overrideMimeType"in xhr&&xhr.overrideMimeType("text/plain"),xhr.onreadystatechange=function(){if(4===xhr.readyState){var status=xhr.status;if(0!==status&&200!==status)throw new Error("Could not load "+url+" (Error "+status+")");callback.call(xhr,xhr.responseText)}},xhr.send(null)}},CanvasProvider={canvases:[],getCanvas:function(width,height){var canvas,clear=!0;"object"==typeof width&&(height=width.height,width=width.width);var ctx=(canvas=this.canvases.length?this.canvases.pop():document.createElement("canvas")).getContext("2d");return canvas.width===width&&canvas.height===height?ctx.clearRect(0,0,width+1,height+1):(canvas.width=width,canvas.height=height),ctx.save(),canvas},getContext:function(width,height){return this.getCanvas(width,height).getContext("2d")},release:function(obj){var canvas=obj.canvas?obj.canvas:obj;canvas.getContext("2d").restore(),this.canvases.push(canvas)}},BlendMode=new function(){var min=Math.min,max=Math.max,abs=Math.abs,sr,sg,sb,sa,br,bg,bb,ba,dr,dg,db;function getLum(r,g,b){return.2989*r+.587*g+.114*b}function setLum(r,g,b,l){var d=l-getLum(r,g,b),l=getLum(dr=r+d,dg=g+d,db=b+d),mn=min(dr,dg,db),mx=max(dr,dg,db);if(mn<0){var lmn=l-mn;dr=l+(dr-l)*l/lmn,dg=l+(dg-l)*l/lmn,db=l+(db-l)*l/lmn}if(mx>255){var ln=255-l,mxl=mx-l;dr=l+(dr-l)*ln/mxl,dg=l+(dg-l)*ln/mxl,db=l+(db-l)*ln/mxl}}function getSat(r,g,b){return max(r,g,b)-min(r,g,b)}function setSat(r,g,b,s){var col=[r,g,b],mx=max(r,g,b),mn=min(r,g,b),md;md=0===min(mn=mn===r?0:mn===g?1:2,mx=mx===r?0:mx===g?1:2)?1===max(mn,mx)?2:1:0,col[mx]>col[mn]?(col[md]=(col[md]-col[mn])*s/(col[mx]-col[mn]),col[mx]=s):col[md]=col[mx]=0,col[mn]=0,dr=col[0],dg=col[1],db=col[2]}var modes={multiply:function(){dr=br*sr/255,dg=bg*sg/255,db=bb*sb/255},screen:function(){dr=br+sr-br*sr/255,dg=bg+sg-bg*sg/255,db=bb+sb-bb*sb/255},overlay:function(){dr=br<128?2*br*sr/255:255-2*(255-br)*(255-sr)/255,dg=bg<128?2*bg*sg/255:255-2*(255-bg)*(255-sg)/255,db=bb<128?2*bb*sb/255:255-2*(255-bb)*(255-sb)/255},"soft-light":function(){var t=sr*br/255;dr=t+br*(255-(255-br)*(255-sr)/255-t)/255,dg=(t=sg*bg/255)+bg*(255-(255-bg)*(255-sg)/255-t)/255,db=(t=sb*bb/255)+bb*(255-(255-bb)*(255-sb)/255-t)/255},"hard-light":function(){dr=sr<128?2*sr*br/255:255-2*(255-sr)*(255-br)/255,dg=sg<128?2*sg*bg/255:255-2*(255-sg)*(255-bg)/255,db=sb<128?2*sb*bb/255:255-2*(255-sb)*(255-bb)/255},"color-dodge":function(){dr=0===br?0:255===sr?255:min(255,255*br/(255-sr)),dg=0===bg?0:255===sg?255:min(255,255*bg/(255-sg)),db=0===bb?0:255===sb?255:min(255,255*bb/(255-sb))},"color-burn":function(){dr=255===br?255:0===sr?0:max(0,255-255*(255-br)/sr),dg=255===bg?255:0===sg?0:max(0,255-255*(255-bg)/sg),db=255===bb?255:0===sb?0:max(0,255-255*(255-bb)/sb)},darken:function(){dr=br<sr?br:sr,dg=bg<sg?bg:sg,db=bb<sb?bb:sb},lighten:function(){dr=br>sr?br:sr,dg=bg>sg?bg:sg,db=bb>sb?bb:sb},difference:function(){(dr=br-sr)<0&&(dr=-dr),(dg=bg-sg)<0&&(dg=-dg),(db=bb-sb)<0&&(db=-db)},exclusion:function(){dr=br+sr*(255-br-br)/255,dg=bg+sg*(255-bg-bg)/255,db=bb+sb*(255-bb-bb)/255},hue:function(){setSat(sr,sg,sb,getSat(br,bg,bb)),setLum(dr,dg,db,getLum(br,bg,bb))},saturation:function(){setSat(br,bg,bb,getSat(sr,sg,sb)),setLum(dr,dg,db,getLum(br,bg,bb))},luminosity:function(){setLum(br,bg,bb,getLum(sr,sg,sb))},color:function(){setLum(sr,sg,sb,getLum(br,bg,bb))},add:function(){dr=min(br+sr,255),dg=min(bg+sg,255),db=min(bb+sb,255)},subtract:function(){dr=max(br-sr,0),dg=max(bg-sg,0),db=max(bb-sb,0)},average:function(){dr=(br+sr)/2,dg=(bg+sg)/2,db=(bb+sb)/2},negation:function(){dr=255-abs(255-sr-br),dg=255-abs(255-sg-bg),db=255-abs(255-sb-bb)}},nativeModes=this.nativeModes=Base.each(["source-over","source-in","source-out","source-atop","destination-over","destination-in","destination-out","destination-atop","lighter","darker","copy","xor"],function(mode){this[mode]=!0},{}),ctx=CanvasProvider.getContext(1,1);Base.each(modes,function(func,mode){var darken="darken"===mode,ok=!1;ctx.save();try{ctx.fillStyle=darken?"#300":"#a00",ctx.fillRect(0,0,1,1),ctx.globalCompositeOperation=mode,ctx.globalCompositeOperation===mode&&(ctx.fillStyle=darken?"#a00":"#300",ctx.fillRect(0,0,1,1),ok=ctx.getImageData(0,0,1,1).data[0]!==darken?170:51)}catch(e){}ctx.restore(),nativeModes[mode]=ok}),CanvasProvider.release(ctx),this.process=function(mode,srcContext,dstContext,alpha,offset){var srcCanvas=srcContext.canvas,normal="normal"===mode;if(normal||nativeModes[mode])dstContext.save(),dstContext.setTransform(1,0,0,1,0,0),dstContext.globalAlpha=alpha,normal||(dstContext.globalCompositeOperation=mode),dstContext.drawImage(srcCanvas,offset.x,offset.y),dstContext.restore();else{var process=modes[mode];if(!process)return;for(var dstData=dstContext.getImageData(offset.x,offset.y,srcCanvas.width,srcCanvas.height),dst=dstData.data,src=srcContext.getImageData(0,0,srcCanvas.width,srcCanvas.height).data,i=0,l=dst.length;i<l;i+=4){sr=src[i],br=dst[i],sg=src[i+1],bg=dst[i+1],sb=src[i+2],bb=dst[i+2],sa=src[i+3],ba=dst[i+3],process();var a1=sa*alpha/255,a2=1-a1;dst[i]=a1*dr+a2*br,dst[i+1]=a1*dg+a2*bg,dst[i+2]=a1*db+a2*bb,dst[i+3]=sa*alpha+a2*ba}dstContext.putImageData(dstData,offset.x,offset.y)}}},SVGStyles=Base.each({fillColor:["fill","color"],strokeColor:["stroke","color"],strokeWidth:["stroke-width","number"],strokeCap:["stroke-linecap","string"],strokeJoin:["stroke-linejoin","string"],strokeScaling:["vector-effect","lookup",{true:"none",false:"non-scaling-stroke"},function(item,value){return!value&&(item instanceof PathItem||item instanceof Shape||item instanceof TextItem)}],miterLimit:["stroke-miterlimit","number"],dashArray:["stroke-dasharray","array"],dashOffset:["stroke-dashoffset","number"],fontFamily:["font-family","string"],fontWeight:["font-weight","string"],fontSize:["font-size","number"],justification:["text-anchor","lookup",{left:"start",center:"middle",right:"end"}],opacity:["opacity","number"],blendMode:["mix-blend-mode","string"]},function(entry,key){var part=Base.capitalize(key),lookup=entry[2];this[key]={type:entry[1],property:key,attribute:entry[0],toSVG:lookup,fromSVG:lookup&&Base.each(lookup,function(value,name){this[value]=name},{}),exportFilter:entry[3],get:"get"+part,set:"set"+part}},{}),SVGNamespaces={href:"http://www.w3.org/1999/xlink",xlink:"http://www.w3.org/2000/xmlns"};return new function(){var formatter;function setAttributes(node,attrs){for(var key in attrs){var val=attrs[key],namespace=SVGNamespaces[key];"number"==typeof val&&(val=formatter.number(val)),namespace?node.setAttributeNS(namespace,key,val):node.setAttribute(key,val)}return node}function createElement(tag,attrs){return setAttributes(document.createElementNS("http://www.w3.org/2000/svg",tag),attrs)}function getTransform(matrix,coordinates,center){var attrs=new Base,trans=matrix.getTranslation();if(coordinates){var point=(matrix=matrix.shiftless())._inverseTransform(trans);attrs[center?"cx":"x"]=point.x,attrs[center?"cy":"y"]=point.y,trans=null}if(!matrix.isIdentity()){var decomposed=matrix.decompose();if(decomposed&&!decomposed.shearing){var parts=[],angle=decomposed.rotation,scale=decomposed.scaling;trans&&!trans.isZero()&&parts.push("translate("+formatter.point(trans)+")"),Numerical.isZero(scale.x-1)&&Numerical.isZero(scale.y-1)||parts.push("scale("+formatter.point(scale)+")"),angle&&parts.push("rotate("+formatter.number(angle)+")"),attrs.transform=parts.join(" ")}else attrs.transform="matrix("+matrix.getValues().join(",")+")"}return attrs}function exportGroup(item,options){for(var attrs=getTransform(item._matrix),children=item._children,node=createElement("g",attrs),i=0,l=children.length;i<l;i++){var child=children[i],childNode=exportSVG(child,options);if(childNode)if(child.isClipMask()){var clip=createElement("clipPath");clip.appendChild(childNode),setDefinition(child,clip,"clip"),setAttributes(node,{"clip-path":"url(#"+clip.id+")"})}else node.appendChild(childNode)}return node}function exportRaster(item,options){var attrs=getTransform(item._matrix,!0),size=item.getSize(),image=item.getImage();return attrs.x-=size.width/2,attrs.y-=size.height/2,attrs.width=size.width,attrs.height=size.height,attrs.href=!1===options.embedImages&&image&&image.src||item.toDataURL(),createElement("image",attrs)}function exportPath(item,options){var matchShapes=options.matchShapes;if(matchShapes){var shape=item.toShape(!1);if(shape)return exportShape(shape,options)}var segments=item._segments,type,attrs=getTransform(item._matrix);if(0===segments.length)return null;if(matchShapes&&!item.hasHandles())if(segments.length>=3){type=item._closed?"polygon":"polyline";for(var parts=[],i=0,l=segments.length;i<l;i++)parts.push(formatter.point(segments[i]._point));attrs.points=parts.join(" ")}else{type="line";var first=segments[0]._point,last=segments[segments.length-1]._point;attrs.set({x1:first.x,y1:first.y,x2:last.x,y2:last.y})}else type="path",attrs.d=item.getPathData(null,options.precision);return createElement(type,attrs)}function exportShape(item){var type=item._type,radius=item._radius,attrs=getTransform(item._matrix,!0,"rectangle"!==type);if("rectangle"===type){type="rect";var size=item._size,width=size.width,height=size.height;attrs.x-=width/2,attrs.y-=height/2,attrs.width=width,attrs.height=height,radius.isZero()&&(radius=null)}return radius&&("circle"===type?attrs.r=radius:(attrs.rx=radius.width,attrs.ry=radius.height)),createElement(type,attrs)}function exportCompoundPath(item,options){var attrs=getTransform(item._matrix),data=item.getPathData(null,options.precision);return data&&(attrs.d=data),createElement("path",attrs)}function exportPlacedSymbol(item,options){var attrs=getTransform(item._matrix,!0),symbol=item.getSymbol(),symbolNode=getDefinition(symbol,"symbol"),definition=symbol.getDefinition(),bounds=definition.getBounds();return symbolNode||((symbolNode=createElement("symbol",{viewBox:formatter.rectangle(bounds)})).appendChild(exportSVG(definition,options)),setDefinition(symbol,symbolNode,"symbol")),attrs.href="#"+symbolNode.id,attrs.x+=bounds.x,attrs.y+=bounds.y,attrs.width=formatter.number(bounds.width),attrs.height=formatter.number(bounds.height),attrs.overflow="visible",createElement("use",attrs)}function exportGradient(color){var gradientNode=getDefinition(color,"color");if(!gradientNode){var gradient=color.getGradient(),radial=gradient._radial,origin=color.getOrigin().transform(),destination=color.getDestination().transform(),attrs;if(radial){attrs={cx:origin.x,cy:origin.y,r:origin.getDistance(destination)};var highlight=color.getHighlight();highlight&&(highlight=highlight.transform(),attrs.fx=highlight.x,attrs.fy=highlight.y)}else attrs={x1:origin.x,y1:origin.y,x2:destination.x,y2:destination.y};attrs.gradientUnits="userSpaceOnUse",gradientNode=createElement((radial?"radial":"linear")+"Gradient",attrs);for(var stops=gradient._stops,i=0,l=stops.length;i<l;i++){var stop=stops[i],stopColor=stop._color,alpha=stopColor.getAlpha();attrs={offset:stop._rampPoint,"stop-color":stopColor.toCSS(!0)},alpha<1&&(attrs["stop-opacity"]=alpha),gradientNode.appendChild(createElement("stop",attrs))}setDefinition(color,gradientNode,"color")}return"url(#"+gradientNode.id+")"}function exportText(item){var node=createElement("text",getTransform(item._matrix,!0));return node.textContent=item._content,node}var exporters={Group:exportGroup,Layer:exportGroup,Raster:exportRaster,Path:exportPath,Shape:exportShape,CompoundPath:exportCompoundPath,PlacedSymbol:exportPlacedSymbol,PointText:exportText},definitions;function applyStyle(item,node,isRoot){var attrs={},parent=!isRoot&&item.getParent();return null!=item._name&&(attrs.id=item._name),Base.each(SVGStyles,function(entry){var get=entry.get,type=entry.type,value=item[get]();if(entry.exportFilter?entry.exportFilter(item,value):!parent||!Base.equals(parent[get](),value)){if("color"===type&&null!=value){var alpha=value.getAlpha();alpha<1&&(attrs[entry.attribute+"-opacity"]=alpha)}attrs[entry.attribute]=null==value?"none":"number"===type?formatter.number(value):"color"===type?value.gradient?exportGradient(value,item):value.toCSS(!0):"array"===type?value.join(","):"lookup"===type?entry.toSVG[value]:value}}),1===attrs.opacity&&delete attrs.opacity,item._visible||(attrs.visibility="hidden"),setAttributes(node,attrs)}function getDefinition(item,type){return definitions||(definitions={ids:{},svgs:{}}),item&&definitions.svgs[type+"-"+item._id]}function setDefinition(item,node,type){definitions||getDefinition();var id=definitions.ids[type]=(definitions.ids[type]||0)+1;node.id=type+"-"+id,definitions.svgs[type+"-"+item._id]=node}function exportDefinitions(node,options){var svg=node,defs=null;if(definitions){for(var i in svg="svg"===node.nodeName.toLowerCase()&&node,definitions.svgs)defs||(svg||(svg=createElement("svg")).appendChild(node),defs=svg.insertBefore(createElement("defs"),svg.firstChild)),defs.appendChild(definitions.svgs[i]);definitions=null}return options.asString?(new XMLSerializer).serializeToString(svg):svg}function exportSVG(item,options,isRoot){var exporter=exporters[item._class],node=exporter&&exporter(item,options);if(node){var onExport=options.onExport;onExport&&(node=onExport(item,node,options)||node);var data=JSON.stringify(item._data);data&&"{}"!==data&&"null"!==data&&node.setAttribute("data-paper-data",data)}return node&&applyStyle(item,node,isRoot)}function setOptions(options){return options||(options={}),formatter=new Formatter(options.precision),options}Item.inject({exportSVG:function(options){return exportDefinitions(exportSVG(this,options=setOptions(options),!0),options)}}),Project.inject({exportSVG:function(options){options=setOptions(options);var layers=this.layers,view=this.getView(),size=view.getViewSize(),node=createElement("svg",{x:0,y:0,width:size.width,height:size.height,version:"1.1",xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink"}),parent=node,matrix=view._matrix;matrix.isIdentity()||(parent=node.appendChild(createElement("g",getTransform(matrix))));for(var i=0,l=layers.length;i<l;i++)parent.appendChild(exportSVG(layers[i],options,!0));return exportDefinitions(node,options)}})},new function(){function getValue(node,name,isString,allowNull){var namespace=SVGNamespaces[name],value=namespace?node.getAttributeNS(namespace,name):node.getAttribute(name);return"null"===value&&(value=null),null==value?allowNull?null:isString?"":0:isString?value:parseFloat(value)}function getPoint(node,x,y,allowNull){return x=getValue(node,x,!1,allowNull),y=getValue(node,y,!1,allowNull),!allowNull||null!=x&&null!=y?new Point(x,y):null}function getSize(node,w,h,allowNull){return w=getValue(node,w,!1,allowNull),h=getValue(node,h,!1,allowNull),!allowNull||null!=w&&null!=h?new Size(w,h):null}function convertValue(value,type,lookup){return"none"===value?null:"number"===type?parseFloat(value):"array"===type?value?value.split(/[\s,]+/g).map(parseFloat):[]:"color"===type?getDefinition(value)||value:"lookup"===type?lookup[value]:value}function importGroup(node,type,options,isRoot){var nodes=node.childNodes,isClip="clippath"===type,item=new Group,project=item._project,currentStyle=project._currentStyle,children=[];if(isClip||(item=applyAttributes(item,node,isRoot),project._currentStyle=item._style.clone()),isRoot)for(var defs=node.querySelectorAll("defs"),i=0,l=defs.length;i<l;i++)importSVG(defs[i],options,!1);for(var i=0,l=nodes.length;i<l;i++){var childNode=nodes[i],child;1!==childNode.nodeType||"defs"===childNode.nodeName.toLowerCase()||!(child=importSVG(childNode,options,!1))||child instanceof Symbol||children.push(child)}return item.addChildren(children),isClip&&(item=applyAttributes(item.reduce(),node,isRoot)),project._currentStyle=currentStyle,(isClip||"defs"===type)&&(item.remove(),item=null),item}function importPoly(node,type){for(var coords=node.getAttribute("points").match(/[+-]?(?:\d*\.\d+|\d+\.?)(?:[eE][+-]?\d+)?/g),points=[],i=0,l=coords.length;i<l;i+=2)points.push(new Point(parseFloat(coords[i]),parseFloat(coords[i+1])));var path=new Path(points);return"polygon"===type&&path.closePath(),path}function importPath(node){var data=node.getAttribute("d"),param={pathData:data};return(data.match(/m/gi)||[]).length>1||/z\S+/i.test(data)?new CompoundPath(param):new Path(param)}function importGradient(node,type){var id=(getValue(node,"href",!0)||"").substring(1),isRadial="radialgradient"===type,gradient,origin,destination,highlight;if(id)gradient=definitions[id].getGradient();else{for(var nodes=node.childNodes,stops=[],i=0,l=nodes.length;i<l;i++){var child=nodes[i];1===child.nodeType&&stops.push(applyAttributes(new GradientStop,child))}gradient=new Gradient(stops,isRadial)}return isRadial?(destination=(origin=getPoint(node,"cx","cy")).add(getValue(node,"r"),0),highlight=getPoint(node,"fx","fy",!0)):(origin=getPoint(node,"x1","y1"),destination=getPoint(node,"x2","y2")),applyAttributes(new Color(gradient,origin,destination,highlight),node),null}var importers={"#document":function(node,type,options,isRoot){for(var nodes=node.childNodes,i=0,l=nodes.length;i<l;i++){var child=nodes[i];if(1===child.nodeType){var next=child.nextSibling;document.body.appendChild(child);var item=importSVG(child,options,isRoot);return next?node.insertBefore(child,next):node.appendChild(child),item}}},g:importGroup,svg:importGroup,clippath:importGroup,polygon:importPoly,polyline:importPoly,path:importPath,lineargradient:importGradient,radialgradient:importGradient,image:function(node){var raster=new Raster(getValue(node,"href",!0));return raster.on("load",function(){var size=getSize(node,"width","height");this.setSize(size);var center=this._matrix._transformPoint(getPoint(node,"x","y").add(size.divide(2)));this.translate(center)}),raster},symbol:function(node,type,options,isRoot){return new Symbol(importGroup(node,type,options,isRoot),!0)},defs:importGroup,use:function(node){var id=(getValue(node,"href",!0)||"").substring(1),definition=definitions[id],point=getPoint(node,"x","y");return definition?definition instanceof Symbol?definition.place(point):definition.clone().translate(point):null},circle:function(node){return new Shape.Circle(getPoint(node,"cx","cy"),getValue(node,"r"))},ellipse:function(node){return new Shape.Ellipse({center:getPoint(node,"cx","cy"),radius:getSize(node,"rx","ry")})},rect:function(node){var point=getPoint(node,"x","y"),size=getSize(node,"width","height"),radius=getSize(node,"rx","ry");return new Shape.Rectangle(new Rectangle(point,size),radius)},line:function(node){return new Path.Line(getPoint(node,"x1","y1"),getPoint(node,"x2","y2"))},text:function(node){var text=new PointText(getPoint(node,"x","y").add(getPoint(node,"dx","dy")));return text.setContent(node.textContent.trim()||""),text}};function applyTransform(item,value,name,node){for(var transforms=(node.getAttribute(name)||"").split(/\)\s*/g),matrix=new Matrix,i=0,l=transforms.length;i<l;i++){var transform=transforms[i];if(!transform)break;for(var parts=transform.split(/\(\s*/),command=parts[0],v=parts[1].split(/[\s,]+/g),j=0,m=v.length;j<m;j++)v[j]=parseFloat(v[j]);switch(command){case"matrix":matrix.concatenate(new Matrix(v[0],v[1],v[2],v[3],v[4],v[5]));break;case"rotate":matrix.rotate(v[0],v[1],v[2]);break;case"translate":matrix.translate(v[0],v[1]);break;case"scale":matrix.scale(v);break;case"skewX":matrix.skew(v[0],0);break;case"skewY":matrix.skew(0,v[0])}}item.transform(matrix)}function applyOpacity(item,value,name){var color=item["fill-opacity"===name?"getFillColor":"getStrokeColor"]();color&&color.setAlpha(parseFloat(value))}var attributes=Base.set(Base.each(SVGStyles,function(entry){this[entry.attribute]=function(item,value){if(item[entry.set](convertValue(value,entry.type,entry.fromSVG)),"color"===entry.type&&item instanceof Shape){var color=item[entry.get]();color&&color.transform((new Matrix).translate(item.getPosition(!0).negate()))}}},{}),{id:function(item,value){definitions[value]=item,item.setName&&item.setName(value)},"clip-path":function(item,value){var clip=getDefinition(value);if(clip){if((clip=clip.clone()).setClipMask(!0),!(item instanceof Group))return new Group(clip,item);item.insertChild(0,clip)}},gradientTransform:applyTransform,transform:applyTransform,"fill-opacity":applyOpacity,"stroke-opacity":applyOpacity,visibility:function(item,value){item.setVisible("visible"===value)},display:function(item,value){item.setVisible(null!==value)},"stop-color":function(item,value){item.setColor&&item.setColor(value)},"stop-opacity":function(item,value){item._color&&item._color.setAlpha(parseFloat(value))},offset:function(item,value){var percentage=value.match(/(.*)%$/);item.setRampPoint(percentage?percentage[1]/100:parseFloat(value))},viewBox:function(item,value,name,node,styles){var rect=new Rectangle(convertValue(value,"array")),size=getSize(node,"width","height",!0);if(item instanceof Group){var scale=size?rect.getSize().divide(size):1,matrix=(new Matrix).translate(rect.getPoint()).scale(scale);item.transform(matrix.inverted())}else if(item instanceof Symbol){size&&rect.setSize(size);var clip="visible"!=getAttribute(node,"overflow",styles),group=item._definition;clip&&!rect.contains(group.getBounds())&&((clip=new Shape.Rectangle(rect).transform(group._matrix)).setClipMask(!0),group.addChild(clip))}}});function getAttribute(node,name,styles){var attr=node.attributes[name],value=attr&&attr.value;if(!value){var style=Base.camelize(name);(value=node.style[style])||styles.node[style]===styles.parent[style]||(value=styles.node[style])}return value?"none"===value?null:value:undefined}function applyAttributes(item,node,isRoot){var styles={node:DomElement.getStyles(node)||{},parent:!isRoot&&DomElement.getStyles(node.parentNode)||{}};return Base.each(attributes,function(apply,name){var value=getAttribute(node,name,styles);value!==undefined&&(item=Base.pick(apply(item,value,name,node,styles),item))}),item}var definitions={};function getDefinition(value){var match=value&&value.match(/\((?:#|)([^)']+)/);return match&&definitions[match[1]]}function importSVG(source,options,isRoot){if(!source)return null;options?"function"==typeof options&&(options={onLoad:options}):options={};var node=source,scope=paper;function onLoadCallback(svg){paper=scope;var item=importSVG(svg,options,isRoot),onLoad=options.onLoad,view=scope.project&&scope.getView();onLoad&&onLoad.call(this,item),view.update()}if(isRoot)if("string"!=typeof source||/^.*</.test(source)){if("undefined"!=typeof File&&source instanceof File){var reader=new FileReader;return reader.onload=function(){onLoadCallback(reader.result)},reader.readAsText(source)}}else{if(!(node=document.getElementById(source)))return Http.request("get",source,onLoadCallback);source=null}if("string"==typeof source&&(node=(new DOMParser).parseFromString(source,"image/svg+xml")),!node.nodeName)throw new Error("Unsupported SVG source: "+source);var type=node.nodeName.toLowerCase(),importer=importers[type],item,data=node.getAttribute&&node.getAttribute("data-paper-data"),settings=scope.settings,applyMatrix=settings.applyMatrix;if(settings.applyMatrix=!1,item=importer&&importer(node,type,options,isRoot)||null,settings.applyMatrix=applyMatrix,item){"#document"===type||item instanceof Group||(item=applyAttributes(item,node,isRoot));var onImport=options.onImport;onImport&&(item=onImport(node,item,options)||item),options.expandShapes&&item instanceof Shape&&(item.remove(),item=item.toPath()),data&&(item._data=JSON.parse(data))}return isRoot&&(definitions={},item&&Base.pick(options.applyMatrix,applyMatrix)&&item.matrix.apply(!0,!0)),item}Item.inject({importSVG:function(node,options){return this.addChild(importSVG(node,options,!0))}}),Project.inject({importSVG:function(node,options){return this.activate(),importSVG(node,options,!0)}})},Base.exports.PaperScript=function(){var exports,define,scope=this,e,r;(r=function(e){"use strict";function r(e){for(var r in fr=e||{},mr)Object.prototype.hasOwnProperty.call(fr,r)||(fr[r]=mr[r]);hr=fr.sourceFile||null}function t(e,r){var t=vr(dr,e);r+=" ("+t.line+":"+t.column+")";var n=new SyntaxError(r);throw n.pos=e,n.loc=t,n.raisedAt=br,n}function n(e){function r(e){if(1==e.length)return t+="return str === "+JSON.stringify(e[0])+";";t+="switch(str){";for(var r=0;r<e.length;++r)t+="case "+JSON.stringify(e[r])+":";t+="return true}return false;"}e=e.split(" ");var t="",n=[];e:for(var a=0;a<e.length;++a){for(var o=0;o<n.length;++o)if(n[o][0].length==e[a].length){n[o].push(e[a]);continue e}n.push([e[a]])}if(n.length>3){n.sort(function(e,r){return r.length-e.length}),t+="switch(str.length){";for(var a=0;a<n.length;++a){var i=n[a];t+="case "+i[0].length+":",r(i)}t+="}"}else r(e);return new Function("str",t)}function a(){this.line=Ar,this.column=br-Sr}function o(){Ar=1,br=Sr=0,Er=!0,u()}function i(e,r){gr=br,fr.locations&&(kr=new a),wr=e,u(),Cr=r,Er=e.beforeExpr}function s(){var e=fr.onComment&&fr.locations&&new a,r=br,n=dr.indexOf("*/",br+=2);if(-1===n&&t(br-2,"Unterminated comment"),br=n+2,fr.locations){Kt.lastIndex=r;for(var o;(o=Kt.exec(dr))&&o.index<br;)++Ar,Sr=o.index+o[0].length}fr.onComment&&fr.onComment(!0,dr.slice(r+2,n),r,br,e,fr.locations&&new a)}function c(){for(var e=br,r=fr.onComment&&fr.locations&&new a,t=dr.charCodeAt(br+=2);pr>br&&10!==t&&13!==t&&8232!==t&&8233!==t;)++br,t=dr.charCodeAt(br);fr.onComment&&fr.onComment(!1,dr.slice(e+2,br),e,br,r,fr.locations&&new a)}function u(){for(;pr>br;){var e=dr.charCodeAt(br);if(32===e)++br;else if(13===e){var r;++br,10===(r=dr.charCodeAt(br))&&++br,fr.locations&&(++Ar,Sr=br)}else if(10===e||8232===e||8233===e)++br,fr.locations&&(++Ar,Sr=br);else if(e>8&&14>e)++br;else if(47===e){var r;if(42===(r=dr.charCodeAt(br+1)))s();else{if(47!==r)break;c()}}else if(160===e)++br;else{if(!(e>=5760&&Jt.test(String.fromCharCode(e))))break;++br}}}function l(){var e=dr.charCodeAt(br+1);return e>=48&&57>=e?E(!0):(++br,i(xt))}function f(){var e=dr.charCodeAt(br+1);return Er?(++br,k()):61===e?x(Et,2):x(wt,1)}function d(){var e;return 61===dr.charCodeAt(br+1)?x(Et,2):x(Dt,1)}function p(e){var r=dr.charCodeAt(br+1);return r===e?x(124===e?Lt:Ut,2):61===r?x(Et,2):x(124===e?Rt:Tt,1)}function h(){var e;return 61===dr.charCodeAt(br+1)?x(Et,2):x(Vt,1)}function m(e){var r=dr.charCodeAt(br+1);return r===e?45==r&&62==dr.charCodeAt(br+2)&&Gt.test(dr.slice(Lr,br))?(br+=3,c(),u(),g()):x(St,2):61===r?x(Et,2):x(At,1)}function v(e){var r=dr.charCodeAt(br+1),t=1;return r===e?(t=62===e&&62===dr.charCodeAt(br+2)?3:2,61===dr.charCodeAt(br+t)?x(Et,t+1):x(jt,t)):33==r&&60==e&&45==dr.charCodeAt(br+2)&&45==dr.charCodeAt(br+3)?(br+=4,c(),u(),g()):(61===r&&(t=61===dr.charCodeAt(br+2)?3:2),x(Ot,t))}function b(e){var r;return 61===dr.charCodeAt(br+1)?x(qt,61===dr.charCodeAt(br+2)?3:2):x(61===e?Ct:It,1)}function y(e){switch(e){case 46:return l();case 40:return++br,i(mt);case 41:return++br,i(vt);case 59:return++br,i(yt);case 44:return++br,i(bt);case 91:return++br,i(ft);case 93:return++br,i(dt);case 123:return++br,i(pt);case 125:return++br,i(ht);case 58:return++br,i(gt);case 63:return++br,i(kt);case 48:var r=dr.charCodeAt(br+1);if(120===r||88===r)return C();case 49:case 50:case 51:case 52:case 53:case 54:case 55:case 56:case 57:return E(!1);case 34:case 39:return A(e);case 47:return f(e);case 37:case 42:return d();case 124:case 38:return p(e);case 94:return h();case 43:case 45:return m(e);case 60:case 62:return v(e);case 61:case 33:return b(e);case 126:return x(It,1)}return!1}function g(e){if(e?br=yr+1:yr=br,fr.locations&&(xr=new a),e)return k();if(br>=pr)return i(Br);var r=dr.charCodeAt(br);if(Qt(r)||92===r)return L();var n=y(r);if(!1===n){var o=String.fromCharCode(r);if("\\"===o||$t.test(o))return L();t(br,"Unexpected character '"+o+"'")}return n}function x(e,r){var t=dr.slice(br,br+r);br+=r,i(e,t)}function k(){for(var e,r,n="",a=br;;){br>=pr&&t(a,"Unterminated regular expression");var o=dr.charAt(br);if(Gt.test(o)&&t(a,"Unterminated regular expression"),e)e=!1;else{if("["===o)r=!0;else if("]"===o&&r)r=!1;else if("/"===o&&!r)break;e="\\"===o}++br}var n=dr.slice(a,br);++br;var s=I();return s&&!/^[gmsiy]*$/.test(s)&&t(a,"Invalid regexp flag"),i(jr,new RegExp(n,s))}function w(e,r){for(var t=br,n=0,a=0,o=null==r?1/0:r;o>a;++a){var i,s=dr.charCodeAt(br);if((i=s>=97?s-97+10:s>=65?s-65+10:s>=48&&57>=s?s-48:1/0)>=e)break;++br,n=n*e+i}return br===t||null!=r&&br-t!==r?null:n}function C(){br+=2;var e=w(16);return null==e&&t(yr+2,"Expected hexadecimal number"),Qt(dr.charCodeAt(br))&&t(br,"Identifier directly after number"),i(Or,e)}function E(e){var r=br,n=!1,a=48===dr.charCodeAt(br);e||null!==w(10)||t(r,"Invalid number"),46===dr.charCodeAt(br)&&(++br,w(10),n=!0);var o=dr.charCodeAt(br);(69===o||101===o)&&((43===(o=dr.charCodeAt(++br))||45===o)&&++br,null===w(10)&&t(r,"Invalid number"),n=!0),Qt(dr.charCodeAt(br))&&t(br,"Identifier directly after number");var s,c=dr.slice(r,br);return n?s=parseFloat(c):a&&1!==c.length?/[89]/.test(c)||Tr?t(r,"Invalid number"):s=parseInt(c,8):s=parseInt(c,10),i(Or,s)}function A(e){br++;for(var r="";;){br>=pr&&t(yr,"Unterminated string constant");var n=dr.charCodeAt(br);if(n===e)return++br,i(Dr,r);if(92===n){n=dr.charCodeAt(++br);var a=/^[0-7]+/.exec(dr.slice(br,br+3));for(a&&(a=a[0]);a&&parseInt(a,8)>255;)a=a.slice(0,a.length-1);if("0"===a&&(a=null),++br,a)Tr&&t(br-2,"Octal literal in strict mode"),r+=String.fromCharCode(parseInt(a,8)),br+=a.length-1;else switch(n){case 110:r+="\n";break;case 114:r+="\r";break;case 120:r+=String.fromCharCode(S(2));break;case 117:r+=String.fromCharCode(S(4));break;case 85:r+=String.fromCharCode(S(8));break;case 116:r+="\t";break;case 98:r+="\b";break;case 118:r+="\v";break;case 102:r+="\f";break;case 48:r+="\0";break;case 13:10===dr.charCodeAt(br)&&++br;case 10:fr.locations&&(Sr=br,++Ar);break;default:r+=String.fromCharCode(n)}}else(13===n||10===n||8232===n||8233===n)&&t(yr,"Unterminated string constant"),r+=String.fromCharCode(n),++br}}function S(e){var r=w(16,e);return null===r&&t(yr,"Bad character escape sequence"),r}function I(){Bt=!1;for(var e,r=!0,n=br;;){var a=dr.charCodeAt(br);if(Yt(a))Bt&&(e+=dr.charAt(br)),++br;else{if(92!==a)break;Bt||(e=dr.slice(n,br)),Bt=!0,117!=dr.charCodeAt(++br)&&t(br,"Expecting Unicode escape sequence \\uXXXX"),++br;var o=S(4),i=String.fromCharCode(o);i||t(br-1,"Invalid Unicode escape"),(r?Qt(o):Yt(o))||t(br-4,"Invalid Unicode escape"),e+=i}r=!1}return Bt?e:dr.slice(n,br)}function L(){var e=I(),r=Fr;return Bt||(Wt(e)?r=lt[e]:(fr.forbidReserved&&(3===fr.ecmaVersion?Mt:zt)(e)||Tr&&Xt(e))&&t(yr,"The keyword '"+e+"' is reserved")),i(r,e)}function U(){Ir=yr,Lr=gr,Ur=kr,g()}function R(e){if(Tr=e,br=Lr,fr.locations)for(;Sr>br;)Sr=dr.lastIndexOf("\n",Sr-2)+1,--Ar;u(),g()}function V(){this.type=null,this.start=yr,this.end=null}function T(){this.start=xr,this.end=null,null!==hr&&(this.source=hr)}function q(){var e=new V;return fr.locations&&(e.loc=new T),fr.ranges&&(e.range=[yr,0]),e}function O(e){var r=new V;return r.start=e.start,fr.locations&&(r.loc=new T,r.loc.start=e.loc.start),fr.ranges&&(r.range=[e.range[0],0]),r}function j(e,r){return e.type=r,e.end=Lr,fr.locations&&(e.loc.end=Ur),fr.ranges&&(e.range[1]=Lr),e}function D(e){return fr.ecmaVersion>=5&&"ExpressionStatement"===e.type&&"Literal"===e.expression.type&&"use strict"===e.expression.value}function F(e){return wr===e?(U(),!0):void 0}function B(){return!fr.strictSemicolons&&(wr===Br||wr===ht||Gt.test(dr.slice(Lr,yr)))}function M(){F(yt)||B()||X()}function z(e){wr===e?U():X()}function X(){t(yr,"Unexpected token")}function N(e){"Identifier"!==e.type&&"MemberExpression"!==e.type&&t(e.start,"Assigning to rvalue"),Tr&&"Identifier"===e.type&&Nt(e.name)&&t(e.start,"Assigning to "+e.name+" in strict mode")}function W(e){Ir=Lr=br,fr.locations&&(Ur=new a),Rr=Tr=null,Vr=[],g();var r=e||q(),t=!0;for(e||(r.body=[]);wr!==Br;){var n=J();r.body.push(n),t&&D(n)&&R(!0),t=!1}return j(r,"Program")}function J(){(wr===wt||wr===Et&&"/="==Cr)&&g(!0);var e=wr,r=q();switch(e){case Mr:case Nr:U();var n=e===Mr;F(yt)||B()?r.label=null:wr!==Fr?X():(r.label=lr(),M());for(var a=0;a<Vr.length;++a){var o=Vr[a];if(null==r.label||o.name===r.label.name){if(null!=o.kind&&(n||"loop"===o.kind))break;if(r.label&&n)break}}return a===Vr.length&&t(r.start,"Unsyntactic "+e.keyword),j(r,n?"BreakStatement":"ContinueStatement");case Wr:return U(),M(),j(r,"DebuggerStatement");case Pr:return U(),Vr.push(Zt),r.body=J(),Vr.pop(),z(tt),r.test=P(),M(),j(r,"DoWhileStatement");case _r:if(U(),Vr.push(Zt),z(mt),wr===yt)return $(r,null);if(wr===rt){var i=q();return U(),G(i,!0),j(i,"VariableDeclaration"),1===i.declarations.length&&F(ut)?_(r,i):$(r,i)}var i=K(!1,!0);return F(ut)?(N(i),_(r,i)):$(r,i);case Gr:return U(),cr(r,!0);case Kr:return U(),r.test=P(),r.consequent=J(),r.alternate=F(Hr)?J():null,j(r,"IfStatement");case Qr:return Rr||t(yr,"'return' outside of function"),U(),F(yt)||B()?r.argument=null:(r.argument=K(),M()),j(r,"ReturnStatement");case Yr:U(),r.discriminant=P(),r.cases=[],z(pt),Vr.push(en);for(var s,c;wr!=ht;)if(wr===zr||wr===Jr){var u=wr===zr;s&&j(s,"SwitchCase"),r.cases.push(s=q()),s.consequent=[],U(),u?s.test=K():(c&&t(Ir,"Multiple default clauses"),c=!0,s.test=null),z(gt)}else s||X(),s.consequent.push(J());return s&&j(s,"SwitchCase"),U(),Vr.pop(),j(r,"SwitchStatement");case Zr:return U(),Gt.test(dr.slice(Lr,yr))&&t(Lr,"Illegal newline after throw"),r.argument=K(),M(),j(r,"ThrowStatement");case et:if(U(),r.block=H(),r.handler=null,wr===Xr){var l=q();U(),z(mt),l.param=lr(),Tr&&Nt(l.param.name)&&t(l.param.start,"Binding "+l.param.name+" in strict mode"),z(vt),l.guard=null,l.body=H(),r.handler=j(l,"CatchClause")}return r.guardedHandlers=qr,r.finalizer=F($r)?H():null,r.handler||r.finalizer||t(r.start,"Missing catch or finally clause"),j(r,"TryStatement");case rt:return U(),G(r),M(),j(r,"VariableDeclaration");case tt:return U(),r.test=P(),Vr.push(Zt),r.body=J(),Vr.pop(),j(r,"WhileStatement");case nt:return Tr&&t(yr,"'with' in strict mode"),U(),r.object=P(),r.body=J(),j(r,"WithStatement");case pt:return H();case yt:return U(),j(r,"EmptyStatement");default:var f=Cr,d=K();if(e===Fr&&"Identifier"===d.type&&F(gt)){for(var a=0;a<Vr.length;++a)Vr[a].name===f&&t(d.start,"Label '"+f+"' is already declared");var p=wr.isLoop?"loop":wr===Yr?"switch":null;return Vr.push({name:f,kind:p}),r.body=J(),Vr.pop(),r.label=d,j(r,"LabeledStatement")}return r.expression=d,M(),j(r,"ExpressionStatement")}}function P(){z(mt);var e=K();return z(vt),e}function H(e){var r,t=q(),n=!0,a=!1;for(t.body=[],z(pt);!F(ht);){var o=J();t.body.push(o),n&&e&&D(o)&&(r=a,R(a=!0)),n=!1}return a&&!r&&R(!1),j(t,"BlockStatement")}function $(e,r){return e.init=r,z(yt),e.test=wr===yt?null:K(),z(yt),e.update=wr===vt?null:K(),z(vt),e.body=J(),Vr.pop(),j(e,"ForStatement")}function _(e,r){return e.left=r,e.right=K(),z(vt),e.body=J(),Vr.pop(),j(e,"ForInStatement")}function G(e,r){for(e.declarations=[],e.kind="var";;){var n=q();if(n.id=lr(),Tr&&Nt(n.id.name)&&t(n.id.start,"Binding "+n.id.name+" in strict mode"),n.init=F(Ct)?K(!0,r):null,e.declarations.push(j(n,"VariableDeclarator")),!F(bt))break}return e}function K(e,r){var t=Q(r);if(!e&&wr===bt){var n=O(t);for(n.expressions=[t];F(bt);)n.expressions.push(Q(r));return j(n,"SequenceExpression")}return t}function Q(e){var r=Y(e);if(wr.isAssign){var t=O(r);return t.operator=Cr,t.left=r,U(),t.right=Q(e),N(r),j(t,"AssignmentExpression")}return r}function Y(e){var r=Z(e);if(F(kt)){var t=O(r);return t.test=r,t.consequent=K(!0),z(gt),t.alternate=K(!0,e),j(t,"ConditionalExpression")}return r}function Z(e){return er(rr(),-1,e)}function er(e,r,t){var n=wr.binop;if(null!=n&&(!t||wr!==ut)&&n>r){var a=O(e),o;return a.left=e,a.operator=Cr,U(),a.right=er(rr(),n,t),er(j(a,/&&|\|\|/.test(a.operator)?"LogicalExpression":"BinaryExpression"),r,t)}return e}function rr(){if(wr.prefix){var e=q(),r=wr.isUpdate;return e.operator=Cr,e.prefix=!0,Er=!0,U(),e.argument=rr(),r?N(e.argument):Tr&&"delete"===e.operator&&"Identifier"===e.argument.type&&t(e.start,"Deleting local variable in strict mode"),j(e,r?"UpdateExpression":"UnaryExpression")}for(var n=tr();wr.postfix&&!B();){var e;(e=O(n)).operator=Cr,e.prefix=!1,e.argument=n,N(n),U(),n=j(e,"UpdateExpression")}return n}function tr(){return nr(ar())}function nr(e,r){var t,t,t;return F(xt)?((t=O(e)).object=e,t.property=lr(!0),t.computed=!1,nr(j(t,"MemberExpression"),r)):F(ft)?((t=O(e)).object=e,t.property=K(),t.computed=!0,z(dt),nr(j(t,"MemberExpression"),r)):!r&&F(mt)?((t=O(e)).callee=e,t.arguments=ur(vt,!1),nr(j(t,"CallExpression"),r)):e}function ar(){switch(wr){case ot:var e=q();return U(),j(e,"ThisExpression");case Fr:return lr();case Or:case Dr:case jr:var e;return(e=q()).value=Cr,e.raw=dr.slice(yr,gr),U(),j(e,"Literal");case it:case st:case ct:var e;return(e=q()).value=wr.atomValue,e.raw=wr.keyword,U(),j(e,"Literal");case mt:var r=xr,t=yr;U();var n=K();return n.start=t,n.end=gr,fr.locations&&(n.loc.start=r,n.loc.end=kr),fr.ranges&&(n.range=[t,gr]),z(vt),n;case ft:var e=q();return U(),e.elements=ur(dt,!0,!0),j(e,"ArrayExpression");case pt:return ir();case Gr:var e=q();return U(),cr(e,!1);case at:return or();default:X()}}function or(){var e=q();return U(),e.callee=nr(ar(),!0),e.arguments=F(mt)?ur(vt,!1):qr,j(e,"NewExpression")}function ir(){var e=q(),r=!0,n=!1;for(e.properties=[],U();!F(ht);){if(r)r=!1;else if(z(bt),fr.allowTrailingCommas&&F(ht))break;var a,o={key:sr()},i=!1;if(F(gt)?(o.value=K(!0),a=o.kind="init"):fr.ecmaVersion>=5&&"Identifier"===o.key.type&&("get"===o.key.name||"set"===o.key.name)?(i=n=!0,a=o.kind=o.key.name,o.key=sr(),wr!==mt&&X(),o.value=cr(q(),!1)):X(),"Identifier"===o.key.type&&(Tr||n))for(var s=0;s<e.properties.length;++s){var c=e.properties[s];if(c.key.name===o.key.name){var u=a==c.kind||i&&"init"===c.kind||"init"===a&&("get"===c.kind||"set"===c.kind);u&&!Tr&&"init"===a&&"init"===c.kind&&(u=!1),u&&t(o.key.start,"Redefinition of property")}}e.properties.push(o)}return j(e,"ObjectExpression")}function sr(){return wr===Or||wr===Dr?ar():lr(!0)}function cr(e,r){wr===Fr?e.id=lr():r?X():e.id=null,e.params=[];var n=!0;for(z(mt);!F(vt);)n?n=!1:z(bt),e.params.push(lr());var a=Rr,o=Vr;if(Rr=!0,Vr=[],e.body=H(!0),Rr=a,Vr=o,Tr||e.body.body.length&&D(e.body.body[0]))for(var i=e.id?-1:0;i<e.params.length;++i){var s=0>i?e.id:e.params[i];if((Xt(s.name)||Nt(s.name))&&t(s.start,"Defining '"+s.name+"' in strict mode"),i>=0)for(var c=0;i>c;++c)s.name===e.params[c].name&&t(s.start,"Argument name clash in strict mode")}return j(e,r?"FunctionDeclaration":"FunctionExpression")}function ur(e,r,t){for(var n=[],a=!0;!F(e);){if(a)a=!1;else if(z(bt),r&&fr.allowTrailingCommas&&F(e))break;t&&wr===bt?n.push(null):n.push(K(!0))}return n}function lr(e){var r=q();return r.name=wr===Fr?Cr:e&&!fr.forbidReserved&&wr.keyword||X(),Er=!1,U(),j(r,"Identifier")}var fr,dr,pr,hr;e.version="0.4.0",e.parse=function(e,t){return dr=String(e),pr=dr.length,r(t),o(),W(fr.program)};var mr=e.defaultOptions={ecmaVersion:5,strictSemicolons:!1,allowTrailingCommas:!0,forbidReserved:!1,locations:!1,onComment:null,ranges:!1,program:null,sourceFile:null},vr=e.getLineInfo=function(e,r){for(var t=1,n=0;;){Kt.lastIndex=n;var a=Kt.exec(e);if(!(a&&a.index<r))break;++t,n=a.index+a[0].length}return{line:t,column:r-n}};e.tokenize=function(e,t){function n(e){return g(e),a.start=yr,a.end=gr,a.startLoc=xr,a.endLoc=kr,a.type=wr,a.value=Cr,a}dr=String(e),pr=dr.length,r(t),o();var a={};return n.jumpTo=function(e,r){if(br=e,fr.locations){Ar=1,Sr=Kt.lastIndex=0;for(var t;(t=Kt.exec(dr))&&t.index<e;)++Ar,Sr=t.index+t[0].length}Er=r,u()},n};var br,yr,gr,xr,kr,wr,Cr,Er,Ar,Sr,Ir,Lr,Ur,Rr,Vr,Tr,qr=[],Or={type:"num"},jr={type:"regexp"},Dr={type:"string"},Fr={type:"name"},Br={type:"eof"},Mr={keyword:"break"},zr={keyword:"case",beforeExpr:!0},Xr={keyword:"catch"},Nr={keyword:"continue"},Wr={keyword:"debugger"},Jr={keyword:"default"},Pr={keyword:"do",isLoop:!0},Hr={keyword:"else",beforeExpr:!0},$r={keyword:"finally"},_r={keyword:"for",isLoop:!0},Gr={keyword:"function"},Kr={keyword:"if"},Qr={keyword:"return",beforeExpr:!0},Yr={keyword:"switch"},Zr={keyword:"throw",beforeExpr:!0},et={keyword:"try"},rt={keyword:"var"},tt={keyword:"while",isLoop:!0},nt={keyword:"with"},at={keyword:"new",beforeExpr:!0},ot={keyword:"this"},it={keyword:"null",atomValue:null},st={keyword:"true",atomValue:!0},ct={keyword:"false",atomValue:!1},ut={keyword:"in",binop:7,beforeExpr:!0},lt={break:Mr,case:zr,catch:Xr,continue:Nr,debugger:Wr,default:Jr,do:Pr,else:Hr,finally:$r,for:_r,function:Gr,if:Kr,return:Qr,switch:Yr,throw:Zr,try:et,var:rt,while:tt,with:nt,null:it,true:st,false:ct,new:at,in:ut,instanceof:{keyword:"instanceof",binop:7,beforeExpr:!0},this:ot,typeof:{keyword:"typeof",prefix:!0,beforeExpr:!0},void:{keyword:"void",prefix:!0,beforeExpr:!0},delete:{keyword:"delete",prefix:!0,beforeExpr:!0}},ft={type:"[",beforeExpr:!0},dt={type:"]"},pt={type:"{",beforeExpr:!0},ht={type:"}"},mt={type:"(",beforeExpr:!0},vt={type:")"},bt={type:",",beforeExpr:!0},yt={type:";",beforeExpr:!0},gt={type:":",beforeExpr:!0},xt={type:"."},kt={type:"?",beforeExpr:!0},wt={binop:10,beforeExpr:!0},Ct={isAssign:!0,beforeExpr:!0},Et={isAssign:!0,beforeExpr:!0},At={binop:9,prefix:!0,beforeExpr:!0},St={postfix:!0,prefix:!0,isUpdate:!0},It={prefix:!0,beforeExpr:!0},Lt={binop:1,beforeExpr:!0},Ut={binop:2,beforeExpr:!0},Rt={binop:3,beforeExpr:!0},Vt={binop:4,beforeExpr:!0},Tt={binop:5,beforeExpr:!0},qt={binop:6,beforeExpr:!0},Ot={binop:7,beforeExpr:!0},jt={binop:8,beforeExpr:!0},Dt={binop:10,beforeExpr:!0};for(var Ft in e.tokTypes={bracketL:ft,bracketR:dt,braceL:pt,braceR:ht,parenL:mt,parenR:vt,comma:bt,semi:yt,colon:gt,dot:xt,question:kt,slash:wt,eq:Ct,name:Fr,eof:Br,num:Or,regexp:jr,string:Dr},lt)e.tokTypes["_"+Ft]=lt[Ft];var Bt,Mt=n("abstract boolean byte char class double enum export extends final float goto implements import int interface long native package private protected public short static super synchronized throws transient volatile"),zt=n("class enum extends super const export import"),Xt=n("implements interface let package private protected public static yield"),Nt=n("eval arguments"),Wt=n("break case catch continue debugger default do else finally for function if return switch throw try var while with null true false instanceof typeof void delete new in this"),Jt=/[\u1680\u180e\u2000-\u200a\u202f\u205f\u3000\ufeff]/,Pt="------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------",Ht="------------------------------------------------------------------------------------------------------------------------------------------",$t=new RegExp("["+Pt+"]"),_t=new RegExp("["+Pt+Ht+"]"),Gt=/[\n\r\u2028\u2029]/,Kt=/\r\n|[\n\r\u2028\u2029]/g,Qt=e.isIdentifierStart=function(e){return 65>e?36===e:91>e||(97>e?95===e:123>e||e>=170&&$t.test(String.fromCharCode(e)))},Yt=e.isIdentifierChar=function(e){return 48>e?36===e:58>e||!(65>e)&&(91>e||(97>e?95===e:123>e||e>=170&&_t.test(String.fromCharCode(e))))},Zt={kind:"loop"},en={kind:"switch"}})((e=this).acorn||(e.acorn={}));var binaryOperators={"+":"__add","-":"__subtract","*":"__multiply","/":"__divide","%":"__modulo","==":"equals","!=":"equals"},unaryOperators={"-":"__negate","+":null},fields=Base.each(["add","subtract","multiply","divide","modulo","negate"],function(name){this["__"+name]="#"+name},{});function __$__(left,operator,right){var handler=binaryOperators[operator];if(left&&left[handler]){var res=left[handler](right);return"!="===operator?!res:res}switch(operator){case"+":return left+right;case"-":return left-right;case"*":return left*right;case"/":return left/right;case"%":return left%right;case"==":return left==right;case"!=":return left!=right}}function $__(operator,value){var handler=unaryOperators[operator];if(handler&&value&&value[handler])return value[handler]();switch(operator){case"+":return+value;case"-":return-value}}function parse(code,options){return scope.acorn.parse(code,options)}function compile(code,url,options){if(!code)return"";options=options||{},url=url||"";var insertions=[];function getOffset(offset){for(var i=0,l=insertions.length;i<l;i++){var insertion=insertions[i];if(insertion[0]>=offset)break;offset+=insertion[1]}return offset}function getCode(node){return code.substring(getOffset(node.range[0]),getOffset(node.range[1]))}function getBetween(left,right){return code.substring(getOffset(left.range[1]),getOffset(right.range[0]))}function replaceCode(node,str){for(var start=getOffset(node.range[0]),end=getOffset(node.range[1]),insert=0,i=insertions.length-1;i>=0;i--)if(start>insertions[i][0]){insert=i+1;break}insertions.splice(insert,0,[start,str.length-end+start]),code=code.substring(0,start)+str+code.substring(end)}function walkAST(node,parent){if(node){for(var key in node)if("range"!==key&&"loc"!==key){var value=node[key];if(Array.isArray(value))for(var i=0,l=value.length;i<l;i++)walkAST(value[i],node);else value&&"object"==typeof value&&walkAST(value,node)}switch(node.type){case"UnaryExpression":if(node.operator in unaryOperators&&"Literal"!==node.argument.type){var arg=getCode(node.argument);replaceCode(node,'$__("'+node.operator+'", '+arg+")")}break;case"BinaryExpression":if(node.operator in binaryOperators&&"Literal"!==node.left.type){var left=getCode(node.left),right=getCode(node.right),between=getBetween(node.left,node.right),operator=node.operator;replaceCode(node,"__$__("+left+","+between.replace(new RegExp("\\"+operator),'"'+operator+'"')+", "+right+")")}break;case"UpdateExpression":case"AssignmentExpression":var parentType=parent&&parent.type;if(!("ForStatement"===parentType||"BinaryExpression"===parentType&&/^[=!<>]/.test(parent.operator)||"MemberExpression"===parentType&&parent.computed))if("UpdateExpression"===node.type){var arg,exp="__$__("+(arg=getCode(node.argument))+', "'+node.operator[0]+'", 1)',str=arg+" = "+exp;node.prefix||"AssignmentExpression"!==parentType&&"VariableDeclarator"!==parentType||(getCode(parent.left||parent.id)===arg&&(str=exp),str=arg+"; "+str),replaceCode(node,str)}else if(/^.=$/.test(node.operator)&&"Literal"!==node.left.type){var left=getCode(node.left),right=getCode(node.right);replaceCode(node,left+" = __$__("+left+', "'+node.operator[0]+'", '+right+")")}}}}var sourceMap=null,browser=paper.browser,version=browser.versionNumber,lineBreaks=/\r\n|\n|\r/gm;if(browser.chrome&&version>=30||browser.webkit&&version>=537.76||browser.firefox&&version>=23){var offset=0;if(0===window.location.href.indexOf(url)){var html=document.getElementsByTagName("html")[0].innerHTML;offset=html.substr(0,html.indexOf(code)+1).match(lineBreaks).length+1}var mappings=["AAAA"];mappings.length=(code.match(lineBreaks)||[]).length+1+offset,sourceMap={version:3,file:url,names:[],mappings:mappings.join(";AACA"),sourceRoot:"",sources:[url]};var source=options.source||!url&&code;source&&(sourceMap.sourcesContent=[source])}return walkAST(parse(code,{ranges:!0})),sourceMap&&(code=new Array(offset+1).join("\n")+code+"\n//# sourceMappingURL=data:application/json;base64,"+btoa(unescape(encodeURIComponent(JSON.stringify(sourceMap))))+"\n//# sourceURL="+(url||"paperscript")),code}function execute(code,scope,url,options){paper=scope;var view=scope.getView(),tool=/\s+on(?:Key|Mouse)(?:Up|Down|Move|Drag)\b/.test(code)?new Tool:null,toolHandlers=tool?tool._events:[],handlers=["onFrame","onResize"].concat(toolHandlers),params=[],args=[],func;function expose(scope,hidden){for(var key in scope)!hidden&&/^_/.test(key)||!new RegExp("([\\b\\s\\W]|^)"+key.replace(/\$/g,"\\$")+"\\b").test(code)||(params.push(key),args.push(scope[key]))}code=compile(code,url,options),expose({__$__:__$__,$__:$__,paper:scope,view:view,tool:tool},!0),expose(scope),(handlers=Base.each(handlers,function(key){new RegExp("\\s+"+key+"\\b").test(code)&&(params.push(key),this.push(key+": "+key))},[]).join(", "))&&(code+="\nreturn { "+handlers+" };");var browser=paper.browser;if(browser.chrome||browser.firefox){var script=document.createElement("script"),head=document.head||document.getElementsByTagName("head")[0];browser.firefox&&(code="\n"+code),script.appendChild(document.createTextNode("paper._execute = function("+params+") {"+code+"\n}")),head.appendChild(script),func=paper._execute,delete paper._execute,head.removeChild(script)}else func=Function(params,code);var res=func.apply(scope,args)||{};Base.each(toolHandlers,function(key){var value=res[key];value&&(tool[key]=value)}),view&&(res.onResize&&view.setOnResize(res.onResize),view.emit("resize",{size:view.size,delta:new Point}),res.onFrame&&view.setOnFrame(res.onFrame),view.update())}function loadScript(script){if(/^text\/(?:x-|)paperscript$/.test(script.type)&&"true"!==PaperScope.getAttribute(script,"ignore")){var canvasId=PaperScope.getAttribute(script,"canvas"),canvas=document.getElementById(canvasId),src=script.src||script.getAttribute("data-src"),async=PaperScope.hasAttribute(script,"async"),scopeAttribute="data-paper-scope";if(!canvas)throw new Error('Unable to find canvas with id "'+canvasId+'"');var scope=PaperScope.get(canvas.getAttribute(scopeAttribute))||(new PaperScope).setup(canvas);return canvas.setAttribute(scopeAttribute,scope._id),src?Http.request("get",src,function(code){execute(code,scope,src)},async):execute(script.innerHTML,scope,script.baseURI),script.setAttribute("data-paper-ignore","true"),scope}}function loadAll(){Base.each(document.getElementsByTagName("script"),loadScript)}function load(script){return script?loadScript(script):loadAll()}return Point.inject(fields),Size.inject(fields),Color.inject(fields),"complete"===document.readyState?setTimeout(loadAll):DomEvent.add(window,{load:loadAll}),{compile:compile,execute:execute,load:load,parse:parse}}.call(this),paper=new(PaperScope.inject(Base.exports,{enumerable:!0,Base:Base,Numerical:Numerical,Key:Key})),"function"==typeof define&&define.amd?define("paper",paper):"object"==typeof module&&module&&(module.exports=paper),paper};